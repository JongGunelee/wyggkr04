<!DOCTYPE html>
<html lang="ko"><head>
    <meta charset="UTF-8">
    <title>ê¸°ìˆ™ì‚¬ ë° ì‚¬íƒ ì£¼ì°¨ë©´ ê´€ë¦¬ (Final Masterpiece with Advanced UI)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans KR', 'Malgun Gothic', sans-serif; margin: 25px; background-color: #f8f9fa; color: #212529; }
        .main-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 3px solid #aab8c2; padding-bottom: 15px; }
        .main-header h1 { font-weight: 700; color: #2c3e50; border-bottom: none; padding-bottom: 0; margin: 0; }
        .main-header .controls { margin: 0; }
        .btn { background-color: #e9ecef; color: #495057; padding: 6px 14px; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 500; margin-left: 6px; transition: all 0.2s ease-in-out; }
        .btn:hover { background-color: #dee2e6; border-color: #ced4da; }
        .btn:disabled { background-color: #f8f9fa; color: #adb5bd; cursor: not-allowed; }
        .btn.active { background-color: #ffecd1; border-color: #ffc107; color: #d98e00; }
        
        .dropdown { position: relative; display: inline-block; }
        .dropdown-content { display: none; position: absolute; right: 0; background-color: #ffffff; min-width: 220px; box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2); z-index: 100; border-radius: 6px; border: 1px solid #dee2e6; padding: 8px 0; }
        .dropdown-content a { color: #212529; padding: 10px 16px; text-decoration: none; display: block; font-size: 14px; }
        .dropdown-content a:hover { background-color: #f8f9fa; }
        .dropdown-content .divider { height: 1px; margin: 8px 0; overflow: hidden; background-color: #e9ecef; }
        .show { display: block; }
        #file-input { display: none; }

        .view-drawing-icon { cursor: pointer; font-size: 1.2em; }
        
        h2 { color: #34495e; border-bottom: 1px solid #dce4e9; padding-bottom: 12px; font-weight: 500; margin-top: 40px;}
        .kpi-container { display: flex; justify-content: space-around; gap: 20px; margin-bottom: 15px; align-items: stretch; }
        
        .kpi-card { background: #ffffff; padding: 15px; border-radius: 8px; text-align: center; flex: 1; border: 1px solid #e9ecef; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05); display: flex; flex-direction: column; justify-content: space-between; }
        .kpi-card-section { width: 100%; text-align: center; padding: 5px 0; }
        .kpi-card-section.title h3 { margin: 0; color: #566573; font-weight: 500; font-size: 1em; }
        .kpi-card-section.value .val { font-size: 2.2em; font-weight: 700; color: #2c3e50; margin: 0; padding: 2px 5px; border-radius: 4px; transition: background-color 0.3s; }
        
        .kpi-card-section.details { font-size: 0.9em; color: #566573; line-height: 1.6; border-top: 1px solid #f1f3f5; padding-top: 10px; text-align: left; }
        .kpi-card-section.details.no-change { text-align: center; }
        .kpi-card-section.details b { transition: background-color: 0.3s; padding: 1px 3px; border-radius: 3px; }
        .kpi-card-section.details span { display: block; word-break: break-all; }


        .kpi-card.total-spots-card { justify-content: flex-start; }
        .kpi-card.total-spots-card .kpi-card-section.value { flex-grow: 1; display: flex; align-items: center; justify-content: center; }

        .analysis-section { border: 1px solid #ffc107; background-color: #fffaf0; margin-top: 15px; padding: 10px; border-radius: 8px; }
        .analysis-section h2 { color: #d98e00; border-bottom-color: #ffecd1; margin-top:10px; }
        .analysis-section .kpi-card { background-color: #fff; }
        .analysis-section .kpi-card-section.title h3 { color: #8c5a00; }
        .analysis-section .kpi-card-section.details { font-size: 0.9em; }

        .kpi-summary-container { background: #ffffff; padding: 15px 25px; border-radius: 8px; border: 1px solid #e9ecef; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05); margin-bottom: 15px; display: flex; justify-content: space-around; align-items: flex-start; }
        .kpi-summary-item { text-align: center; flex: 1; }
        .kpi-summary-item .label { font-size: 1em; color: #566573; font-weight: 500; margin-bottom: 5px; }
        .kpi-summary-item .value { font-size: 1.4em; color: #2c3e50; font-weight: 700; display: inline-block; padding: 2px 5px; border-radius: 4px; transition: background-color 0.3s; }
        .change-details-section, .info-details-section { flex: 1.5; }
        .detail-list { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; font-size: 0.9em; margin-top: 5px;}
        .detail-list span { color: #495057; }
        .detail-list b { color: #2c3e50; font-weight: 700; padding: 2px 5px; border-radius: 4px; transition: background-color 0.3s; }
        .info-summary-container { padding: 10px 25px; border-radius: 8px; border: 1px solid #e9ecef; margin-bottom: 30px; text-align: center; background-color: #ffffff; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);}
        .info-item { display: inline-block; margin: 0 15px; font-size: 0.85em; color: #6c757d; font-weight: 400; }
        .table-header-container { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .table-title-wrapper { display: flex; align-items: center; gap: 15px; }
        .table-title-wrapper h2 { margin: 0; border-bottom: none; padding-bottom: 0; }
        #toggleAllBtn { font-size: 12px; padding: 4px 10px; font-weight: 500; }
        .table-header-container .table-controls { align-self: flex-end; }
        
        #kpi-group-details-summary { flex-direction: column; align-items: stretch; }
        .group-detail-row { display: flex; justify-content: space-around; padding: 8px 0; border-bottom: 1px solid #f1f3f5; }
        .group-detail-row:last-child { border-bottom: none; }
        .group-detail-item { flex: 1; text-align: center; }
        .group-detail-item.header { font-weight: 700; color: #2c3e50; }
        .group-detail-item span { font-size: 0.95em; }
        .group-detail-item .value { font-size: 1.1em; color: #34495e; font-weight: 400; display: inline-block; padding: 2px 5px; border-radius: 4px; transition: background-color 0.3s;}
        .group-detail-row[data-group-detail] .group-detail-item:first-child span { font-weight: 700; }
        .group-detail-row.total-row { background-color: #f8f9fa; margin-top: 5px; border-top: 2px solid #e9ecef; font-weight: 700; }
        .group-detail-row.total-row .group-detail-item .value { font-weight: 700; }
        .group-detail-row[data-group-detail]:nth-child(even) { background-color: #f8f9fa; }
        
        #kpi-group-details-summary .group-detail-row:first-of-type { background-color: #e4eaf1; border-bottom: 2px solid #d0dce8; padding-top: 5px; padding-bottom: 5px; }

        table { 
            border-collapse: collapse; 
            width: 100%; 
            margin-bottom: 30px; 
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); 
            border-radius: 8px; 
            font-size: 14px; 
        }
        th, td { border: 1px solid #e9ecef; padding: 12px; text-align: center; vertical-align: middle; position: relative;}
        
        thead th { 
            position: -webkit-sticky; 
            position: sticky; 
            top: 0; 
            background-color: #f1f5f9; 
            z-index: 10; 
        }
        thead th:first-child { border-top-left-radius: 8px; }
        thead th:last-child { border-top-right-radius: 8px; }
        
        .editable-base { background-color: #fffaf0; }
        .editable-desc { background-color: #fdfdfe; }
        .editable { cursor: pointer; min-height: 20px; transition: background-color 0.3s; }
        
        .cell-unsaved-change { background-color: #e7f5ff !important; } 
        .value-unsaved-change { background-color: #fff9c4 !important; } 
        .has-history-tooltip { 
            text-decoration: underline;
            text-decoration-style: dashed;
            text-decoration-color: #868e96;
            cursor: help;
        }

        .auto-calc { font-weight: 500; color: #334e68; border-left: 3px solid #a0b4c8; }
        
        .group-header th { background-color: #e4eaf1; }
        .group-header th:first-child { text-align: left; padding-left: 20px; }
        .group-header-title { cursor: pointer; user-select: none; font-weight: 700; color: #2c3e50; }
        .group-header-title::before { content: 'â–¶ '; font-size: 0.8em; color: #868e96; }
        .group-header.expanded .group-header-title::before { content: 'â–¼ '; color: #007bff; }

        tr.collapsed { display: none; }
        .sub-total td, .grand-total td { background-color: #f1f5f9; font-weight: 500; }
        .grand-total td { font-weight: 700; color: #2c3e50;}
        .change-positive { color: #007bff !important; }
        .change-negative { color: #dc3545 !important; font-weight: 700 !important; }
        
        .cell-modified::after { 
            content: ''; 
            position: absolute; 
            top: 0; right: 0; width: 0; height: 0; 
            border-style: solid; border-width: 0 10px 10px 0; 
        }
        .cell-modified.rev-highlight-0::after { border-color: transparent #e57373 transparent transparent; } /* Red */
        .cell-modified.rev-highlight-1::after { border-color: transparent #81c784 transparent transparent; } /* Green */
        .cell-modified.rev-highlight-2::after { border-color: transparent #64b5f6 transparent transparent; } /* Blue */
        .cell-modified.rev-highlight-3::after { border-color: transparent #ffd54f transparent transparent; } /* Amber */
        .cell-modified.rev-highlight-4::after { border-color: transparent #ba68c8 transparent transparent; } /* Purple */

        #tooltip { position: absolute; display: none; padding: 8px 12px; background-color: #333; color: white; border-radius: 6px; font-size: 0.9em; z-index: 2050; pointer-events: none; line-height: 1.5; }
        
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 2000; display: none; justify-content: center; align-items: center; }
        .modal-content { 
            background-color: #fff; padding: 0; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); 
            width: 80%; max-width: 800px; min-width: 400px; max-height: 80vh; min-height: 200px;
            display: flex; flex-direction: column;
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            resize: both; overflow: hidden;
        }
        .modal-header { 
            display: flex; justify-content: space-between; align-items: center; 
            border-bottom: 1px solid #dee2e6; padding: 15px;
            cursor: move; 
            background-color: #f1f5f9;
            border-top-left-radius: 8px; border-top-right-radius: 8px;
        }
        .modal-header h3 { margin: 0; color: #2c3e50; }
        .modal-close-btn { font-size: 1.5rem; font-weight: 700; color: #6c757d; cursor: pointer; background: none; border: none; }
        #revision-list { list-style-type: none; padding: 10px; margin: 0; flex-grow: 1; overflow-y: auto; }
        #revision-list li { border-bottom: 1px solid #e9ecef; padding: 15px 10px; display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; }
        #revision-list li:last-child { border-bottom: none; }
        .revision-info { flex-grow: 1; }
        .revision-info .rev-title { font-weight: 700; color: #34495e; }
        .revision-info .rev-timestamp { font-size: 0.85em; color: #868e96; margin-left: 10px; }
        .revision-info .rev-summary { font-size: 0.9em; color: #566573; margin-top: 8px; display: block; max-width: 550px; line-height: 1.6; }
        .revision-actions .btn { margin-left: 10px; }
        
        .btn.active.btn-rev-highlight-0 { background-color: #e57373; border-color: #d32f2f; color: white; }
        .btn.active.btn-rev-highlight-1 { background-color: #81c784; border-color: #388e3c; color: white; }
        .btn.active.btn-rev-highlight-2 { background-color: #64b5f6; border-color: #1976d2; color: white; }
        .btn.active.btn-rev-highlight-3 { background-color: #ffd54f; border-color: #fbc02d; color: #333; }
        .btn.active.btn-rev-highlight-4 { background-color: #ba68c8; border-color: #7b1fa2; color: white; }
        
        #conversion-modal-body .conversion-item { margin-bottom: 20px; padding: 15px; border: 1px solid #e9ecef; border-radius: 6px; background-color: #fdfdfe;}
        #conversion-modal-body .conversion-item h4 { margin-top: 0; color: #34495e; }
        #conversion-modal-body .conversion-grid { display: grid; grid-template-columns: 1fr auto 1fr auto 120px; gap: 10px; align-items: center; }
        #conversion-modal-body .conversion-grid input { width: 80px; text-align: right; padding: 5px; border: 1px solid #ced4da; border-radius: 4px; }
        
        #conversion-modal-body .manual-conversion-section { margin-top: 25px; padding-top: 15px; border-top: 1px dashed #ced4da; }
        #conversion-modal-body h5 { margin-top: 0; margin-bottom: 10px; font-size: 1.1em; color: #495057; }
        #conversion-modal-body .manual-conversion-list { display: flex; flex-direction: column; gap: 10px; margin-bottom: 15px; }
        #conversion-modal-body .manual-conversion-row { display: flex; align-items: center; gap: 10px; }
        #conversion-modal-body .manual-conversion-row select,
        #conversion-modal-body .manual-conversion-row input { padding: 5px; border: 1px solid #ced4da; border-radius: 4px; }
        #conversion-modal-body .manual-conversion-row input { width: 80px; text-align: right; }
        #conversion-modal-body .btn-add-manual { font-size: 13px; background-color: #f1f3f5; }
        #conversion-modal-body .btn-remove-manual { background: none; border: none; color: #dc3545; font-size: 1.5em; cursor: pointer; padding: 0 5px; line-height: 1; }
        
        #conversion-modal-body .conversion-group { margin-bottom: 15px; }
        #conversion-modal-body .conversion-group-header {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 10px;
            background-color: #f1f5f9;
            border-radius: 4px;
            margin-bottom: 5px;
        }
        #conversion-modal-body .conversion-group-header:hover { background-color: #e4eaf1; }
        #conversion-modal-body .toggle-icon {
            font-size: 1.2em; font-weight: bold; width: 20px;
            text-align: center; margin-right: 10px; color: #007bff;
        }
        #conversion-modal-body .conversion-group-content {
            padding-left: 15px; border-left: 2px solid #e9ecef; margin-left: 10px; display: block;
        }
        #conversion-modal-body .conversion-group-content.collapsed { display: none; }


    </style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" defer=""></script></head>
<body>
    <div class="main-header">
        <h1>ê¸°ìˆ™ì‚¬ ë° ì‚¬íƒ ì£¼ì°¨ë©´ ê´€ë¦¬</h1>
        <div class="controls">
            <div class="dropdown">
                <button class="btn" onclick="toggleDropdown()">ë‚´ë³´ë‚´ê¸°/ê°€ì ¸ì˜¤ê¸°</button>
                <div id="myDropdown" class="dropdown-content">
                    <a href="#" onclick="exportTableToExcel()">ëŒ€ì‹œë³´ë“œ Excelë¡œ ë‚´ë³´ë‚´ê¸°</a>
                    <a href="#" onclick="saveAsHtml()">HTMLë¡œ ì €ì¥í•˜ê¸°</a>
                    <div class="divider"></div>
                    <a href="#" onclick="downloadTemplate()">ë°ì´í„° í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ</a>
                    <a href="#" onclick="document.getElementById('file-input').click();">Excel ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°</a>
                </div>
            </div>
            <input type="file" id="file-input" accept=".xlsx, .xls" onchange="handleFileUpload(event)">
            <button class="btn" onclick="window.print()">ì¸ì‡„í•˜ê¸°</button>
        </div>
    </div>
    
    <p style="margin-top:8px;"><strong>ë³´ê³ ì¼:</strong> <span id="reportDate">2025-08-04</span> | <strong>ìµœì¢… ì—…ë°ì´íŠ¸:</strong> <span id="lastUpdated">2025. 8. 4. ì˜¤í›„ 8:36:20</span></p>
    
    <h2>ğŸ“Š ì´ëŸ‰(Net) ë³€ë™ ê°œìš”</h2>
    <div class="kpi-container">
        <div class="kpi-card total-spots-card">
            <div class="kpi-card-section title"><h3>ì „ì²´ ì£¼ì°¨ë©´ ìˆ˜</h3></div>
            <div class="kpi-card-section value"><div id="kpi-total-spots" class="val value-unsaved-change has-history-tooltip">539</div></div>
        </div>
        <div class="kpi-card">
            <div class="kpi-card-section title"><h3>ì£¼ì°¨ë©´ ì‹ ì„¤ (Net)</h3></div>
            <div class="kpi-card-section value"><div id="kpi-new-spots" class="val value-unsaved-change has-history-tooltip">9</div></div>
            <div id="kpi-new-spots-details" class="kpi-card-section details"><span>ì‚¬íƒ ë° 3ë™ (ì§€ìƒ/ì§€í•˜) &gt; 1ë™ &gt; ì¼ë°˜: <b data-track-key="ì‚¬íƒ ë° 3ë™ (ì§€ìƒ/ì§€í•˜) &gt; 1ë™ &gt; ì¼ë°˜" class="change-positive has-history-tooltip">+1</b></span><span>ì‚¬íƒ ë° 3ë™ (ì§€ìƒ/ì§€í•˜) &gt; 3ë™ ì• &gt; ì¼ë°˜: <b data-track-key="ì‚¬íƒ ë° 3ë™ (ì§€ìƒ/ì§€í•˜) &gt; 3ë™ ì• &gt; ì¼ë°˜" class="change-positive has-history-tooltip">+2</b></span><span>ì‚¬íƒ ë° 3ë™ (ì§€ìƒ/ì§€í•˜) &gt; 7ë™ &gt; ì¼ë°˜: <b data-track-key="ì‚¬íƒ ë° 3ë™ (ì§€ìƒ/ì§€í•˜) &gt; 7ë™ &gt; ì¼ë°˜" class="change-positive has-history-tooltip">+1</b></span><span>ì‚¬íƒ ë° 3ë™ (ì§€ìƒ/ì§€í•˜) &gt; 8ë™ë’¤ ê²½ì‚¬ë¡œ &gt; ì‹œê°„ì œ: <b data-track-key="ì‚¬íƒ ë° 3ë™ (ì§€ìƒ/ì§€í•˜) &gt; 8ë™ë’¤ ê²½ì‚¬ë¡œ &gt; ì‹œê°„ì œ" class="change-positive has-history-tooltip">+2</b></span><span>ì‚¬íƒ ë° 3ë™ (ì§€ìƒ/ì§€í•˜) &gt; 5~8ë™ ì§€í•˜ì£¼ì°¨ì¥ &gt; ì¼ë°˜: <b data-track-key="ì‚¬íƒ ë° 3ë™ (ì§€ìƒ/ì§€í•˜) &gt; 5~8ë™ ì§€í•˜ì£¼ì°¨ì¥ &gt; ì¼ë°˜" class="change-positive has-history-tooltip">+2</b></span><span>101ë™-104ë™(ì§€ìƒ/ì§€í•˜) &gt; 101ë™-104ë™ B1 &gt; ì¼ë°˜: <b data-track-key="101ë™-104ë™(ì§€ìƒ/ì§€í•˜) &gt; 101ë™-104ë™ B1 &gt; ì¼ë°˜" class="change-positive has-history-tooltip">+1</b></span></div>
        </div>
        <div class="kpi-card">
            <div class="kpi-card-section title"><h3>ì£¼ì°¨ë©´ ì œê±° (Net)</h3></div>
            <div class="kpi-card-section value"><div id="kpi-removed-spots" class="val value-unsaved-change has-history-tooltip">1</div></div>
            <div id="kpi-removed-spots-details" class="kpi-card-section details"><span>101ë™-104ë™(ì§€ìƒ/ì§€í•˜) &gt; 101ë™-104ë™ B2 &gt; ê²½ì°¨: <b data-track-key="101ë™-104ë™(ì§€ìƒ/ì§€í•˜) &gt; 101ë™-104ë™ B2 &gt; ê²½ì°¨" class="change-negative has-history-tooltip">-1</b></span></div>
        </div>
    </div>

    <div class="analysis-section">
        <h2>ğŸ’¡ ì‘ì—…ëŸ‰(Gross) ìƒì„¸ ë¶„ì„</h2>
        <div class="kpi-container">
            <div class="kpi-card">
                <div class="kpi-card-section title"><h3>ì‹ ê·œ ì„¤ì¹˜ (Gross New)</h3></div>
                <div class="kpi-card-section value"><div id="kpi-gross-new-spots" class="val value-unsaved-change has-history-tooltip">9</div></div>
                <div id="kpi-gross-new-spots-details" class="kpi-card-section details"><span>ì‚¬íƒ ë° 3ë™ (ì§€ìƒ/ì§€í•˜) &gt; 1ë™ &gt; ì¼ë°˜: <b data-track-key="ì‚¬íƒ ë° 3ë™ (ì§€ìƒ/ì§€í•˜) &gt; 1ë™ &gt; ì¼ë°˜" class="change-positive has-history-tooltip">+1</b></span><span>ì‚¬íƒ ë° 3ë™ (ì§€ìƒ/ì§€í•˜) &gt; 3ë™ ì• &gt; ì¼ë°˜: <b data-track-key="ì‚¬íƒ ë° 3ë™ (ì§€ìƒ/ì§€í•˜) &gt; 3ë™ ì• &gt; ì¼ë°˜" class="change-positive has-history-tooltip">+2</b></span><span>ì‚¬íƒ ë° 3ë™ (ì§€ìƒ/ì§€í•˜) &gt; 7ë™ &gt; ì¼ë°˜: <b data-track-key="ì‚¬íƒ ë° 3ë™ (ì§€ìƒ/ì§€í•˜) &gt; 7ë™ &gt; ì¼ë°˜" class="change-positive has-history-tooltip">+1</b></span><span>ì‚¬íƒ ë° 3ë™ (ì§€ìƒ/ì§€í•˜) &gt; 8ë™ë’¤ ê²½ì‚¬ë¡œ &gt; ì‹œê°„ì œ: <b data-track-key="ì‚¬íƒ ë° 3ë™ (ì§€ìƒ/ì§€í•˜) &gt; 8ë™ë’¤ ê²½ì‚¬ë¡œ &gt; ì‹œê°„ì œ" class="change-positive has-history-tooltip">+2</b></span><span>ì‚¬íƒ ë° 3ë™ (ì§€ìƒ/ì§€í•˜) &gt; 5~8ë™ ì§€í•˜ì£¼ì°¨ì¥ &gt; ì¼ë°˜: <b data-track-key="ì‚¬íƒ ë° 3ë™ (ì§€ìƒ/ì§€í•˜) &gt; 5~8ë™ ì§€í•˜ì£¼ì°¨ì¥ &gt; ì¼ë°˜" class="change-positive has-history-tooltip">+2</b></span><span>101ë™-104ë™(ì§€ìƒ/ì§€í•˜) &gt; 101ë™-104ë™ B1 &gt; ì¼ë°˜: <b data-track-key="101ë™-104ë™(ì§€ìƒ/ì§€í•˜) &gt; 101ë™-104ë™ B1 &gt; ì¼ë°˜" class="change-positive has-history-tooltip">+1</b></span></div>
            </div>
            <div class="kpi-card">
                <div class="kpi-card-section title"><h3>ì™„ì „ ì œê±° (Gross Removed)</h3></div>
                <div class="kpi-card-section value"><div id="kpi-gross-removed-spots" class="val value-unsaved-change has-history-tooltip">1</div></div>
                <div id="kpi-gross-removed-spots-details" class="kpi-card-section details"><span>101ë™-104ë™(ì§€ìƒ/ì§€í•˜) &gt; 101ë™-104ë™ B2 &gt; ê²½ì°¨: <b data-track-key="101ë™-104ë™(ì§€ìƒ/ì§€í•˜) &gt; 101ë™-104ë™ B2 &gt; ê²½ì°¨" class="change-negative has-history-tooltip">-1</b></span></div>
            </div>
            <div class="kpi-card">
                <div class="kpi-card-section title"><h3>ìœ í˜• ë³€ê²½ (Type Conversion)</h3></div>
                <div class="kpi-card-section value"><div id="kpi-type-conversion-spots" class="val value-unsaved-change has-history-tooltip">14</div></div>
                 <div id="kpi-type-conversion-spots-details" class="kpi-card-section details"><span>ì‚¬íƒ ë° 3ë™ (ì§€ìƒ/ì§€í•˜) &gt; 5~8ë™ ì§€í•˜ì£¼ì°¨ì¥: ê²½ì°¨ â†’ ì¼ë°˜: <b data-track-key="ì‚¬íƒ ë° 3ë™ (ì§€ìƒ/ì§€í•˜) &gt; 5~8ë™ ì§€í•˜ì£¼ì°¨ì¥: ê²½ì°¨ â†’ ì¼ë°˜" class="has-history-tooltip">8ë©´</b></span><span>101ë™-104ë™(ì§€ìƒ/ì§€í•˜) &gt; 101ë™-104ë™ B1: ê²½ì°¨ â†’ ì¼ë°˜: <b data-track-key="101ë™-104ë™(ì§€ìƒ/ì§€í•˜) &gt; 101ë™-104ë™ B1: ê²½ì°¨ â†’ ì¼ë°˜" class="has-history-tooltip">3ë©´</b></span><span>101ë™-104ë™(ì§€ìƒ/ì§€í•˜) &gt; 101ë™-104ë™ B2: ê²½ì°¨ â†’ ì¼ë°˜: <b data-track-key="101ë™-104ë™(ì§€ìƒ/ì§€í•˜) &gt; 101ë™-104ë™ B2: ê²½ì°¨ â†’ ì¼ë°˜" class="has-history-tooltip">3ë©´</b></span></div>
            </div>
        </div>
    </div>
    
    <div class="kpi-summary-container" id="kpi-building-summary"><div class="kpi-summary-item">
            <div class="label">ì‚¬íƒ ë° 3ë™ (ì§€ìƒ/ì§€í•˜)</div>
            <div class="value has-history-tooltip" data-summary-building="ì‚¬íƒ ë° 3ë™ (ì§€ìƒ/ì§€í•˜)">297</div>
        </div><div class="kpi-summary-item">
            <div class="label">ABë™(ì§€ìƒ/ì§€í•˜)</div>
            <div class="value" data-summary-building="ABë™(ì§€ìƒ/ì§€í•˜)">149</div>
        </div><div class="kpi-summary-item">
            <div class="label">101ë™-104ë™(ì§€ìƒ/ì§€í•˜)</div>
            <div class="value" data-summary-building="101ë™-104ë™(ì§€ìƒ/ì§€í•˜)">93</div>
        </div></div>
    <div class="kpi-summary-container" id="kpi-change-details">
        <div class="kpi-summary-item change-details-section">
            <div class="label">ì£¼ì°¨ë©´ ë³€ë™ ìƒì„¸ (Net)</div>
            <div id="detail-list-dynamic" class="detail-list"><span>ì¼ë°˜: <b data-change-type="ì¼ë°˜" class="change-positive has-history-tooltip">+21</b></span><span>ì‹œê°„ì œ: <b data-change-type="ì‹œê°„ì œ" class="change-positive has-history-tooltip">+2</b></span><span>ê²½ì°¨: <b data-change-type="ê²½ì°¨" class="change-negative has-history-tooltip">-15</b></span><span>ì¥ì• ì¸: <b data-change-type="ì¥ì• ì¸" class="">-</b></span><span>ì „ê¸°ì°¨: <b data-change-type="ì „ê¸°ì°¨" class="">-</b></span></div>
        </div>
    </div>
    <div class="kpi-summary-container" id="kpi-group-details-summary"><div class="group-detail-row"><div class="group-detail-item header"><span>êµ¬ë¶„</span></div><div class="group-detail-item header"><span>ì¼ë°˜</span></div><div class="group-detail-item header"><span>ì‹œê°„ì œ</span></div><div class="group-detail-item header"><span>ê²½ì°¨</span></div><div class="group-detail-item header"><span>ì¥ì• ì¸</span></div><div class="group-detail-item header"><span>ì „ê¸°ì°¨</span></div></div><div class="group-detail-row" data-group-detail="ì‚¬íƒ ë° 3ë™ (ì§€ìƒ/ì§€í•˜)"><div class="group-detail-item"><span>ì‚¬íƒ ë° 3ë™ (ì§€ìƒ/ì§€í•˜)</span></div><div class="group-detail-item"><span class="value has-history-tooltip" data-group-value="ì‚¬íƒ ë° 3ë™ (ì§€ìƒ/ì§€í•˜)-ì¼ë°˜">271</span></div><div class="group-detail-item"><span class="value has-history-tooltip" data-group-value="ì‚¬íƒ ë° 3ë™ (ì§€ìƒ/ì§€í•˜)-ì‹œê°„ì œ">12</span></div><div class="group-detail-item"><span class="value has-history-tooltip" data-group-value="ì‚¬íƒ ë° 3ë™ (ì§€ìƒ/ì§€í•˜)-ê²½ì°¨">2</span></div><div class="group-detail-item"><span class="value" data-group-value="ì‚¬íƒ ë° 3ë™ (ì§€ìƒ/ì§€í•˜)-ì¥ì• ì¸">4</span></div><div class="group-detail-item"><span class="value" data-group-value="ì‚¬íƒ ë° 3ë™ (ì§€ìƒ/ì§€í•˜)-ì „ê¸°ì°¨">8</span></div></div><div class="group-detail-row" data-group-detail="ABë™(ì§€ìƒ/ì§€í•˜)"><div class="group-detail-item"><span>ABë™(ì§€ìƒ/ì§€í•˜)</span></div><div class="group-detail-item"><span class="value" data-group-value="ABë™(ì§€ìƒ/ì§€í•˜)-ì¼ë°˜">125</span></div><div class="group-detail-item"><span class="value" data-group-value="ABë™(ì§€ìƒ/ì§€í•˜)-ì‹œê°„ì œ">6</span></div><div class="group-detail-item"><span class="value" data-group-value="ABë™(ì§€ìƒ/ì§€í•˜)-ê²½ì°¨">13</span></div><div class="group-detail-item"><span class="value" data-group-value="ABë™(ì§€ìƒ/ì§€í•˜)-ì¥ì• ì¸">5</span></div><div class="group-detail-item"><span class="value" data-group-value="ABë™(ì§€ìƒ/ì§€í•˜)-ì „ê¸°ì°¨">-</span></div></div><div class="group-detail-row" data-group-detail="101ë™-104ë™(ì§€ìƒ/ì§€í•˜)"><div class="group-detail-item"><span>101ë™-104ë™(ì§€ìƒ/ì§€í•˜)</span></div><div class="group-detail-item"><span class="value has-history-tooltip" data-group-value="101ë™-104ë™(ì§€ìƒ/ì§€í•˜)-ì¼ë°˜">87</span></div><div class="group-detail-item"><span class="value" data-group-value="101ë™-104ë™(ì§€ìƒ/ì§€í•˜)-ì‹œê°„ì œ">-</span></div><div class="group-detail-item"><span class="value has-history-tooltip" data-group-value="101ë™-104ë™(ì§€ìƒ/ì§€í•˜)-ê²½ì°¨">3</span></div><div class="group-detail-item"><span class="value" data-group-value="101ë™-104ë™(ì§€ìƒ/ì§€í•˜)-ì¥ì• ì¸">3</span></div><div class="group-detail-item"><span class="value" data-group-value="101ë™-104ë™(ì§€ìƒ/ì§€í•˜)-ì „ê¸°ì°¨">-</span></div></div><div class="group-detail-row total-row"><div class="group-detail-item"><span>ì „ì²´ í•©ê³„</span></div><div class="group-detail-item"><span class="value has-history-tooltip" data-group-total-value="ì¼ë°˜">483</span></div><div class="group-detail-item"><span class="value has-history-tooltip" data-group-total-value="ì‹œê°„ì œ">18</span></div><div class="group-detail-item"><span class="value has-history-tooltip" data-group-total-value="ê²½ì°¨">18</span></div><div class="group-detail-item"><span class="value" data-group-total-value="ì¥ì• ì¸">12</span></div><div class="group-detail-item"><span class="value" data-group-total-value="ì „ê¸°ì°¨">8</span></div></div></div>
    
    <div class="info-summary-container">
        <div class="kpi-summary-item info-details-section">
            <div class="label">ì°¸ì¡° ì‚¬í•­</div>
            <div class="detail-list">
                <span class="info-item">â€» ê±´ì¶•ë¬¼ëŒ€ì¥ ì£¼ì°¨ë©´ìˆ˜: 369ëŒ€ (A,Bë™ + ì‚¬íƒ) * 3ë™ ì œì™¸</span>
                <span class="info-item">â€» 3ë™ ~ 5ë™ ë„ë¡œ: 10ëŒ€</span>
                <span class="info-item">â€» ABë™ ~ 9ë™ ë„ë¡œ: 9ëŒ€</span>
            </div>
        </div>
    </div>

    <div class="table-header-container">
        <div class="table-title-wrapper">
            <h2>ğŸ¢ ë™ë³„ ì£¼ì°¨ë©´ í˜„í™©</h2>
            <button class="btn" id="toggleAllBtn" onclick="toggleAllGroups(this)">ì „ì²´ ì ‘ê¸°</button>
        </div>
        <div class="table-controls">
            <button class="btn active" id="showHistoryBtn" onclick="showRevisionHistory()">ë³€ê²½ì‚¬í•­ ë³´ê¸°</button>
            <button class="btn" id="specifyConversionBtn" onclick="openConversionModal()">ìœ í˜• ë³€ê²½ ì§€ì •</button>
            <button class="btn" id="saveRevisionBtn" onclick="saveRevision()">ë³€ê²½ì‚¬í•­ ì €ì¥(Rev)</button>
            <button class="btn" id="undoBtn" onclick="undo()" disabled="">ì‹¤í–‰ ì·¨ì†Œ</button>
            <button class="btn" id="redoBtn" onclick="redo()" disabled="">ë‹¤ì‹œ ì‹¤í–‰</button>
        </div>
    </div>

    <table id="parkingStatusTable">
        <thead><tr><th style="width:20%">êµ¬ë¶„</th><th style="width:5%">ë„ë©´</th><th>ì¼ë°˜</th><th>ì‹œê°„ì œ</th><th>ê²½ì°¨</th><th>ì¥ì• ì¸</th><th>ì „ê¸°ì°¨</th><th class="auto-calc" style="width:8%">í•©ê³„</th><th class="auto-calc" style="width:8%">ì¦ê°</th><th style="width:24%">ë¹„ê³ </th></tr></thead>
        <tbody id="parkingDataBody"><tr class="group-header expanded"><th><span class="group-header-title">ì‚¬íƒ ë° 3ë™ (ì§€ìƒ/ì§€í•˜)</span></th><th><span class="view-drawing-icon">ğŸ”</span></th><th colspan="8"></th></tr><tr data-row-id="d1"><td data-field="location" class="editable editable-desc" contenteditable="true">1ë™</td><td></td><td data-field="ì¼ë°˜" class="editable editable-base cell-modified rev-highlight-0" contenteditable="true">24</td><td data-field="ì‹œê°„ì œ" class="editable editable-base" contenteditable="true"></td><td data-field="ê²½ì°¨" class="editable editable-base" contenteditable="true"></td><td data-field="ì¥ì• ì¸" class="editable editable-base" contenteditable="true">1</td><td data-field="ì „ê¸°ì°¨" class="editable editable-base" contenteditable="true"></td><td class="auto-calc total-col">25</td><td class="auto-calc change-col change-positive">+1</td><td data-field="memo" class="editable editable-desc" contenteditable="true"></td></tr><tr data-row-id="d2"><td data-field="location" class="editable editable-desc" contenteditable="true">2ë™ ë’¤</td><td></td><td data-field="ì¼ë°˜" class="editable editable-base" contenteditable="true">25</td><td data-field="ì‹œê°„ì œ" class="editable editable-base" contenteditable="true"></td><td data-field="ê²½ì°¨" class="editable editable-base" contenteditable="true"></td><td data-field="ì¥ì• ì¸" class="editable editable-base" contenteditable="true"></td><td data-field="ì „ê¸°ì°¨" class="editable editable-base" contenteditable="true"></td><td class="auto-calc total-col">25</td><td class="auto-calc change-col"></td><td data-field="memo" class="editable editable-desc" contenteditable="true">2ë™ 1,2ë¼ì¸ë’¤ 1ëŒ€ ì‚¬ìš©ì œí•œ(ì°¨ëŸ‰ í†µë¡œ í™•ë³´)</td></tr><tr data-row-id="d3"><td data-field="location" class="editable editable-desc" contenteditable="true">3ë™ ë’¤</td><td></td><td data-field="ì¼ë°˜" class="editable editable-base" contenteditable="true">22</td><td data-field="ì‹œê°„ì œ" class="editable editable-base" contenteditable="true"></td><td data-field="ê²½ì°¨" class="editable editable-base" contenteditable="true"></td><td data-field="ì¥ì• ì¸" class="editable editable-base" contenteditable="true"></td><td data-field="ì „ê¸°ì°¨" class="editable editable-base" contenteditable="true">2</td><td class="auto-calc total-col">24</td><td class="auto-calc change-col"></td><td data-field="memo" class="editable editable-desc" contenteditable="true"></td></tr><tr data-row-id="d4"><td data-field="location" class="editable editable-desc" contenteditable="true">3ë™ ì•</td><td></td><td data-field="ì¼ë°˜" class="editable editable-base cell-modified rev-highlight-0" contenteditable="true">28</td><td data-field="ì‹œê°„ì œ" class="editable editable-base" contenteditable="true"></td><td data-field="ê²½ì°¨" class="editable editable-base" contenteditable="true"></td><td data-field="ì¥ì• ì¸" class="editable editable-base" contenteditable="true">1</td><td data-field="ì „ê¸°ì°¨" class="editable editable-base" contenteditable="true"></td><td class="auto-calc total-col">29</td><td class="auto-calc change-col change-positive">+2</td><td data-field="memo" class="editable editable-desc" contenteditable="true"></td></tr><tr data-row-id="d5"><td data-field="location" class="editable editable-desc" contenteditable="true">3ë™ ì˜†(í¸ì˜ì  ì•)</td><td></td><td data-field="ì¼ë°˜" class="editable editable-base" contenteditable="true">5</td><td data-field="ì‹œê°„ì œ" class="editable editable-base" contenteditable="true"></td><td data-field="ê²½ì°¨" class="editable editable-base" contenteditable="true"></td><td data-field="ì¥ì• ì¸" class="editable editable-base" contenteditable="true"></td><td data-field="ì „ê¸°ì°¨" class="editable editable-base" contenteditable="true"></td><td class="auto-calc total-col">5</td><td class="auto-calc change-col"></td><td data-field="memo" class="editable editable-desc" contenteditable="true"></td></tr><tr data-row-id="d6"><td data-field="location" class="editable editable-desc" contenteditable="true">6ë™</td><td></td><td data-field="ì¼ë°˜" class="editable editable-base" contenteditable="true">8</td><td data-field="ì‹œê°„ì œ" class="editable editable-base" contenteditable="true"></td><td data-field="ê²½ì°¨" class="editable editable-base" contenteditable="true"></td><td data-field="ì¥ì• ì¸" class="editable editable-base" contenteditable="true"></td><td data-field="ì „ê¸°ì°¨" class="editable editable-base" contenteditable="true"></td><td class="auto-calc total-col">8</td><td class="auto-calc change-col"></td><td data-field="memo" class="editable editable-desc" contenteditable="true"></td></tr><tr data-row-id="d7"><td data-field="location" class="editable editable-desc" contenteditable="true">7ë™</td><td></td><td data-field="ì¼ë°˜" class="editable editable-base cell-modified rev-highlight-0" contenteditable="true">9</td><td data-field="ì‹œê°„ì œ" class="editable editable-base" contenteditable="true"></td><td data-field="ê²½ì°¨" class="editable editable-base" contenteditable="true"></td><td data-field="ì¥ì• ì¸" class="editable editable-base" contenteditable="true"></td><td data-field="ì „ê¸°ì°¨" class="editable editable-base" contenteditable="true"></td><td class="auto-calc total-col">9</td><td class="auto-calc change-col change-positive">+1</td><td data-field="memo" class="editable editable-desc" contenteditable="true"></td></tr><tr data-row-id="d8"><td data-field="location" class="editable editable-desc" contenteditable="true">8ë™(ì§€ìƒí•„ë¡œí‹°)</td><td></td><td data-field="ì¼ë°˜" class="editable editable-base" contenteditable="true">12</td><td data-field="ì‹œê°„ì œ" class="editable editable-base" contenteditable="true"></td><td data-field="ê²½ì°¨" class="editable editable-base" contenteditable="true"></td><td data-field="ì¥ì• ì¸" class="editable editable-base" contenteditable="true"></td><td data-field="ì „ê¸°ì°¨" class="editable editable-base" contenteditable="true"></td><td class="auto-calc total-col">12</td><td class="auto-calc change-col"></td><td data-field="memo" class="editable editable-desc" contenteditable="true">ì¹´íŠ¸ ì¬í™œìš©ë³´ê´€ì¥ìœ¼ë¡œ 2ë©´ ì‚¬ìš©ì œí•œ(ì´ 14ë©´)</td></tr><tr data-row-id="d9"><td data-field="location" class="editable editable-desc" contenteditable="true">8ë™ë’¤ ê²½ì‚¬ë¡œ</td><td></td><td data-field="ì¼ë°˜" class="editable editable-base" contenteditable="true"></td><td data-field="ì‹œê°„ì œ" class="editable editable-base cell-modified rev-highlight-0" contenteditable="true">9</td><td data-field="ê²½ì°¨" class="editable editable-base" contenteditable="true"></td><td data-field="ì¥ì• ì¸" class="editable editable-base" contenteditable="true"></td><td data-field="ì „ê¸°ì°¨" class="editable editable-base" contenteditable="true"></td><td class="auto-calc total-col">9</td><td class="auto-calc change-col change-positive">+2</td><td data-field="memo" class="editable editable-desc" contenteditable="true"></td></tr><tr data-row-id="d10"><td data-field="location" class="editable editable-desc" contenteditable="true">9ë™ ì˜†</td><td></td><td data-field="ì¼ë°˜" class="editable editable-base" contenteditable="true">1</td><td data-field="ì‹œê°„ì œ" class="editable editable-base" contenteditable="true"></td><td data-field="ê²½ì°¨" class="editable editable-base" contenteditable="true"></td><td data-field="ì¥ì• ì¸" class="editable editable-base" contenteditable="true"></td><td data-field="ì „ê¸°ì°¨" class="editable editable-base" contenteditable="true">6</td><td class="auto-calc total-col">7</td><td class="auto-calc change-col"></td><td data-field="memo" class="editable editable-desc" contenteditable="true">ì¬í™œìš©ë³´ê´€ì¥ìœ¼ë¡œ 2ë©´ ì‚¬ìš© ì œí•œ(ì´ 9ë©´)</td></tr><tr data-row-id="d11"><td data-field="location" class="editable editable-desc" contenteditable="true">ë†€ì´í„° ì•</td><td></td><td data-field="ì¼ë°˜" class="editable editable-base" contenteditable="true">34</td><td data-field="ì‹œê°„ì œ" class="editable editable-base" contenteditable="true"></td><td data-field="ê²½ì°¨" class="editable editable-base" contenteditable="true"></td><td data-field="ì¥ì• ì¸" class="editable editable-base" contenteditable="true">1</td><td data-field="ì „ê¸°ì°¨" class="editable editable-base" contenteditable="true"></td><td class="auto-calc total-col">35</td><td class="auto-calc change-col"></td><td data-field="memo" class="editable editable-desc" contenteditable="true">(22/13)</td></tr><tr data-row-id="d12"><td data-field="location" class="editable editable-desc" contenteditable="true">ì„±ë‹¹ë°©í–¥(ì¬í™œìš©ë³´ê´€ì¥ ì•)</td><td></td><td data-field="ì¼ë°˜" class="editable editable-base" contenteditable="true">11</td><td data-field="ì‹œê°„ì œ" class="editable editable-base" contenteditable="true">2</td><td data-field="ê²½ì°¨" class="editable editable-base" contenteditable="true"></td><td data-field="ì¥ì• ì¸" class="editable editable-base" contenteditable="true">1</td><td data-field="ì „ê¸°ì°¨" class="editable editable-base" contenteditable="true"></td><td class="auto-calc total-col">14</td><td class="auto-calc change-col"></td><td data-field="memo" class="editable editable-desc" contenteditable="true">ì¬í™œìš©ë³´ê´€ì¥ìœ¼ë¡œ 2ë©´ ì‹œê°„ì œ</td></tr><tr data-row-id="d13"><td data-field="location" class="editable editable-desc" contenteditable="true">5~8ë™ ì§€í•˜ì£¼ì°¨ì¥</td><td><span class="view-drawing-icon">ğŸ”</span></td><td data-field="ì¼ë°˜" class="editable editable-base cell-modified rev-highlight-0" contenteditable="true">92</td><td data-field="ì‹œê°„ì œ" class="editable editable-base" contenteditable="true">1</td><td data-field="ê²½ì°¨" class="editable editable-base cell-modified rev-highlight-0" contenteditable="true">2</td><td data-field="ì¥ì• ì¸" class="editable editable-base" contenteditable="true"></td><td data-field="ì „ê¸°ì°¨" class="editable editable-base" contenteditable="true"></td><td class="auto-calc total-col">95</td><td class="auto-calc change-col change-positive">+2</td><td data-field="memo" class="editable editable-desc" contenteditable="true">ì…êµ¬ 2ë©´ ì‚¬ìš©ì œí•œ. ì¶œêµ¬ ì°½ê³  ì˜† 1ë©´ ì‹œê°„ì œ(ì´ 95ë©´)</td></tr><tr class="sub-total"><td>ì‚¬íƒ ë° 3ë™ (ì§€ìƒ/ì§€í•˜) ì†Œê³„</td><td></td><td data-sum-col="ì¼ë°˜">271</td><td data-sum-col="ì‹œê°„ì œ">12</td><td data-sum-col="ê²½ì°¨">2</td><td data-sum-col="ì¥ì• ì¸">4</td><td data-sum-col="ì „ê¸°ì°¨">8</td><td data-sum-col="total" class="auto-calc">297</td><td data-sum-col="change" class="auto-calc change-positive">+8</td><td></td></tr><tr class="group-header expanded"><th><span class="group-header-title">ABë™(ì§€ìƒ/ì§€í•˜)</span></th><th><span class="view-drawing-icon">ğŸ”</span></th><th colspan="8"></th></tr><tr data-row-id="ab1"><td data-field="location" class="editable editable-desc" contenteditable="true">Aã†Bë™ ì§€ìƒ</td><td></td><td data-field="ì¼ë°˜" class="editable editable-base" contenteditable="true"></td><td data-field="ì‹œê°„ì œ" class="editable editable-base" contenteditable="true"></td><td data-field="ê²½ì°¨" class="editable editable-base" contenteditable="true">1</td><td data-field="ì¥ì• ì¸" class="editable editable-base" contenteditable="true">5</td><td data-field="ì „ê¸°ì°¨" class="editable editable-base" contenteditable="true"></td><td class="auto-calc total-col">6</td><td class="auto-calc change-col"></td><td data-field="memo" class="editable editable-desc" contenteditable="true"></td></tr><tr data-row-id="ab2"><td data-field="location" class="editable editable-desc" contenteditable="true">Aã†Bë™ B1(ìƒ)</td><td></td><td data-field="ì¼ë°˜" class="editable editable-base" contenteditable="true">38</td><td data-field="ì‹œê°„ì œ" class="editable editable-base" contenteditable="true"></td><td data-field="ê²½ì°¨" class="editable editable-base" contenteditable="true">3</td><td data-field="ì¥ì• ì¸" class="editable editable-base" contenteditable="true"></td><td data-field="ì „ê¸°ì°¨" class="editable editable-base" contenteditable="true"></td><td class="auto-calc total-col">41</td><td class="auto-calc change-col"></td><td data-field="memo" class="editable editable-desc" contenteditable="true"></td></tr><tr data-row-id="ab3"><td data-field="location" class="editable editable-desc" contenteditable="true">1.5~1ì¸µ ê²½ì‚¬ë¡œ</td><td></td><td data-field="ì¼ë°˜" class="editable editable-base" contenteditable="true"></td><td data-field="ì‹œê°„ì œ" class="editable editable-base" contenteditable="true">2</td><td data-field="ê²½ì°¨" class="editable editable-base" contenteditable="true"></td><td data-field="ì¥ì• ì¸" class="editable editable-base" contenteditable="true"></td><td data-field="ì „ê¸°ì°¨" class="editable editable-base" contenteditable="true"></td><td class="auto-calc total-col">2</td><td class="auto-calc change-col"></td><td data-field="memo" class="editable editable-desc" contenteditable="true"></td></tr><tr data-row-id="ab4"><td data-field="location" class="editable editable-desc" contenteditable="true">Aã†Bë™ B1(í•˜)</td><td></td><td data-field="ì¼ë°˜" class="editable editable-base" contenteditable="true">23</td><td data-field="ì‹œê°„ì œ" class="editable editable-base" contenteditable="true"></td><td data-field="ê²½ì°¨" class="editable editable-base" contenteditable="true">3</td><td data-field="ì¥ì• ì¸" class="editable editable-base" contenteditable="true"></td><td data-field="ì „ê¸°ì°¨" class="editable editable-base" contenteditable="true"></td><td class="auto-calc total-col">26</td><td class="auto-calc change-col"></td><td data-field="memo" class="editable editable-desc" contenteditable="true"></td></tr><tr data-row-id="ab5"><td data-field="location" class="editable editable-desc" contenteditable="true">2~1.5ì¸µ ê²½ì‚¬ë¡œ</td><td></td><td data-field="ì¼ë°˜" class="editable editable-base" contenteditable="true"></td><td data-field="ì‹œê°„ì œ" class="editable editable-base" contenteditable="true">2</td><td data-field="ê²½ì°¨" class="editable editable-base" contenteditable="true"></td><td data-field="ì¥ì• ì¸" class="editable editable-base" contenteditable="true"></td><td data-field="ì „ê¸°ì°¨" class="editable editable-base" contenteditable="true"></td><td class="auto-calc total-col">2</td><td class="auto-calc change-col"></td><td data-field="memo" class="editable editable-desc" contenteditable="true"></td></tr><tr data-row-id="ab6"><td data-field="location" class="editable editable-desc" contenteditable="true">Aã†Bë™ B2(ìƒ)</td><td></td><td data-field="ì¼ë°˜" class="editable editable-base" contenteditable="true">38</td><td data-field="ì‹œê°„ì œ" class="editable editable-base" contenteditable="true"></td><td data-field="ê²½ì°¨" class="editable editable-base" contenteditable="true">3</td><td data-field="ì¥ì• ì¸" class="editable editable-base" contenteditable="true"></td><td data-field="ì „ê¸°ì°¨" class="editable editable-base" contenteditable="true"></td><td class="auto-calc total-col">41</td><td class="auto-calc change-col"></td><td data-field="memo" class="editable editable-desc" contenteditable="true"></td></tr><tr data-row-id="ab7"><td data-field="location" class="editable editable-desc" contenteditable="true">2.5~2ì¸µ ê²½ì‚¬ë¡œ</td><td></td><td data-field="ì¼ë°˜" class="editable editable-base" contenteditable="true"></td><td data-field="ì‹œê°„ì œ" class="editable editable-base" contenteditable="true">2</td><td data-field="ê²½ì°¨" class="editable editable-base" contenteditable="true"></td><td data-field="ì¥ì• ì¸" class="editable editable-base" contenteditable="true"></td><td data-field="ì „ê¸°ì°¨" class="editable editable-base" contenteditable="true"></td><td class="auto-calc total-col">2</td><td class="auto-calc change-col"></td><td data-field="memo" class="editable editable-desc" contenteditable="true"></td></tr><tr data-row-id="ab8"><td data-field="location" class="editable editable-desc" contenteditable="true">Aã†Bë™ B2(í•˜)</td><td></td><td data-field="ì¼ë°˜" class="editable editable-base" contenteditable="true">26</td><td data-field="ì‹œê°„ì œ" class="editable editable-base" contenteditable="true"></td><td data-field="ê²½ì°¨" class="editable editable-base" contenteditable="true">3</td><td data-field="ì¥ì• ì¸" class="editable editable-base" contenteditable="true"></td><td data-field="ì „ê¸°ì°¨" class="editable editable-base" contenteditable="true"></td><td class="auto-calc total-col">29</td><td class="auto-calc change-col"></td><td data-field="memo" class="editable editable-desc" contenteditable="true"></td></tr><tr class="sub-total"><td>ABë™ ì†Œê³„</td><td></td><td data-sum-col="ì¼ë°˜">125</td><td data-sum-col="ì‹œê°„ì œ">6</td><td data-sum-col="ê²½ì°¨">13</td><td data-sum-col="ì¥ì• ì¸">5</td><td data-sum-col="ì „ê¸°ì°¨"></td><td data-sum-col="total" class="auto-calc">149</td><td data-sum-col="change" class="auto-calc"></td><td></td></tr><tr class="group-header expanded"><th><span class="group-header-title">101ë™-104ë™(ì§€ìƒ/ì§€í•˜)</span></th><th><span class="view-drawing-icon">ğŸ”</span></th><th colspan="8"></th></tr><tr data-row-id="new1"><td data-field="location" class="editable editable-desc" contenteditable="true">101ë™-104ë™ ì§€ìƒ</td><td></td><td data-field="ì¼ë°˜" class="editable editable-base" contenteditable="true">4</td><td data-field="ì‹œê°„ì œ" class="editable editable-base" contenteditable="true"></td><td data-field="ê²½ì°¨" class="editable editable-base" contenteditable="true"></td><td data-field="ì¥ì• ì¸" class="editable editable-base" contenteditable="true">2</td><td data-field="ì „ê¸°ì°¨" class="editable editable-base" contenteditable="true"></td><td class="auto-calc total-col">6</td><td class="auto-calc change-col"></td><td data-field="memo" class="editable editable-desc" contenteditable="true">ì´ì‚¿ì§, ì‘ì—…ì°¨ëŸ‰, ë¹„ìƒì°¨ëŸ‰ì™¸ ì¶œì…ë¶ˆê°€</td></tr><tr data-row-id="new2"><td data-field="location" class="editable editable-desc" contenteditable="true">101ë™-104ë™ B1</td><td></td><td data-field="ì¼ë°˜" class="editable editable-base cell-modified rev-highlight-0" contenteditable="true">57</td><td data-field="ì‹œê°„ì œ" class="editable editable-base" contenteditable="true"></td><td data-field="ê²½ì°¨" class="editable editable-base cell-modified rev-highlight-0" contenteditable="true"></td><td data-field="ì¥ì• ì¸" class="editable editable-base" contenteditable="true">1</td><td data-field="ì „ê¸°ì°¨" class="editable editable-base" contenteditable="true"></td><td class="auto-calc total-col">58</td><td class="auto-calc change-col change-positive">+1</td><td data-field="memo" class="editable editable-desc" contenteditable="true"></td></tr><tr data-row-id="new3"><td data-field="location" class="editable editable-desc" contenteditable="true">101ë™-104ë™ B2</td><td></td><td data-field="ì¼ë°˜" class="editable editable-base cell-modified rev-highlight-0" contenteditable="true">26</td><td data-field="ì‹œê°„ì œ" class="editable editable-base" contenteditable="true"></td><td data-field="ê²½ì°¨" class="editable editable-base cell-modified rev-highlight-0" contenteditable="true">3</td><td data-field="ì¥ì• ì¸" class="editable editable-base" contenteditable="true"></td><td data-field="ì „ê¸°ì°¨" class="editable editable-base" contenteditable="true"></td><td class="auto-calc total-col">29</td><td class="auto-calc change-col change-negative">-1</td><td data-field="memo" class="editable editable-desc" contenteditable="true"></td></tr><tr class="sub-total"><td>101ë™-104ë™ ì†Œê³„</td><td></td><td data-sum-col="ì¼ë°˜">87</td><td data-sum-col="ì‹œê°„ì œ"></td><td data-sum-col="ê²½ì°¨">3</td><td data-sum-col="ì¥ì• ì¸">3</td><td data-sum-col="ì „ê¸°ì°¨"></td><td data-sum-col="total" class="auto-calc">93</td><td data-sum-col="change" class="auto-calc"></td><td></td></tr><tr class="grand-total"><td>ì „ì²´ í•©ê³„</td><td></td><td data-sum-col="ì¼ë°˜">483</td><td data-sum-col="ì‹œê°„ì œ">18</td><td data-sum-col="ê²½ì°¨">18</td><td data-sum-col="ì¥ì• ì¸">12</td><td data-sum-col="ì „ê¸°ì°¨">8</td><td data-sum-col="total" class="auto-calc">539</td><td data-sum-col="change" class="auto-calc"></td><td></td></tr></tbody>
    </table>
    
    <div id="tooltip" style="display: none; left: 615px; top: 795px;"><strong>Rev 0:</strong> 0<br><strong>Rev 1:</strong> 1</div>

    <div id="revisionHistoryModal" class="modal-overlay" style="display: none;">
        <div id="revisionModalContent" class="modal-content">
            <div class="modal-header">
                <h3>ë³€ê²½ ì´ë ¥ (Revision History)</h3>
                <button class="modal-close-btn" onclick="closeRevisionHistory()">Ã—</button>
            </div>
            <ul id="revision-list"><li>
                <div class="revision-info">
                    <span class="rev-title">Rev 1</span>
                    <span class="rev-timestamp">2025. 8. 4. ì˜¤í›„ 8:36:06</span>
                    <span class="rev-summary"><b>ë³€ê²½ ìš”ì•½:</b> 1ë™: ì¼ë°˜(23â†’24), 3ë™ ì•: ì¼ë°˜(26â†’28), 7ë™: ì¼ë°˜(8â†’9), 8ë™ë’¤ ê²½ì‚¬ë¡œ: ì‹œê°„ì œ(7â†’9), 5~8ë™ ì§€í•˜ì£¼ì°¨ì¥: ì¼ë°˜(82â†’92), 5~8ë™ ì§€í•˜ì£¼ì°¨ì¥: ê²½ì°¨(10â†’2), 101ë™-104ë™ B1: ì¼ë°˜(53â†’57), 101ë™-104ë™ B1: ê²½ì°¨(3â†’0), 101ë™-104ë™ B2: ì¼ë°˜(23â†’26), 101ë™-104ë™ B2: ê²½ì°¨(7â†’3)</span>
                </div>
                <div class="revision-actions">
                    <button class="btn active btn-rev-highlight-0" data-rev-index="0" onclick="viewRevisionChanges(0)">ë³´ê¸° ì·¨ì†Œ</button>
                </div>
            </li></ul>
        </div>
    </div>

    <!-- ìœ í˜• ë³€ê²½ ì§€ì • ëª¨ë‹¬ -->
    <div id="conversionModal" class="modal-overlay">
        <div id="conversionModalContent" class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h3>ìœ í˜• ë³€ê²½ ìƒì„¸ ì§€ì •</h3>
                <button class="modal-close-btn" onclick="closeConversionModal()">Ã—</button>
            </div>
            <div id="conversion-modal-body" style="flex-grow: 1; overflow-y: auto; padding: 20px;">
                <!-- Content will be generated dynamically -->
            </div>
            <div class="modal-footer" style="padding: 15px; border-top: 1px solid #dee2e6; text-align: right;">
                <button class="btn" onclick="applyConversions()">ì ìš©</button>
                <button class="btn" onclick="closeConversionModal()">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>




<script>
    let initialOriginalData = [
    {
        "type": "header",
        "text": "ì‚¬íƒ ë° 3ë™ (ì§€ìƒ/ì§€í•˜)",
        "expanded": false,
        "drawingUrl": "https://jonggunelee.github.io/wyggkr04/ë‹¨ì§€ë‚´ ì£¼ì°¨ ë¼ì¸.pdf"
    },
    {
        "type": "data",
        "id": "d1",
        "location": "1ë™",
        "width": "2140*4000",
        "drawingUrl": "",
        "ì¼ë°˜": 23,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 1,
        "ì „ê¸°ì°¨": 0,
        "memo": "",
        "total": 24,
        "change": 0
    },
    {
        "type": "data",
        "id": "d2",
        "location": "2ë™ ë’¤",
        "width": "2230*3580",
        "drawingUrl": "",
        "ì¼ë°˜": 25,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 0,
        "memo": "2ë™ 1,2ë¼ì¸ë’¤ 1ëŒ€ ì‚¬ìš©ì œí•œ(ì°¨ëŸ‰ í†µë¡œ í™•ë³´)",
        "total": 25,
        "change": 0
    },
    {
        "type": "data",
        "id": "d3",
        "location": "3ë™ ë’¤",
        "width": "2200*4300",
        "drawingUrl": "",
        "ì¼ë°˜": 22,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 2,
        "memo": "",
        "total": 24,
        "change": 0
    },
    {
        "type": "data",
        "id": "d4",
        "location": "3ë™ ì•",
        "width": "2230*4400",
        "drawingUrl": "",
        "ì¼ë°˜": 26,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 1,
        "ì „ê¸°ì°¨": 0,
        "memo": "",
        "total": 27,
        "change": 0
    },
    {
        "type": "data",
        "id": "d5",
        "location": "3ë™ ì˜†(í¸ì˜ì  ì•)",
        "width": "1530*4810",
        "drawingUrl": "",
        "ì¼ë°˜": 5,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 0,
        "memo": "",
        "total": 5,
        "change": 0
    },
    {
        "type": "data",
        "id": "d6",
        "location": "6ë™",
        "width": "1830*4860",
        "drawingUrl": "",
        "ì¼ë°˜": 8,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 0,
        "memo": "",
        "total": 8,
        "change": 0
    },
    {
        "type": "data",
        "id": "d7",
        "location": "7ë™",
        "width": "1810*4250",
        "drawingUrl": "",
        "ì¼ë°˜": 8,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 0,
        "memo": "",
        "total": 8,
        "change": 0
    },
    {
        "type": "data",
        "id": "d8",
        "location": "8ë™(ì§€ìƒí•„ë¡œí‹°)",
        "width": "2000*4810",
        "drawingUrl": "",
        "ì¼ë°˜": 12,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 0,
        "memo": "ì¹´íŠ¸ ì¬í™œìš©ë³´ê´€ì¥ìœ¼ë¡œ 2ë©´ ì‚¬ìš©ì œí•œ(ì´ 14ë©´)",
        "total": 12,
        "change": 0
    },
    {
        "type": "data",
        "id": "d9",
        "location": "8ë™ë’¤ ê²½ì‚¬ë¡œ",
        "width": "",
        "drawingUrl": "",
        "ì¼ë°˜": 0,
        "ì‹œê°„ì œ": 7,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 0,
        "memo": "",
        "total": 7,
        "change": 0
    },
    {
        "type": "data",
        "id": "d10",
        "location": "9ë™ ì˜†",
        "width": "2430*4915(ì™„) 2235*4925(ê¸‰)",
        "drawingUrl": "",
        "ì¼ë°˜": 1,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 6,
        "memo": "ì¬í™œìš©ë³´ê´€ì¥ìœ¼ë¡œ 2ë©´ ì‚¬ìš© ì œí•œ(ì´ 9ë©´)",
        "total": 7,
        "change": 0
    },
    {
        "type": "data",
        "id": "d11",
        "location": "ë†€ì´í„° ì•",
        "width": "2145*4855",
        "drawingUrl": "",
        "ì¼ë°˜": 34,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 1,
        "ì „ê¸°ì°¨": 0,
        "memo": "(22/13)",
        "total": 35,
        "change": 0
    },
    {
        "type": "data",
        "id": "d12",
        "location": "ì„±ë‹¹ë°©í–¥(ì¬í™œìš©ë³´ê´€ì¥ ì•)",
        "width": "2145*4550",
        "drawingUrl": "",
        "ì¼ë°˜": 11,
        "ì‹œê°„ì œ": 2,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 1,
        "ì „ê¸°ì°¨": 0,
        "memo": "ì¬í™œìš©ë³´ê´€ì¥ìœ¼ë¡œ 2ë©´ ì‹œê°„ì œ",
        "total": 14,
        "change": 0
    },
    {
        "type": "data",
        "id": "d13",
        "location": "5~8ë™ ì§€í•˜ì£¼ì°¨ì¥",
        "width": "2465*3980",
        "drawingUrl": "https://photos.app.goo.gl/Caw6BfEFeWVtTQyW9",
        "ì¼ë°˜": 82,
        "ì‹œê°„ì œ": 1,
        "ê²½ì°¨": 10,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 0,
        "memo": "ì…êµ¬ 2ë©´ ì‚¬ìš©ì œí•œ. ì¶œêµ¬ ì°½ê³  ì˜† 1ë©´ ì‹œê°„ì œ(ì´ 95ë©´)",
        "total": 93,
        "change": 0
    },
    {
        "type": "subtotal",
        "for": "ì‚¬íƒ ë° 3ë™ (ì§€ìƒ/ì§€í•˜)",
        "text": "ì‚¬íƒ ë° 3ë™ (ì§€ìƒ/ì§€í•˜) ì†Œê³„"
    },
    {
        "type": "header",
        "text": "ABë™(ì§€ìƒ/ì§€í•˜)",
        "expanded": false,
        "drawingUrl": "https://photos.app.goo.gl/h9EtuBtmzrzp1GQT9"
    },
    {
        "type": "data",
        "id": "ab1",
        "location": "Aã†Bë™ ì§€ìƒ",
        "width": "3190*3755(ì¥ì• ì¸)",
        "drawingUrl": "",
        "ì¼ë°˜": 0,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 1,
        "ì¥ì• ì¸": 5,
        "ì „ê¸°ì°¨": 0,
        "memo": "",
        "total": 6,
        "change": 0
    },
    {
        "type": "data",
        "id": "ab2",
        "location": "Aã†Bë™ B1(ìƒ)",
        "width": "2145*4820",
        "drawingUrl": "",
        "ì¼ë°˜": 38,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 3,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 0,
        "memo": "",
        "total": 41,
        "change": 0
    },
    {
        "type": "data",
        "id": "ab3",
        "location": "1.5~1ì¸µ ê²½ì‚¬ë¡œ",
        "width": "",
        "drawingUrl": "",
        "ì¼ë°˜": 0,
        "ì‹œê°„ì œ": 2,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 0,
        "memo": "",
        "total": 2,
        "change": 0
    },
    {
        "type": "data",
        "id": "ab4",
        "location": "Aã†Bë™ B1(í•˜)",
        "width": "2085*4770",
        "drawingUrl": "",
        "ì¼ë°˜": 23,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 3,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 0,
        "memo": "",
        "total": 26,
        "change": 0
    },
    {
        "type": "data",
        "id": "ab5",
        "location": "2~1.5ì¸µ ê²½ì‚¬ë¡œ",
        "width": "",
        "drawingUrl": "",
        "ì¼ë°˜": 0,
        "ì‹œê°„ì œ": 2,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 0,
        "memo": "",
        "total": 2,
        "change": 0
    },
    {
        "type": "data",
        "id": "ab6",
        "location": "Aã†Bë™ B2(ìƒ)",
        "width": "2075*4800",
        "drawingUrl": "",
        "ì¼ë°˜": 38,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 3,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 0,
        "memo": "",
        "total": 41,
        "change": 0
    },
    {
        "type": "data",
        "id": "ab7",
        "location": "2.5~2ì¸µ ê²½ì‚¬ë¡œ",
        "width": "",
        "drawingUrl": "",
        "ì¼ë°˜": 0,
        "ì‹œê°„ì œ": 2,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 0,
        "memo": "",
        "total": 2,
        "change": 0
    },
    {
        "type": "data",
        "id": "ab8",
        "location": "Aã†Bë™ B2(í•˜)",
        "width": "2085*4785",
        "drawingUrl": "",
        "ì¼ë°˜": 26,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 3,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 0,
        "memo": "",
        "total": 29,
        "change": 0
    },
    {
        "type": "subtotal",
        "for": "ABë™(ì§€ìƒ/ì§€í•˜)",
        "text": "ABë™ ì†Œê³„"
    },
    {
        "type": "header",
        "text": "101ë™-104ë™(ì§€ìƒ/ì§€í•˜)",
        "expanded": false,
        "drawingUrl": "https://photos.app.goo.gl/223evY4uHPUDJdEr9"
    },
    {
        "type": "data",
        "id": "new1",
        "location": "101ë™-104ë™ ì§€ìƒ",
        "width": "2335*4740",
        "drawingUrl": "",
        "ì¼ë°˜": 4,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 2,
        "ì „ê¸°ì°¨": 0,
        "memo": "ì´ì‚¿ì§, ì‘ì—…ì°¨ëŸ‰, ë¹„ìƒì°¨ëŸ‰ì™¸ ì¶œì…ë¶ˆê°€",
        "total": 6,
        "change": 0
    },
    {
        "type": "data",
        "id": "new2",
        "location": "101ë™-104ë™ B1",
        "width": "2170*4710",
        "drawingUrl": "",
        "ì¼ë°˜": 53,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 3,
        "ì¥ì• ì¸": 1,
        "ì „ê¸°ì°¨": 0,
        "memo": "",
        "total": 57,
        "change": 0
    },
    {
        "type": "data",
        "id": "new3",
        "location": "101ë™-104ë™ B2",
        "width": "2155*5000",
        "drawingUrl": "",
        "ì¼ë°˜": 23,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 7,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 0,
        "memo": "",
        "total": 30,
        "change": 0
    },
    {
        "type": "subtotal",
        "for": "101ë™-104ë™(ì§€ìƒ/ì§€í•˜)",
        "text": "101ë™-104ë™ ì†Œê³„"
    },
    {
        "type": "grandtotal",
        "text": "ì „ì²´ í•©ê³„"
    }
];
    let originalData = [
    {
        "type": "header",
        "text": "ì‚¬íƒ ë° 3ë™ (ì§€ìƒ/ì§€í•˜)",
        "expanded": false,
        "drawingUrl": "https://jonggunelee.github.io/wyggkr04/ë‹¨ì§€ë‚´ ì£¼ì°¨ ë¼ì¸.pdf"
    },
    {
        "type": "data",
        "id": "d1",
        "location": "1ë™",
        "width": "2140*4000",
        "drawingUrl": "",
        "ì¼ë°˜": 23,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 1,
        "ì „ê¸°ì°¨": 0,
        "memo": "",
        "total": 24,
        "change": 0
    },
    {
        "type": "data",
        "id": "d2",
        "location": "2ë™ ë’¤",
        "width": "2230*3580",
        "drawingUrl": "",
        "ì¼ë°˜": 25,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 0,
        "memo": "2ë™ 1,2ë¼ì¸ë’¤ 1ëŒ€ ì‚¬ìš©ì œí•œ(ì°¨ëŸ‰ í†µë¡œ í™•ë³´)",
        "total": 25,
        "change": 0
    },
    {
        "type": "data",
        "id": "d3",
        "location": "3ë™ ë’¤",
        "width": "2200*4300",
        "drawingUrl": "",
        "ì¼ë°˜": 22,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 2,
        "memo": "",
        "total": 24,
        "change": 0
    },
    {
        "type": "data",
        "id": "d4",
        "location": "3ë™ ì•",
        "width": "2230*4400",
        "drawingUrl": "",
        "ì¼ë°˜": 26,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 1,
        "ì „ê¸°ì°¨": 0,
        "memo": "",
        "total": 27,
        "change": 0
    },
    {
        "type": "data",
        "id": "d5",
        "location": "3ë™ ì˜†(í¸ì˜ì  ì•)",
        "width": "1530*4810",
        "drawingUrl": "",
        "ì¼ë°˜": 5,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 0,
        "memo": "",
        "total": 5,
        "change": 0
    },
    {
        "type": "data",
        "id": "d6",
        "location": "6ë™",
        "width": "1830*4860",
        "drawingUrl": "",
        "ì¼ë°˜": 8,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 0,
        "memo": "",
        "total": 8,
        "change": 0
    },
    {
        "type": "data",
        "id": "d7",
        "location": "7ë™",
        "width": "1810*4250",
        "drawingUrl": "",
        "ì¼ë°˜": 8,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 0,
        "memo": "",
        "total": 8,
        "change": 0
    },
    {
        "type": "data",
        "id": "d8",
        "location": "8ë™(ì§€ìƒí•„ë¡œí‹°)",
        "width": "2000*4810",
        "drawingUrl": "",
        "ì¼ë°˜": 12,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 0,
        "memo": "ì¹´íŠ¸ ì¬í™œìš©ë³´ê´€ì¥ìœ¼ë¡œ 2ë©´ ì‚¬ìš©ì œí•œ(ì´ 14ë©´)",
        "total": 12,
        "change": 0
    },
    {
        "type": "data",
        "id": "d9",
        "location": "8ë™ë’¤ ê²½ì‚¬ë¡œ",
        "width": "",
        "drawingUrl": "",
        "ì¼ë°˜": 0,
        "ì‹œê°„ì œ": 7,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 0,
        "memo": "",
        "total": 7,
        "change": 0
    },
    {
        "type": "data",
        "id": "d10",
        "location": "9ë™ ì˜†",
        "width": "2430*4915(ì™„) 2235*4925(ê¸‰)",
        "drawingUrl": "",
        "ì¼ë°˜": 1,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 6,
        "memo": "ì¬í™œìš©ë³´ê´€ì¥ìœ¼ë¡œ 2ë©´ ì‚¬ìš© ì œí•œ(ì´ 9ë©´)",
        "total": 7,
        "change": 0
    },
    {
        "type": "data",
        "id": "d11",
        "location": "ë†€ì´í„° ì•",
        "width": "2145*4855",
        "drawingUrl": "",
        "ì¼ë°˜": 34,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 1,
        "ì „ê¸°ì°¨": 0,
        "memo": "(22/13)",
        "total": 35,
        "change": 0
    },
    {
        "type": "data",
        "id": "d12",
        "location": "ì„±ë‹¹ë°©í–¥(ì¬í™œìš©ë³´ê´€ì¥ ì•)",
        "width": "2145*4550",
        "drawingUrl": "",
        "ì¼ë°˜": 11,
        "ì‹œê°„ì œ": 2,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 1,
        "ì „ê¸°ì°¨": 0,
        "memo": "ì¬í™œìš©ë³´ê´€ì¥ìœ¼ë¡œ 2ë©´ ì‹œê°„ì œ",
        "total": 14,
        "change": 0
    },
    {
        "type": "data",
        "id": "d13",
        "location": "5~8ë™ ì§€í•˜ì£¼ì°¨ì¥",
        "width": "2465*3980",
        "drawingUrl": "https://photos.app.goo.gl/Caw6BfEFeWVtTQyW9",
        "ì¼ë°˜": 82,
        "ì‹œê°„ì œ": 1,
        "ê²½ì°¨": 10,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 0,
        "memo": "ì…êµ¬ 2ë©´ ì‚¬ìš©ì œí•œ. ì¶œêµ¬ ì°½ê³  ì˜† 1ë©´ ì‹œê°„ì œ(ì´ 95ë©´)",
        "total": 93,
        "change": 0
    },
    {
        "type": "subtotal",
        "for": "ì‚¬íƒ ë° 3ë™ (ì§€ìƒ/ì§€í•˜)",
        "text": "ì‚¬íƒ ë° 3ë™ (ì§€ìƒ/ì§€í•˜) ì†Œê³„"
    },
    {
        "type": "header",
        "text": "ABë™(ì§€ìƒ/ì§€í•˜)",
        "expanded": false,
        "drawingUrl": "https://photos.app.goo.gl/h9EtuBtmzrzp1GQT9"
    },
    {
        "type": "data",
        "id": "ab1",
        "location": "Aã†Bë™ ì§€ìƒ",
        "width": "3190*3755(ì¥ì• ì¸)",
        "drawingUrl": "",
        "ì¼ë°˜": 0,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 1,
        "ì¥ì• ì¸": 5,
        "ì „ê¸°ì°¨": 0,
        "memo": "",
        "total": 6,
        "change": 0
    },
    {
        "type": "data",
        "id": "ab2",
        "location": "Aã†Bë™ B1(ìƒ)",
        "width": "2145*4820",
        "drawingUrl": "",
        "ì¼ë°˜": 38,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 3,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 0,
        "memo": "",
        "total": 41,
        "change": 0
    },
    {
        "type": "data",
        "id": "ab3",
        "location": "1.5~1ì¸µ ê²½ì‚¬ë¡œ",
        "width": "",
        "drawingUrl": "",
        "ì¼ë°˜": 0,
        "ì‹œê°„ì œ": 2,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 0,
        "memo": "",
        "total": 2,
        "change": 0
    },
    {
        "type": "data",
        "id": "ab4",
        "location": "Aã†Bë™ B1(í•˜)",
        "width": "2085*4770",
        "drawingUrl": "",
        "ì¼ë°˜": 23,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 3,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 0,
        "memo": "",
        "total": 26,
        "change": 0
    },
    {
        "type": "data",
        "id": "ab5",
        "location": "2~1.5ì¸µ ê²½ì‚¬ë¡œ",
        "width": "",
        "drawingUrl": "",
        "ì¼ë°˜": 0,
        "ì‹œê°„ì œ": 2,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 0,
        "memo": "",
        "total": 2,
        "change": 0
    },
    {
        "type": "data",
        "id": "ab6",
        "location": "Aã†Bë™ B2(ìƒ)",
        "width": "2075*4800",
        "drawingUrl": "",
        "ì¼ë°˜": 38,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 3,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 0,
        "memo": "",
        "total": 41,
        "change": 0
    },
    {
        "type": "data",
        "id": "ab7",
        "location": "2.5~2ì¸µ ê²½ì‚¬ë¡œ",
        "width": "",
        "drawingUrl": "",
        "ì¼ë°˜": 0,
        "ì‹œê°„ì œ": 2,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 0,
        "memo": "",
        "total": 2,
        "change": 0
    },
    {
        "type": "data",
        "id": "ab8",
        "location": "Aã†Bë™ B2(í•˜)",
        "width": "2085*4785",
        "drawingUrl": "",
        "ì¼ë°˜": 26,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 3,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 0,
        "memo": "",
        "total": 29,
        "change": 0
    },
    {
        "type": "subtotal",
        "for": "ABë™(ì§€ìƒ/ì§€í•˜)",
        "text": "ABë™ ì†Œê³„"
    },
    {
        "type": "header",
        "text": "101ë™-104ë™(ì§€ìƒ/ì§€í•˜)",
        "expanded": false,
        "drawingUrl": "https://photos.app.goo.gl/223evY4uHPUDJdEr9"
    },
    {
        "type": "data",
        "id": "new1",
        "location": "101ë™-104ë™ ì§€ìƒ",
        "width": "2335*4740",
        "drawingUrl": "",
        "ì¼ë°˜": 4,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 2,
        "ì „ê¸°ì°¨": 0,
        "memo": "ì´ì‚¿ì§, ì‘ì—…ì°¨ëŸ‰, ë¹„ìƒì°¨ëŸ‰ì™¸ ì¶œì…ë¶ˆê°€",
        "total": 6,
        "change": 0
    },
    {
        "type": "data",
        "id": "new2",
        "location": "101ë™-104ë™ B1",
        "width": "2170*4710",
        "drawingUrl": "",
        "ì¼ë°˜": 53,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 3,
        "ì¥ì• ì¸": 1,
        "ì „ê¸°ì°¨": 0,
        "memo": "",
        "total": 57,
        "change": 0
    },
    {
        "type": "data",
        "id": "new3",
        "location": "101ë™-104ë™ B2",
        "width": "2155*5000",
        "drawingUrl": "",
        "ì¼ë°˜": 23,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 7,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 0,
        "memo": "",
        "total": 30,
        "change": 0
    },
    {
        "type": "subtotal",
        "for": "101ë™-104ë™(ì§€ìƒ/ì§€í•˜)",
        "text": "101ë™-104ë™ ì†Œê³„"
    },
    {
        "type": "grandtotal",
        "text": "ì „ì²´ í•©ê³„"
    }
]; 
    let currentData = [
    {
        "type": "header",
        "text": "ì‚¬íƒ ë° 3ë™ (ì§€ìƒ/ì§€í•˜)",
        "expanded": true,
        "drawingUrl": "https://jonggunelee.github.io/wyggkr04/ë‹¨ì§€ë‚´ ì£¼ì°¨ ë¼ì¸.pdf"
    },
    {
        "type": "data",
        "id": "d1",
        "location": "1ë™",
        "width": "2140*4000",
        "drawingUrl": "",
        "ì¼ë°˜": 24,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 1,
        "ì „ê¸°ì°¨": 0,
        "memo": "",
        "total": 25,
        "change": 1
    },
    {
        "type": "data",
        "id": "d2",
        "location": "2ë™ ë’¤",
        "width": "2230*3580",
        "drawingUrl": "",
        "ì¼ë°˜": 25,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 0,
        "memo": "2ë™ 1,2ë¼ì¸ë’¤ 1ëŒ€ ì‚¬ìš©ì œí•œ(ì°¨ëŸ‰ í†µë¡œ í™•ë³´)",
        "total": 25,
        "change": 0
    },
    {
        "type": "data",
        "id": "d3",
        "location": "3ë™ ë’¤",
        "width": "2200*4300",
        "drawingUrl": "",
        "ì¼ë°˜": 22,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 2,
        "memo": "",
        "total": 24,
        "change": 0
    },
    {
        "type": "data",
        "id": "d4",
        "location": "3ë™ ì•",
        "width": "2230*4400",
        "drawingUrl": "",
        "ì¼ë°˜": 28,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 1,
        "ì „ê¸°ì°¨": 0,
        "memo": "",
        "total": 29,
        "change": 2
    },
    {
        "type": "data",
        "id": "d5",
        "location": "3ë™ ì˜†(í¸ì˜ì  ì•)",
        "width": "1530*4810",
        "drawingUrl": "",
        "ì¼ë°˜": 5,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 0,
        "memo": "",
        "total": 5,
        "change": 0
    },
    {
        "type": "data",
        "id": "d6",
        "location": "6ë™",
        "width": "1830*4860",
        "drawingUrl": "",
        "ì¼ë°˜": 8,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 0,
        "memo": "",
        "total": 8,
        "change": 0
    },
    {
        "type": "data",
        "id": "d7",
        "location": "7ë™",
        "width": "1810*4250",
        "drawingUrl": "",
        "ì¼ë°˜": 9,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 0,
        "memo": "",
        "total": 9,
        "change": 1
    },
    {
        "type": "data",
        "id": "d8",
        "location": "8ë™(ì§€ìƒí•„ë¡œí‹°)",
        "width": "2000*4810",
        "drawingUrl": "",
        "ì¼ë°˜": 12,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 0,
        "memo": "ì¹´íŠ¸ ì¬í™œìš©ë³´ê´€ì¥ìœ¼ë¡œ 2ë©´ ì‚¬ìš©ì œí•œ(ì´ 14ë©´)",
        "total": 12,
        "change": 0
    },
    {
        "type": "data",
        "id": "d9",
        "location": "8ë™ë’¤ ê²½ì‚¬ë¡œ",
        "width": "",
        "drawingUrl": "",
        "ì¼ë°˜": 0,
        "ì‹œê°„ì œ": 9,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 0,
        "memo": "",
        "total": 9,
        "change": 2
    },
    {
        "type": "data",
        "id": "d10",
        "location": "9ë™ ì˜†",
        "width": "2430*4915(ì™„) 2235*4925(ê¸‰)",
        "drawingUrl": "",
        "ì¼ë°˜": 1,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 6,
        "memo": "ì¬í™œìš©ë³´ê´€ì¥ìœ¼ë¡œ 2ë©´ ì‚¬ìš© ì œí•œ(ì´ 9ë©´)",
        "total": 7,
        "change": 0
    },
    {
        "type": "data",
        "id": "d11",
        "location": "ë†€ì´í„° ì•",
        "width": "2145*4855",
        "drawingUrl": "",
        "ì¼ë°˜": 34,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 1,
        "ì „ê¸°ì°¨": 0,
        "memo": "(22/13)",
        "total": 35,
        "change": 0
    },
    {
        "type": "data",
        "id": "d12",
        "location": "ì„±ë‹¹ë°©í–¥(ì¬í™œìš©ë³´ê´€ì¥ ì•)",
        "width": "2145*4550",
        "drawingUrl": "",
        "ì¼ë°˜": 11,
        "ì‹œê°„ì œ": 2,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 1,
        "ì „ê¸°ì°¨": 0,
        "memo": "ì¬í™œìš©ë³´ê´€ì¥ìœ¼ë¡œ 2ë©´ ì‹œê°„ì œ",
        "total": 14,
        "change": 0
    },
    {
        "type": "data",
        "id": "d13",
        "location": "5~8ë™ ì§€í•˜ì£¼ì°¨ì¥",
        "width": "2465*3980",
        "drawingUrl": "https://photos.app.goo.gl/Caw6BfEFeWVtTQyW9",
        "ì¼ë°˜": 92,
        "ì‹œê°„ì œ": 1,
        "ê²½ì°¨": 2,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 0,
        "memo": "ì…êµ¬ 2ë©´ ì‚¬ìš©ì œí•œ. ì¶œêµ¬ ì°½ê³  ì˜† 1ë©´ ì‹œê°„ì œ(ì´ 95ë©´)",
        "total": 95,
        "change": 2
    },
    {
        "type": "subtotal",
        "for": "ì‚¬íƒ ë° 3ë™ (ì§€ìƒ/ì§€í•˜)",
        "text": "ì‚¬íƒ ë° 3ë™ (ì§€ìƒ/ì§€í•˜) ì†Œê³„"
    },
    {
        "type": "header",
        "text": "ABë™(ì§€ìƒ/ì§€í•˜)",
        "expanded": true,
        "drawingUrl": "https://photos.app.goo.gl/h9EtuBtmzrzp1GQT9"
    },
    {
        "type": "data",
        "id": "ab1",
        "location": "Aã†Bë™ ì§€ìƒ",
        "width": "3190*3755(ì¥ì• ì¸)",
        "drawingUrl": "",
        "ì¼ë°˜": 0,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 1,
        "ì¥ì• ì¸": 5,
        "ì „ê¸°ì°¨": 0,
        "memo": "",
        "total": 6,
        "change": 0
    },
    {
        "type": "data",
        "id": "ab2",
        "location": "Aã†Bë™ B1(ìƒ)",
        "width": "2145*4820",
        "drawingUrl": "",
        "ì¼ë°˜": 38,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 3,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 0,
        "memo": "",
        "total": 41,
        "change": 0
    },
    {
        "type": "data",
        "id": "ab3",
        "location": "1.5~1ì¸µ ê²½ì‚¬ë¡œ",
        "width": "",
        "drawingUrl": "",
        "ì¼ë°˜": 0,
        "ì‹œê°„ì œ": 2,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 0,
        "memo": "",
        "total": 2,
        "change": 0
    },
    {
        "type": "data",
        "id": "ab4",
        "location": "Aã†Bë™ B1(í•˜)",
        "width": "2085*4770",
        "drawingUrl": "",
        "ì¼ë°˜": 23,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 3,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 0,
        "memo": "",
        "total": 26,
        "change": 0
    },
    {
        "type": "data",
        "id": "ab5",
        "location": "2~1.5ì¸µ ê²½ì‚¬ë¡œ",
        "width": "",
        "drawingUrl": "",
        "ì¼ë°˜": 0,
        "ì‹œê°„ì œ": 2,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 0,
        "memo": "",
        "total": 2,
        "change": 0
    },
    {
        "type": "data",
        "id": "ab6",
        "location": "Aã†Bë™ B2(ìƒ)",
        "width": "2075*4800",
        "drawingUrl": "",
        "ì¼ë°˜": 38,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 3,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 0,
        "memo": "",
        "total": 41,
        "change": 0
    },
    {
        "type": "data",
        "id": "ab7",
        "location": "2.5~2ì¸µ ê²½ì‚¬ë¡œ",
        "width": "",
        "drawingUrl": "",
        "ì¼ë°˜": 0,
        "ì‹œê°„ì œ": 2,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 0,
        "memo": "",
        "total": 2,
        "change": 0
    },
    {
        "type": "data",
        "id": "ab8",
        "location": "Aã†Bë™ B2(í•˜)",
        "width": "2085*4785",
        "drawingUrl": "",
        "ì¼ë°˜": 26,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 3,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 0,
        "memo": "",
        "total": 29,
        "change": 0
    },
    {
        "type": "subtotal",
        "for": "ABë™(ì§€ìƒ/ì§€í•˜)",
        "text": "ABë™ ì†Œê³„"
    },
    {
        "type": "header",
        "text": "101ë™-104ë™(ì§€ìƒ/ì§€í•˜)",
        "expanded": true,
        "drawingUrl": "https://photos.app.goo.gl/223evY4uHPUDJdEr9"
    },
    {
        "type": "data",
        "id": "new1",
        "location": "101ë™-104ë™ ì§€ìƒ",
        "width": "2335*4740",
        "drawingUrl": "",
        "ì¼ë°˜": 4,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 2,
        "ì „ê¸°ì°¨": 0,
        "memo": "ì´ì‚¿ì§, ì‘ì—…ì°¨ëŸ‰, ë¹„ìƒì°¨ëŸ‰ì™¸ ì¶œì…ë¶ˆê°€",
        "total": 6,
        "change": 0
    },
    {
        "type": "data",
        "id": "new2",
        "location": "101ë™-104ë™ B1",
        "width": "2170*4710",
        "drawingUrl": "",
        "ì¼ë°˜": 57,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 0,
        "ì¥ì• ì¸": 1,
        "ì „ê¸°ì°¨": 0,
        "memo": "",
        "total": 58,
        "change": 1
    },
    {
        "type": "data",
        "id": "new3",
        "location": "101ë™-104ë™ B2",
        "width": "2155*5000",
        "drawingUrl": "",
        "ì¼ë°˜": 26,
        "ì‹œê°„ì œ": 0,
        "ê²½ì°¨": 3,
        "ì¥ì• ì¸": 0,
        "ì „ê¸°ì°¨": 0,
        "memo": "",
        "total": 29,
        "change": -1
    },
    {
        "type": "subtotal",
        "for": "101ë™-104ë™(ì§€ìƒ/ì§€í•˜)",
        "text": "101ë™-104ë™ ì†Œê³„"
    },
    {
        "type": "grandtotal",
        "text": "ì „ì²´ í•©ê³„"
    }
]; 
    let revisionHistory = [
    {
        "timestamp": "2025. 8. 4. ì˜¤í›„ 8:36:06",
        "data": [
            {
                "type": "header",
                "text": "ì‚¬íƒ ë° 3ë™ (ì§€ìƒ/ì§€í•˜)",
                "expanded": true,
                "drawingUrl": "https://jonggunelee.github.io/wyggkr04/ë‹¨ì§€ë‚´ ì£¼ì°¨ ë¼ì¸.pdf"
            },
            {
                "type": "data",
                "id": "d1",
                "location": "1ë™",
                "width": "2140*4000",
                "drawingUrl": "",
                "ì¼ë°˜": 24,
                "ì‹œê°„ì œ": 0,
                "ê²½ì°¨": 0,
                "ì¥ì• ì¸": 1,
                "ì „ê¸°ì°¨": 0,
                "memo": "",
                "total": 25,
                "change": 1
            },
            {
                "type": "data",
                "id": "d2",
                "location": "2ë™ ë’¤",
                "width": "2230*3580",
                "drawingUrl": "",
                "ì¼ë°˜": 25,
                "ì‹œê°„ì œ": 0,
                "ê²½ì°¨": 0,
                "ì¥ì• ì¸": 0,
                "ì „ê¸°ì°¨": 0,
                "memo": "2ë™ 1,2ë¼ì¸ë’¤ 1ëŒ€ ì‚¬ìš©ì œí•œ(ì°¨ëŸ‰ í†µë¡œ í™•ë³´)",
                "total": 25,
                "change": 0
            },
            {
                "type": "data",
                "id": "d3",
                "location": "3ë™ ë’¤",
                "width": "2200*4300",
                "drawingUrl": "",
                "ì¼ë°˜": 22,
                "ì‹œê°„ì œ": 0,
                "ê²½ì°¨": 0,
                "ì¥ì• ì¸": 0,
                "ì „ê¸°ì°¨": 2,
                "memo": "",
                "total": 24,
                "change": 0
            },
            {
                "type": "data",
                "id": "d4",
                "location": "3ë™ ì•",
                "width": "2230*4400",
                "drawingUrl": "",
                "ì¼ë°˜": 28,
                "ì‹œê°„ì œ": 0,
                "ê²½ì°¨": 0,
                "ì¥ì• ì¸": 1,
                "ì „ê¸°ì°¨": 0,
                "memo": "",
                "total": 29,
                "change": 2
            },
            {
                "type": "data",
                "id": "d5",
                "location": "3ë™ ì˜†(í¸ì˜ì  ì•)",
                "width": "1530*4810",
                "drawingUrl": "",
                "ì¼ë°˜": 5,
                "ì‹œê°„ì œ": 0,
                "ê²½ì°¨": 0,
                "ì¥ì• ì¸": 0,
                "ì „ê¸°ì°¨": 0,
                "memo": "",
                "total": 5,
                "change": 0
            },
            {
                "type": "data",
                "id": "d6",
                "location": "6ë™",
                "width": "1830*4860",
                "drawingUrl": "",
                "ì¼ë°˜": 8,
                "ì‹œê°„ì œ": 0,
                "ê²½ì°¨": 0,
                "ì¥ì• ì¸": 0,
                "ì „ê¸°ì°¨": 0,
                "memo": "",
                "total": 8,
                "change": 0
            },
            {
                "type": "data",
                "id": "d7",
                "location": "7ë™",
                "width": "1810*4250",
                "drawingUrl": "",
                "ì¼ë°˜": 9,
                "ì‹œê°„ì œ": 0,
                "ê²½ì°¨": 0,
                "ì¥ì• ì¸": 0,
                "ì „ê¸°ì°¨": 0,
                "memo": "",
                "total": 9,
                "change": 1
            },
            {
                "type": "data",
                "id": "d8",
                "location": "8ë™(ì§€ìƒí•„ë¡œí‹°)",
                "width": "2000*4810",
                "drawingUrl": "",
                "ì¼ë°˜": 12,
                "ì‹œê°„ì œ": 0,
                "ê²½ì°¨": 0,
                "ì¥ì• ì¸": 0,
                "ì „ê¸°ì°¨": 0,
                "memo": "ì¹´íŠ¸ ì¬í™œìš©ë³´ê´€ì¥ìœ¼ë¡œ 2ë©´ ì‚¬ìš©ì œí•œ(ì´ 14ë©´)",
                "total": 12,
                "change": 0
            },
            {
                "type": "data",
                "id": "d9",
                "location": "8ë™ë’¤ ê²½ì‚¬ë¡œ",
                "width": "",
                "drawingUrl": "",
                "ì¼ë°˜": 0,
                "ì‹œê°„ì œ": 9,
                "ê²½ì°¨": 0,
                "ì¥ì• ì¸": 0,
                "ì „ê¸°ì°¨": 0,
                "memo": "",
                "total": 9,
                "change": 2
            },
            {
                "type": "data",
                "id": "d10",
                "location": "9ë™ ì˜†",
                "width": "2430*4915(ì™„) 2235*4925(ê¸‰)",
                "drawingUrl": "",
                "ì¼ë°˜": 1,
                "ì‹œê°„ì œ": 0,
                "ê²½ì°¨": 0,
                "ì¥ì• ì¸": 0,
                "ì „ê¸°ì°¨": 6,
                "memo": "ì¬í™œìš©ë³´ê´€ì¥ìœ¼ë¡œ 2ë©´ ì‚¬ìš© ì œí•œ(ì´ 9ë©´)",
                "total": 7,
                "change": 0
            },
            {
                "type": "data",
                "id": "d11",
                "location": "ë†€ì´í„° ì•",
                "width": "2145*4855",
                "drawingUrl": "",
                "ì¼ë°˜": 34,
                "ì‹œê°„ì œ": 0,
                "ê²½ì°¨": 0,
                "ì¥ì• ì¸": 1,
                "ì „ê¸°ì°¨": 0,
                "memo": "(22/13)",
                "total": 35,
                "change": 0
            },
            {
                "type": "data",
                "id": "d12",
                "location": "ì„±ë‹¹ë°©í–¥(ì¬í™œìš©ë³´ê´€ì¥ ì•)",
                "width": "2145*4550",
                "drawingUrl": "",
                "ì¼ë°˜": 11,
                "ì‹œê°„ì œ": 2,
                "ê²½ì°¨": 0,
                "ì¥ì• ì¸": 1,
                "ì „ê¸°ì°¨": 0,
                "memo": "ì¬í™œìš©ë³´ê´€ì¥ìœ¼ë¡œ 2ë©´ ì‹œê°„ì œ",
                "total": 14,
                "change": 0
            },
            {
                "type": "data",
                "id": "d13",
                "location": "5~8ë™ ì§€í•˜ì£¼ì°¨ì¥",
                "width": "2465*3980",
                "drawingUrl": "https://photos.app.goo.gl/Caw6BfEFeWVtTQyW9",
                "ì¼ë°˜": 92,
                "ì‹œê°„ì œ": 1,
                "ê²½ì°¨": 2,
                "ì¥ì• ì¸": 0,
                "ì „ê¸°ì°¨": 0,
                "memo": "ì…êµ¬ 2ë©´ ì‚¬ìš©ì œí•œ. ì¶œêµ¬ ì°½ê³  ì˜† 1ë©´ ì‹œê°„ì œ(ì´ 95ë©´)",
                "total": 95,
                "change": 2
            },
            {
                "type": "subtotal",
                "for": "ì‚¬íƒ ë° 3ë™ (ì§€ìƒ/ì§€í•˜)",
                "text": "ì‚¬íƒ ë° 3ë™ (ì§€ìƒ/ì§€í•˜) ì†Œê³„"
            },
            {
                "type": "header",
                "text": "ABë™(ì§€ìƒ/ì§€í•˜)",
                "expanded": true,
                "drawingUrl": "https://photos.app.goo.gl/h9EtuBtmzrzp1GQT9"
            },
            {
                "type": "data",
                "id": "ab1",
                "location": "Aã†Bë™ ì§€ìƒ",
                "width": "3190*3755(ì¥ì• ì¸)",
                "drawingUrl": "",
                "ì¼ë°˜": 0,
                "ì‹œê°„ì œ": 0,
                "ê²½ì°¨": 1,
                "ì¥ì• ì¸": 5,
                "ì „ê¸°ì°¨": 0,
                "memo": "",
                "total": 6,
                "change": 0
            },
            {
                "type": "data",
                "id": "ab2",
                "location": "Aã†Bë™ B1(ìƒ)",
                "width": "2145*4820",
                "drawingUrl": "",
                "ì¼ë°˜": 38,
                "ì‹œê°„ì œ": 0,
                "ê²½ì°¨": 3,
                "ì¥ì• ì¸": 0,
                "ì „ê¸°ì°¨": 0,
                "memo": "",
                "total": 41,
                "change": 0
            },
            {
                "type": "data",
                "id": "ab3",
                "location": "1.5~1ì¸µ ê²½ì‚¬ë¡œ",
                "width": "",
                "drawingUrl": "",
                "ì¼ë°˜": 0,
                "ì‹œê°„ì œ": 2,
                "ê²½ì°¨": 0,
                "ì¥ì• ì¸": 0,
                "ì „ê¸°ì°¨": 0,
                "memo": "",
                "total": 2,
                "change": 0
            },
            {
                "type": "data",
                "id": "ab4",
                "location": "Aã†Bë™ B1(í•˜)",
                "width": "2085*4770",
                "drawingUrl": "",
                "ì¼ë°˜": 23,
                "ì‹œê°„ì œ": 0,
                "ê²½ì°¨": 3,
                "ì¥ì• ì¸": 0,
                "ì „ê¸°ì°¨": 0,
                "memo": "",
                "total": 26,
                "change": 0
            },
            {
                "type": "data",
                "id": "ab5",
                "location": "2~1.5ì¸µ ê²½ì‚¬ë¡œ",
                "width": "",
                "drawingUrl": "",
                "ì¼ë°˜": 0,
                "ì‹œê°„ì œ": 2,
                "ê²½ì°¨": 0,
                "ì¥ì• ì¸": 0,
                "ì „ê¸°ì°¨": 0,
                "memo": "",
                "total": 2,
                "change": 0
            },
            {
                "type": "data",
                "id": "ab6",
                "location": "Aã†Bë™ B2(ìƒ)",
                "width": "2075*4800",
                "drawingUrl": "",
                "ì¼ë°˜": 38,
                "ì‹œê°„ì œ": 0,
                "ê²½ì°¨": 3,
                "ì¥ì• ì¸": 0,
                "ì „ê¸°ì°¨": 0,
                "memo": "",
                "total": 41,
                "change": 0
            },
            {
                "type": "data",
                "id": "ab7",
                "location": "2.5~2ì¸µ ê²½ì‚¬ë¡œ",
                "width": "",
                "drawingUrl": "",
                "ì¼ë°˜": 0,
                "ì‹œê°„ì œ": 2,
                "ê²½ì°¨": 0,
                "ì¥ì• ì¸": 0,
                "ì „ê¸°ì°¨": 0,
                "memo": "",
                "total": 2,
                "change": 0
            },
            {
                "type": "data",
                "id": "ab8",
                "location": "Aã†Bë™ B2(í•˜)",
                "width": "2085*4785",
                "drawingUrl": "",
                "ì¼ë°˜": 26,
                "ì‹œê°„ì œ": 0,
                "ê²½ì°¨": 3,
                "ì¥ì• ì¸": 0,
                "ì „ê¸°ì°¨": 0,
                "memo": "",
                "total": 29,
                "change": 0
            },
            {
                "type": "subtotal",
                "for": "ABë™(ì§€ìƒ/ì§€í•˜)",
                "text": "ABë™ ì†Œê³„"
            },
            {
                "type": "header",
                "text": "101ë™-104ë™(ì§€ìƒ/ì§€í•˜)",
                "expanded": true,
                "drawingUrl": "https://photos.app.goo.gl/223evY4uHPUDJdEr9"
            },
            {
                "type": "data",
                "id": "new1",
                "location": "101ë™-104ë™ ì§€ìƒ",
                "width": "2335*4740",
                "drawingUrl": "",
                "ì¼ë°˜": 4,
                "ì‹œê°„ì œ": 0,
                "ê²½ì°¨": 0,
                "ì¥ì• ì¸": 2,
                "ì „ê¸°ì°¨": 0,
                "memo": "ì´ì‚¿ì§, ì‘ì—…ì°¨ëŸ‰, ë¹„ìƒì°¨ëŸ‰ì™¸ ì¶œì…ë¶ˆê°€",
                "total": 6,
                "change": 0
            },
            {
                "type": "data",
                "id": "new2",
                "location": "101ë™-104ë™ B1",
                "width": "2170*4710",
                "drawingUrl": "",
                "ì¼ë°˜": 57,
                "ì‹œê°„ì œ": 0,
                "ê²½ì°¨": 0,
                "ì¥ì• ì¸": 1,
                "ì „ê¸°ì°¨": 0,
                "memo": "",
                "total": 58,
                "change": 1
            },
            {
                "type": "data",
                "id": "new3",
                "location": "101ë™-104ë™ B2",
                "width": "2155*5000",
                "drawingUrl": "",
                "ì¼ë°˜": 26,
                "ì‹œê°„ì œ": 0,
                "ê²½ì°¨": 3,
                "ì¥ì• ì¸": 0,
                "ì „ê¸°ì°¨": 0,
                "memo": "",
                "total": 29,
                "change": -1
            },
            {
                "type": "subtotal",
                "for": "101ë™-104ë™(ì§€ìƒ/ì§€í•˜)",
                "text": "101ë™-104ë™ ì†Œê³„"
            },
            {
                "type": "grandtotal",
                "text": "ì „ì²´ í•©ê³„"
            }
        ],
        "summary": "1ë™: ì¼ë°˜(23â†’24), 3ë™ ì•: ì¼ë°˜(26â†’28), 7ë™: ì¼ë°˜(8â†’9), 8ë™ë’¤ ê²½ì‚¬ë¡œ: ì‹œê°„ì œ(7â†’9), 5~8ë™ ì§€í•˜ì£¼ì°¨ì¥: ì¼ë°˜(82â†’92), 5~8ë™ ì§€í•˜ì£¼ì°¨ì¥: ê²½ì°¨(10â†’2), 101ë™-104ë™ B1: ì¼ë°˜(53â†’57), 101ë™-104ë™ B1: ê²½ì°¨(3â†’0), 101ë™-104ë™ B2: ì¼ë°˜(23â†’26), 101ë™-104ë™ B2: ê²½ì°¨(7â†’3)"
    }
];
    let userDefinedConversions = {};
    let parkingTypes = ["ì¼ë°˜","ì‹œê°„ì œ","ê²½ì°¨","ì¥ì• ì¸","ì „ê¸°ì°¨"];
    let activeRevisionIndices = [0]; 
    let isHighlighting = true;
    let allGroupsExpanded = true;
    let originalDataMap = {}; 
    let historyStack = []; 
    let redoStack = []; 
    
    function initializeData() {
    userDefinedConversions = {};
    const baseData = [
        { type: 'header', text: 'ì‚¬íƒ ë° 3ë™ (ì§€ìƒ/ì§€í•˜)', expanded: false, drawingUrl: 'https://jonggunelee.github.io/wyggkr04/ë‹¨ì§€ë‚´ ì£¼ì°¨ ë¼ì¸.pdf'},
        { type: 'data', id:'d1', location: '1ë™', width: '2140*4000', drawingUrl: '', ì¼ë°˜: 23, ì‹œê°„ì œ: 0, ê²½ì°¨: 0, ì¥ì• ì¸: 1, ì „ê¸°ì°¨: 0, memo: ''},
        { type: 'data', id:'d2', location: '2ë™ ë’¤', width: '2230*3580', drawingUrl: '', ì¼ë°˜: 25, ì‹œê°„ì œ: 0, ê²½ì°¨: 0, ì¥ì• ì¸: 0, ì „ê¸°ì°¨: 0, memo: '2ë™ 1,2ë¼ì¸ë’¤ 1ëŒ€ ì‚¬ìš©ì œí•œ(ì°¨ëŸ‰ í†µë¡œ í™•ë³´)'},
        { type: 'data', id:'d3', location: '3ë™ ë’¤', width: '2200*4300', drawingUrl: '', ì¼ë°˜: 22, ì‹œê°„ì œ: 0, ê²½ì°¨: 0, ì¥ì• ì¸: 0, ì „ê¸°ì°¨: 2, memo: ''},
        { type: 'data', id:'d4', location: '3ë™ ì•', width: '2230*4400', drawingUrl: '', ì¼ë°˜: 26, ì‹œê°„ì œ: 0, ê²½ì°¨: 0, ì¥ì• ì¸: 1, ì „ê¸°ì°¨: 0, memo: ''},
        { type: 'data', id:'d5', location: '3ë™ ì˜†(í¸ì˜ì  ì•)', width: '1530*4810', drawingUrl: '', ì¼ë°˜: 5, ì‹œê°„ì œ: 0, ê²½ì°¨: 0, ì¥ì• ì¸: 0, ì „ê¸°ì°¨: 0, memo: ''},
        { type: 'data', id:'d6', location: '6ë™', width: '1830*4860', drawingUrl: '', ì¼ë°˜: 8, ì‹œê°„ì œ: 0, ê²½ì°¨: 0, ì¥ì• ì¸: 0, ì „ê¸°ì°¨: 0, memo: ''},
        { type: 'data', id:'d7', location: '7ë™', width: '1810*4250', drawingUrl: '', ì¼ë°˜: 8, ì‹œê°„ì œ: 0, ê²½ì°¨: 0, ì¥ì• ì¸: 0, ì „ê¸°ì°¨: 0, memo: ''},
        { type: 'data', id:'d8', location: '8ë™(ì§€ìƒí•„ë¡œí‹°)', width: '2000*4810', drawingUrl: '', ì¼ë°˜: 12, ì‹œê°„ì œ: 0, ê²½ì°¨: 0, ì¥ì• ì¸: 0, ì „ê¸°ì°¨: 0, memo: 'ì¹´íŠ¸ ì¬í™œìš©ë³´ê´€ì¥ìœ¼ë¡œ 2ë©´ ì‚¬ìš©ì œí•œ(ì´ 14ë©´)'},
        { type: 'data', id:'d9', location: '8ë™ë’¤ ê²½ì‚¬ë¡œ', width: '', drawingUrl: '', ì¼ë°˜: 0, ì‹œê°„ì œ: 7, ê²½ì°¨: 0, ì¥ì• ì¸: 0, ì „ê¸°ì°¨: 0, memo: ''},
        { type: 'data', id:'d10', location: '9ë™ ì˜†', width: '2430*4915(ì™„) 2235*4925(ê¸‰)', drawingUrl: '', ì¼ë°˜: 1, ì‹œê°„ì œ: 0, ê²½ì°¨: 0, ì¥ì• ì¸: 0, ì „ê¸°ì°¨: 6, memo: 'ì¬í™œìš©ë³´ê´€ì¥ìœ¼ë¡œ 2ë©´ ì‚¬ìš© ì œí•œ(ì´ 9ë©´)'},
        { type: 'data', id:'d11', location: 'ë†€ì´í„° ì•', width: '2145*4855', drawingUrl: '', ì¼ë°˜: 34, ì‹œê°„ì œ: 0, ê²½ì°¨: 0, ì¥ì• ì¸: 1, ì „ê¸°ì°¨: 0, memo: '(22/13)'},
        { type: 'data', id:'d12', location: 'ì„±ë‹¹ë°©í–¥(ì¬í™œìš©ë³´ê´€ì¥ ì•)', width: '2145*4550', drawingUrl: '', ì¼ë°˜: 11, ì‹œê°„ì œ: 2, ê²½ì°¨: 0, ì¥ì• ì¸: 1, ì „ê¸°ì°¨: 0, memo: 'ì¬í™œìš©ë³´ê´€ì¥ìœ¼ë¡œ 2ë©´ ì‹œê°„ì œ'},
        { type: 'data', id:'d13', location: '5~8ë™ ì§€í•˜ì£¼ì°¨ì¥', width: '2465*3980', drawingUrl: 'https://photos.app.goo.gl/Caw6BfEFeWVtTQyW9', ì¼ë°˜: 82, ì‹œê°„ì œ: 1, ê²½ì°¨: 10, ì¥ì• ì¸: 0, ì „ê¸°ì°¨: 0, memo: 'ì…êµ¬ 2ë©´ ì‚¬ìš©ì œí•œ. ì¶œêµ¬ ì°½ê³  ì˜† 1ë©´ ì‹œê°„ì œ(ì´ 95ë©´)'},
        { type: 'subtotal', for: 'ì‚¬íƒ ë° 3ë™ (ì§€ìƒ/ì§€í•˜)', text: 'ì‚¬íƒ ë° 3ë™ (ì§€ìƒ/ì§€í•˜) ì†Œê³„' },
        { type: 'header', text: 'ABë™(ì§€ìƒ/ì§€í•˜)', expanded: false, drawingUrl: 'https://photos.app.goo.gl/h9EtuBtmzrzp1GQT9'},
        { type: 'data', id:'ab1', location: 'Aã†Bë™ ì§€ìƒ', width: '3190*3755(ì¥ì• ì¸)', drawingUrl: '', ì¼ë°˜: 0, ì‹œê°„ì œ: 0, ê²½ì°¨: 1, ì¥ì• ì¸: 5, ì „ê¸°ì°¨: 0, memo: ''},
        { type: 'data', id:'ab2', location: 'Aã†Bë™ B1(ìƒ)', width: '2145*4820', drawingUrl: '', ì¼ë°˜: 38, ì‹œê°„ì œ: 0, ê²½ì°¨: 3, ì¥ì• ì¸: 0, ì „ê¸°ì°¨: 0, memo: ''},
        { type: 'data', id:'ab3', location: '1.5~1ì¸µ ê²½ì‚¬ë¡œ', width: '', drawingUrl: '', ì¼ë°˜: 0, ì‹œê°„ì œ: 2, ê²½ì°¨: 0, ì¥ì• ì¸: 0, ì „ê¸°ì°¨: 0, memo: ''},
        { type: 'data', id:'ab4', location: 'Aã†Bë™ B1(í•˜)', width: '2085*4770', drawingUrl: '', ì¼ë°˜: 23, ì‹œê°„ì œ: 0, ê²½ì°¨: 3, ì¥ì• ì¸: 0, ì „ê¸°ì°¨: 0, memo: ''},
        { type: 'data', id:'ab5', location: '2~1.5ì¸µ ê²½ì‚¬ë¡œ', width: '', drawingUrl: '', ì¼ë°˜: 0, ì‹œê°„ì œ: 2, ê²½ì°¨: 0, ì¥ì• ì¸: 0, ì „ê¸°ì°¨: 0, memo: ''},
        { type: 'data', id:'ab6', location: 'Aã†Bë™ B2(ìƒ)', width: '2075*4800', drawingUrl: '', ì¼ë°˜: 38, ì‹œê°„ì œ: 0, ê²½ì°¨: 3, ì¥ì• ì¸: 0, ì „ê¸°ì°¨: 0, memo: ''},
        { type: 'data', id:'ab7', location: '2.5~2ì¸µ ê²½ì‚¬ë¡œ', width: '', drawingUrl: '', ì¼ë°˜: 0, ì‹œê°„ì œ: 2, ê²½ì°¨: 0, ì¥ì• ì¸: 0, ì „ê¸°ì°¨: 0, memo: ''},
        { type: 'data', id:'ab8', location: 'Aã†Bë™ B2(í•˜)', width: '2085*4785', drawingUrl: '', ì¼ë°˜: 26, ì‹œê°„ì œ: 0, ê²½ì°¨: 3, ì¥ì• ì¸: 0, ì „ê¸°ì°¨: 0, memo: ''},
        { type: 'subtotal', for: 'ABë™(ì§€ìƒ/ì§€í•˜)', text: 'ABë™ ì†Œê³„' },
        { type: 'header', text: '101ë™-104ë™(ì§€ìƒ/ì§€í•˜)', expanded: false, drawingUrl: 'https://photos.app.goo.gl/223evY4uHPUDJdEr9'},
        { type: 'data', id:'new1', location: '101ë™-104ë™ ì§€ìƒ', width: '2335*4740', drawingUrl: '', ì¼ë°˜: 4, ì‹œê°„ì œ: 0, ê²½ì°¨: 0, ì¥ì• ì¸: 2, ì „ê¸°ì°¨: 0, memo: 'ì´ì‚¿ì§, ì‘ì—…ì°¨ëŸ‰, ë¹„ìƒì°¨ëŸ‰ì™¸ ì¶œì…ë¶ˆê°€'},
        { type: 'data', id:'new2', location: '101ë™-104ë™ B1', width: '2170*4710', drawingUrl: '', ì¼ë°˜: 53, ì‹œê°„ì œ: 0, ê²½ì°¨: 3, ì¥ì• ì¸: 1, ì „ê¸°ì°¨: 0, memo: ''},
        { type: 'data', id:'new3', location: '101ë™-104ë™ B2', width: '2155*5000', drawingUrl: '', ì¼ë°˜: 23, ì‹œê°„ì œ: 0, ê²½ì°¨: 7, ì¥ì• ì¸: 0, ì „ê¸°ì°¨: 0, memo: ''},
        { type: 'subtotal', for: '101ë™-104ë™(ì§€ìƒ/ì§€í•˜)', text: '101ë™-104ë™ ì†Œê³„' },
        { type: 'grandtotal', text: 'ì „ì²´ í•©ê³„' },
    ];
    initialOriginalData = JSON.parse(JSON.stringify(baseData));
    initializeDataFromUpload(baseData, false);
}

function findDataIndexById(id) { return currentData.findIndex(item => item.id === id); }

function updateRow(id, field, value) {
    const index = findDataIndexById(id);
    if (index === -1) return;

    const item = currentData[index];
    const isNumeric = parkingTypes.includes(field);
    const oldValue = item[field];
    const newValue = isNumeric ? (parseInt(String(value).trim(), 10) || 0) : value;
    
    if (oldValue !== newValue) {
        pushHistory(); 
        item[field] = newValue;
        renderAll();
    }
}

function renderAll() {
    let comparisonData;
    let baseForComparison;
    let currentLabel, previousLabel;
    const hasUnsavedChanges = historyStack.length > 0;

    const findBase = (data) => {
        if (!data || JSON.stringify(data) === JSON.stringify(initialOriginalData)) return initialOriginalData;
        const index = revisionHistory.findIndex(rev => JSON.stringify(rev.data) === JSON.stringify(data));
        if (index > 0) return revisionHistory[index - 1].data;
        if (index === 0) return initialOriginalData;
        if (revisionHistory.length > 0 && JSON.stringify(data) === JSON.stringify(revisionHistory[revisionHistory.length - 1].data)) {
            return revisionHistory.length > 1 ? revisionHistory[revisionHistory.length - 2].data : initialOriginalData;
        }
        return initialOriginalData;
    };

    if (hasUnsavedChanges) {
        comparisonData = originalData;
        previousLabel = "ì´ì „ ê°’";
        currentLabel = "í˜„ì¬ ê°’";
    } else if (revisionHistory.length > 0) {
        if (isHighlighting && activeRevisionIndices.length > 0) {
            const latestActiveIndex = Math.max(...activeRevisionIndices);
            currentLabel = `Rev ${latestActiveIndex + 1}`;
            previousLabel = (latestActiveIndex > 0) ? `Rev ${latestActiveIndex}` : "Rev 0";
            comparisonData = (latestActiveIndex > 0) ? revisionHistory[latestActiveIndex - 1].data : initialOriginalData;
        } else {
            comparisonData = originalData;
            previousLabel = "ì›ë³¸ ê°’";
            currentLabel = "í˜„ì¬ ê°’";
        }
    } else {
        comparisonData = initialOriginalData;
        previousLabel = "Rev 0";
        currentLabel = "í˜„ì¬ê°’";
    }
    
    baseForComparison = findBase(comparisonData) || initialOriginalData;

    const currentChanges = calculateAllChanges(currentData, originalData);
    const comparisonChanges = calculateAllChanges(comparisonData, baseForComparison);
    const initialChanges = calculateAllChanges(initialOriginalData, initialOriginalData);

    const currentMetrics = calculateMetrics(currentData, originalData);
    const comparisonMetrics = calculateMetrics(comparisonData, baseForComparison);
    const initialMetrics = calculateMetrics(initialOriginalData, initialOriginalData);
    
    const grandTotal = { ...currentData.find(item => item.type === 'grandtotal') };
    const grandChangeDetails = currentChanges.netTypeChanges;
    
    const formatZeroAsDash = (value) => (value === 0 ? '-' : value);

    applyChangeTracking(document.getElementById('kpi-total-spots'), currentMetrics.grandTotal.total, comparisonMetrics.grandTotal.total, initialMetrics.grandTotal.total, currentLabel, previousLabel);
    document.getElementById('kpi-total-spots').textContent = formatZeroAsDash(currentMetrics.grandTotal.total);
    
    applyChangeTracking(document.getElementById('kpi-new-spots'), currentChanges.netNewSpots, comparisonChanges.netNewSpots, initialChanges.netNewSpots, currentLabel, previousLabel);
    document.getElementById('kpi-new-spots').textContent = formatZeroAsDash(currentChanges.netNewSpots);

    applyChangeTracking(document.getElementById('kpi-removed-spots'), currentChanges.netRemovedSpots, comparisonChanges.netRemovedSpots, initialChanges.netRemovedSpots, currentLabel, previousLabel);
    document.getElementById('kpi-removed-spots').textContent = formatZeroAsDash(currentChanges.netRemovedSpots);
    
    applyChangeTracking(document.getElementById('kpi-gross-new-spots'), currentChanges.grossNew, comparisonChanges.grossNew, initialChanges.grossNew, currentLabel, previousLabel);
    document.getElementById('kpi-gross-new-spots').textContent = formatZeroAsDash(currentChanges.grossNew);

    applyChangeTracking(document.getElementById('kpi-gross-removed-spots'), currentChanges.grossRemoved, comparisonChanges.grossRemoved, initialChanges.grossRemoved, currentLabel, previousLabel);
    document.getElementById('kpi-gross-removed-spots').textContent = formatZeroAsDash(currentChanges.grossRemoved);
    
    applyChangeTracking(document.getElementById('kpi-type-conversion-spots'), currentChanges.typeConversion, comparisonChanges.typeConversion, initialChanges.typeConversion, currentLabel, previousLabel);
    document.getElementById('kpi-type-conversion-spots').textContent = formatZeroAsDash(currentChanges.typeConversion);

    const hierarchyFormatter = val => val > 0 ? `+${val}` : `${val}`;
    const conversionFormatter = val => `${val}ë©´`;

    renderKpiDetailsWithTracking(document.getElementById('kpi-new-spots-details'), currentChanges.netNewByHierarchy, comparisonChanges.netNewByHierarchy, initialChanges.netNewByHierarchy, currentLabel, previousLabel, 'change-positive', hierarchyFormatter);
    renderKpiDetailsWithTracking(document.getElementById('kpi-removed-spots-details'), currentChanges.netRemovedByHierarchy, comparisonChanges.netRemovedByHierarchy, initialChanges.netRemovedByHierarchy, currentLabel, previousLabel, 'change-negative', hierarchyFormatter);
    renderKpiDetailsWithTracking(document.getElementById('kpi-gross-new-spots-details'), currentChanges.grossNewByHierarchy, comparisonChanges.grossNewByHierarchy, initialChanges.grossNewByHierarchy, currentLabel, previousLabel, 'change-positive', hierarchyFormatter);
    renderKpiDetailsWithTracking(document.getElementById('kpi-gross-removed-spots-details'), currentChanges.grossRemovedByHierarchy, comparisonChanges.grossRemovedByHierarchy, initialChanges.grossRemovedByHierarchy, currentLabel, previousLabel, 'change-negative', hierarchyFormatter);
    renderKpiDetailsWithTracking(document.getElementById('kpi-type-conversion-spots-details'), currentChanges.conversionDetails, comparisonChanges.conversionDetails, initialChanges.conversionDetails, currentLabel, previousLabel, '', conversionFormatter);


    const buildingSummary = document.getElementById('kpi-building-summary');
    buildingSummary.innerHTML = '';
    currentData.filter(item => item.type === 'header').forEach(header => {
        const groupName = header.text;
        const currentValue = currentMetrics.buildingTotals[groupName] || 0;
        buildingSummary.innerHTML += `<div class="kpi-summary-item">
            <div class="label">${groupName}</div>
            <div class="value" data-summary-building="${groupName}">${formatZeroAsDash(currentValue)}</div>
        </div>`;
    });
    currentData.filter(item => item.type === 'header').forEach(header => {
        const groupName = header.text;
        const element = buildingSummary.querySelector(`[data-summary-building="${groupName}"]`);
        if (element) {
            applyChangeTracking(element, currentMetrics.buildingTotals[groupName] || 0, comparisonMetrics.buildingTotals[groupName] || 0, initialMetrics.buildingTotals[groupName] || 0, currentLabel, previousLabel);
        }
    });

    const detailListDynamic = document.getElementById('detail-list-dynamic');
    detailListDynamic.innerHTML = '';
    parkingTypes.forEach(type => {
        const changeValue = grandChangeDetails[type] || 0;
        let valueHtml = formatZeroAsDash(changeValue);
        let className = '';
        if (changeValue > 0) { valueHtml = `+${changeValue}`; className = 'change-positive'; }
        if (changeValue < 0) { className = 'change-negative'; }
        detailListDynamic.innerHTML += `<span>${type}: <b data-change-type="${type}" class="${className}">${valueHtml}</b></span>`;
    });
    parkingTypes.forEach(type => {
        const element = detailListDynamic.querySelector(`[data-change-type="${type}"]`);
        if (element) {
            applyChangeTracking(element, grandChangeDetails[type] || 0, comparisonChanges.netTypeChanges[type] || 0, initialChanges.netTypeChanges[type] || 0, currentLabel, previousLabel);
        }
    });

    const groupDetailsSummary = document.getElementById('kpi-group-details-summary');
    let headerHtml = `<div class="group-detail-item header"><span>êµ¬ë¶„</span></div>`;
    parkingTypes.forEach(type => headerHtml += `<div class="group-detail-item header"><span>${type}</span></div>`);
    let groupDetailsHtml = `<div class="group-detail-row">${headerHtml}</div>`;
    
    currentData.filter(item => item.type === 'header').forEach(header => {
        const groupName = header.text;
        const details = currentMetrics.buildingDetails[groupName];
        let rowHtml = `<div class="group-detail-item"><span>${groupName}</span></div>`;
        if (details) {
            parkingTypes.forEach(type => {
                rowHtml += `<div class="group-detail-item"><span class="value" data-group-value="${groupName}-${type}">${formatZeroAsDash(details[type])}</span></div>`;
            });
        }
        groupDetailsHtml += `<div class="group-detail-row" data-group-detail="${groupName}">${rowHtml}</div>`;
    });

    let totalRowHtml = `<div class="group-detail-item"><span>ì „ì²´ í•©ê³„</span></div>`;
    parkingTypes.forEach(type => {
        totalRowHtml += `<div class="group-detail-item"><span class="value" data-group-total-value="${type}">${formatZeroAsDash(currentMetrics.grandTotal[type])}</span></div>`;
    });
    groupDetailsHtml += `<div class="group-detail-row total-row">${totalRowHtml}</div>`;
    groupDetailsSummary.innerHTML = groupDetailsHtml;

    currentData.filter(item => item.type === 'header').forEach(header => {
        const groupName = header.text;
        parkingTypes.forEach(type => {
            const element = groupDetailsSummary.querySelector(`[data-group-value="${groupName}-${type}"]`);
            if (element) {
                const currentValue = (currentMetrics.buildingDetails[groupName] || {})[type] || 0;
                const previousValue = (comparisonMetrics.buildingDetails[groupName] || {})[type] || 0;
                const initialValue = (initialMetrics.buildingDetails[groupName] || {})[type] || 0;
                applyChangeTracking(element, currentValue, previousValue, initialValue, currentLabel, previousLabel);
            }
        });
    });
    parkingTypes.forEach(type => {
        const element = groupDetailsSummary.querySelector(`[data-group-total-value="${type}"]`);
        if (element) {
             applyChangeTracking(element, currentMetrics.grandTotal[type] || 0, comparisonMetrics.grandTotal[type] || 0, initialMetrics.grandTotal[type] || 0, currentLabel, previousLabel);
        }
    });
    
    const tableHead = document.querySelector('#parkingStatusTable thead');
    const tableBody = document.querySelector('#parkingStatusTable tbody');
    let headContent = `<tr><th style="width:20%">êµ¬ë¶„</th><th style="width:5%">ë„ë©´</th>`;
    parkingTypes.forEach(type => headContent += `<th>${type}</th>`);
    headContent += `<th class="auto-calc" style="width:8%">í•©ê³„</th><th class="auto-calc" style="width:8%">ì¦ê°</th><th style="width:24%">ë¹„ê³ </th></tr>`;
    tableHead.innerHTML = headContent;
    
    tableBody.innerHTML = ''; 

    let currentGroupHeader = null;
    currentData.forEach((item, index) => {
        if (item.type === 'header') {
            currentGroupHeader = item;
            const tr = document.createElement('tr');
            tr.className = `group-header ${item.expanded ? 'expanded' : ''}`;
            
            const th1 = document.createElement('th');
            const titleSpan = document.createElement('span');
            titleSpan.className = 'group-header-title';
            titleSpan.onclick = () => toggleGroup(index);
            titleSpan.textContent = item.text;
            th1.appendChild(titleSpan);

            const th2 = document.createElement('th');
            if (item.drawingUrl) {
                const drawingIcon = document.createElement('span');
                drawingIcon.className = 'view-drawing-icon';
                drawingIcon.textContent = 'ğŸ”';
                drawingIcon.onclick = (e) => { e.stopPropagation(); openDrawingLink(item.drawingUrl); };
                th2.appendChild(drawingIcon);
            }

            const th3 = document.createElement('th');
            th3.colSpan = parkingTypes.length + 3;

            tr.appendChild(th1);
            tr.appendChild(th2);
            tr.appendChild(th3);
            tableBody.appendChild(tr);

        } else if (item.type === 'data') {
            const originalItem = originalDataMap[item.id] || {};
            
            const tr = document.createElement('tr');
            if (currentGroupHeader && !currentGroupHeader.expanded) {
                tr.classList.add('collapsed');
            }
            tr.dataset.rowId = item.id;

            const tdLocation = document.createElement('td');
            tdLocation.dataset.field = 'location';
            tdLocation.classList.add('editable', 'editable-desc');
            if (originalItem.location !== item.location && hasUnsavedChanges) tdLocation.classList.add('cell-unsaved-change');
            tdLocation.contentEditable = true;
            tdLocation.textContent = item.location || '';
            tr.appendChild(tdLocation);

            const tdDrawing = document.createElement('td');
            if (item.drawingUrl) {
                const drawingIcon = document.createElement('span');
                drawingIcon.className = 'view-drawing-icon';
                drawingIcon.textContent = 'ğŸ”';
                drawingIcon.onclick = () => openDrawingLink(item.drawingUrl);
                tdDrawing.appendChild(drawingIcon);
            }
            tr.appendChild(tdDrawing);

            parkingTypes.forEach(type => {
                const cell = document.createElement('td');
                cell.dataset.field = type;
                cell.classList.add('editable', 'editable-base');
                if ((item[type] || 0) !== (originalItem[type] || 0) && hasUnsavedChanges) cell.classList.add('cell-unsaved-change');
                cell.contentEditable = true;
                cell.textContent = item[type] === 0 ? '' : item[type] || '';
                tr.appendChild(cell);
            });

            const tdTotal = document.createElement('td');
            tdTotal.className = 'auto-calc total-col';
            tdTotal.textContent = item.total || '';
            tr.appendChild(tdTotal);

            const tdChange = document.createElement('td');
            tdChange.className = 'auto-calc change-col';
            tdChange.textContent = item.change || '';
            tr.appendChild(tdChange);

            const tdMemo = document.createElement('td');
            tdMemo.dataset.field = 'memo';
            tdMemo.classList.add('editable', 'editable-desc');
            if (originalItem.memo !== item.memo && hasUnsavedChanges) tdMemo.classList.add('cell-unsaved-change');
            tdMemo.contentEditable = true;
            tdMemo.textContent = item.memo || '';
            tr.appendChild(tdMemo);

            tableBody.appendChild(tr);

        } else if (item.type === 'subtotal' || item.type === 'grandtotal') {
            const tr = document.createElement('tr');
            tr.className = item.type === 'subtotal' ? 'sub-total' : 'grand-total';
             if (currentGroupHeader && !currentGroupHeader.expanded && item.type === 'subtotal') {
                 tr.classList.add('collapsed');
            }
            
            let cellsHtml = `<td>${item.text}</td><td></td>`;
            const sourceMetrics = item.type === 'subtotal' ? currentMetrics.buildingDetails[item.for] : currentMetrics.grandTotal;
            if (sourceMetrics) {
                parkingTypes.forEach(type => { cellsHtml += `<td data-sum-col="${type}">${sourceMetrics[type] || ''}</td>`; });
                cellsHtml += `<td data-sum-col="total" class="auto-calc">${sourceMetrics.total || ''}</td><td data-sum-col="change" class="auto-calc">${item.type === 'subtotal' ? (sourceMetrics.change || '') : ''}</td><td></td>`;
            } else {
                 parkingTypes.forEach(type => { cellsHtml += `<td></td>`; });
                 cellsHtml += `<td></td><td></td><td></td>`;
            }
            tr.innerHTML = cellsHtml;
            tableBody.appendChild(tr);
        }
    });

    formatCells(); 
    applyHighlighting();

    const now = new Date(); 
    document.getElementById('reportDate').innerText = now.toISOString().split('T')[0]; 
    document.getElementById('lastUpdated').innerText = now.toLocaleString('ko-KR');

    const toggleBtn = document.getElementById('toggleAllBtn');
    if (toggleBtn) {
        toggleBtn.textContent = allGroupsExpanded ? 'ì „ì²´ ì ‘ê¸°' : 'ì „ì²´ í´ê¸°';
        toggleBtn.classList.toggle('active', !allGroupsExpanded);
    }
}

function formatCells() { 
    document.querySelectorAll('.editable-base:not([data-field="location"]):not([data-field="memo"]), .auto-calc:not(.change-col):not([data-sum-col="change"])').forEach(cell => {
        let text = cell.textContent.trim();
        if (text === '0') {
            cell.textContent = '';
        }
    });
    
    document.querySelectorAll('.change-col, [data-sum-col="change"]').forEach(cell => { 
        let text = cell.textContent.trim(); 
        let value = parseFloat(text); 
        
        cell.classList.remove('change-positive', 'change-negative');
        if (isNaN(value) || value === 0) { 
            cell.textContent = ''; 
        } else if(value > 0) { 
            cell.textContent = `+${value}`; 
            cell.classList.add('change-positive'); 
        } else { // value < 0
            cell.textContent = String(value);
            cell.classList.add('change-negative'); 
        } 
    });
}

function saveAsHtml() {
    try {
        document.getElementById("myDropdown").classList.remove("show");
        const clonedDocument = document.documentElement.cloneNode(true);
        const oldScript = clonedDocument.querySelector('body > script'); if(oldScript) oldScript.remove();
        const sheetJsScript = document.createElement('script');
        sheetJsScript.src = "https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js";
        sheetJsScript.defer = true; clonedDocument.querySelector('head').appendChild(sheetJsScript);
        
        const dataToSave = JSON.parse(JSON.stringify(currentData));
        const originalDataToSave = JSON.parse(JSON.stringify(originalData));
        
        const initialOriginalDataString = JSON.stringify(initialOriginalData, null, 4);
        const originalDataString = JSON.stringify(originalDataToSave, null, 4); 
        const currentDataString = JSON.stringify(dataToSave, null, 4);
        const revisionHistoryString = JSON.stringify(revisionHistory, null, 4);
        const userDefinedConversionsString = JSON.stringify(userDefinedConversions, null, 4);
        
        const allFunctionsString = getAllFunctionsAsString();
        
        const scriptToSave = `
    let initialOriginalData = ${initialOriginalDataString};
    let originalData = ${originalDataString}; 
    let currentData = ${currentDataString}; 
    let revisionHistory = ${revisionHistoryString};
    let userDefinedConversions = ${userDefinedConversionsString};
    let parkingTypes = ${JSON.stringify(parkingTypes)};
    let activeRevisionIndices = ${JSON.stringify(activeRevisionIndices)}; 
    let isHighlighting = ${isHighlighting};
    let allGroupsExpanded = ${allGroupsExpanded};
    let originalDataMap = {}; 
    let historyStack = []; 
    let redoStack = []; 
    
    ${allFunctionsString}
    
    window.onload = () => {
        if (typeof initialOriginalData !== 'undefined' && initialOriginalData.length > 0) {
            originalData.forEach(item => { if (item.id) originalDataMap[item.id] = item; });
            renderAll();
            updateUndoRedoButtons();
            makeModalDraggable("revisionModalContent");
            makeModalDraggable("conversionModalContent");
            setupTableEventListeners();
        } else {
            initializeData();
        }
    };`;
        const newScript = document.createElement('script'); newScript.textContent = scriptToSave;
        const bodyElement = clonedDocument.querySelector('body');
        if (bodyElement) { bodyElement.appendChild(newScript); } else { throw new Error("Cloned document does not have a body element."); }
        const finalHtml = `<!DOCTYPE html>\n` + clonedDocument.outerHTML;
        const blob = new Blob([finalHtml], { type: 'text/html;charset=utf-8' });
        const link = document.createElement('a'); link.href = URL.createObjectURL(blob);
        const today = new Date(); const filename = `ê¸°ìˆ™ì‚¬_ì‚¬íƒ_ì£¼ì°¨ë©´_ê´€ë¦¬_${today.getFullYear()}${(today.getMonth()+1).toString().padStart(2,'0')}${today.getDate().toString().padStart(2,'0')}.html`;
        link.download = filename; document.body.appendChild(link); link.click(); document.body.removeChild(link); URL.revokeObjectURL(link.href);
    } catch (e) { console.error("HTML ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", e); alert("HTML íŒŒì¼ì„ ì €ì¥í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ê°œë°œì ì½˜ì†”(F12)ì„ í™•ì¸í•´ì£¼ì„¸ìš”."); }
}

function getAllFunctionsAsString() {
    const functions = [
        initializeData, findDataIndexById, updateRow, renderAll, formatCells, saveAsHtml, getAllFunctionsAsString, exportTableToExcel,
        pushHistory, updateUndoRedoButtons, undo, redo, applyHighlighting, openConversionModal, closeConversionModal, applyConversions, toggleConversionGroup,
        showWidthTooltip, hideTooltip, toggleGroup,
        toggleDropdown, handleFileUpload, processUploadedData, initializeDataFromUpload, downloadTemplate,
        openDrawingLink,
        setupTableEventListeners,
        saveRevision, showRevisionHistory, closeRevisionHistory, viewRevisionChanges, updateRevisionModalButtons,
        makeModalDraggable,
        showHistoryTooltip, applyChangeTracking, calculateMetrics, calculateAllChanges,
        renderKpiDetailsWithTracking, toggleAllGroups, buildHistory
    ];
    return functions.map(fn => fn.toString()).join('\n\n');
}

function exportTableToExcel() {
    if (typeof XLSX === 'undefined') { alert('ì—‘ì…€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.'); return; }
    const wb = XLSX.utils.book_new();
    const today = new Date();
    const filename = `ê¸°ìˆ™ì‚¬_ì‚¬íƒ_ì£¼ì°¨ë©´_í˜„í™©_${today.getFullYear()}${(today.getMonth()+1).toString().padStart(2,'0')}${today.getDate().toString().padStart(2,'0')}.xlsx`;
    const stripHtml = (html) => { 
        let doc = new DOMParser().parseFromString(html, 'text/html'); 
        let content = '';
        doc.querySelectorAll('span').forEach(span => {
            content += span.textContent.trim() + '\n';
        });
        return content.trim(); 
    }
    
    const kpiData = [
        ['í•­ëª©', 'ê°’', 'ìƒì„¸ ë‚´ìš©'],
        ['ì „ì²´ ì£¼ì°¨ë©´ ìˆ˜', document.getElementById('kpi-total-spots').textContent, ''],
        ['ì£¼ì°¨ë©´ ì‹ ì„¤ (Net)', document.getElementById('kpi-new-spots').textContent, stripHtml(document.getElementById('kpi-new-spots-details').innerHTML)],
        ['ì£¼ì°¨ë©´ ì œê±° (Net)', document.getElementById('kpi-removed-spots').textContent, stripHtml(document.getElementById('kpi-removed-spots-details').innerHTML)],
        [],
        ['[ì‘ì—…ëŸ‰(Gross) ìƒì„¸ ë¶„ì„]'],
        ['ì‹ ê·œ ì„¤ì¹˜ (Gross New)', document.getElementById('kpi-gross-new-spots').textContent, stripHtml(document.getElementById('kpi-gross-new-spots-details').innerHTML)],
        ['ì™„ì „ ì œê±° (Gross Removed)', document.getElementById('kpi-gross-removed-spots').textContent, stripHtml(document.getElementById('kpi-gross-removed-spots-details').innerHTML)],
        ['ìœ í˜• ë³€ê²½ (Type Conversion)', document.getElementById('kpi-type-conversion-spots').textContent, stripHtml(document.getElementById('kpi-type-conversion-spots-details').innerHTML)]
    ];
    const ws_kpi = XLSX.utils.aoa_to_sheet(kpiData); 
    ws_kpi['!cols'] = [{wch: 30}, {wch: 10}, {wch: 80}]; 
    XLSX.utils.book_append_sheet(wb, ws_kpi, 'í•µì‹¬ ìš”ì•½ (KPI)');

    const summaryData = [['[ê±´ë¬¼ë³„ ì´ ì£¼ì°¨ë©´]'], ['ê±´ë¬¼', 'ì „ì²´ ì£¼ì°¨ë©´ ìˆ˜']];
    document.querySelectorAll('#kpi-building-summary .kpi-summary-item').forEach(item => { summaryData.push([item.querySelector('.label').textContent, item.querySelector('.value').textContent]); });
    summaryData.push([], ['[ë™ë³„ ìƒì„¸ ë‚´ì—­ ìš”ì•½]']);
    document.querySelectorAll('#kpi-group-details-summary .group-detail-row').forEach(row => { const rowData = []; row.querySelectorAll('.group-detail-item').forEach(cell => { rowData.push(cell.textContent); }); summaryData.push(rowData); });
    const ws_summary = XLSX.utils.aoa_to_sheet(summaryData); ws_summary['!cols'] = [{wch: 25}, ...parkingTypes.map(() => ({wch:12}))]; 
    XLSX.utils.book_append_sheet(wb, ws_summary, 'ìš”ì•½ ì·¨í•©');

    const dashboardHeaders = ['êµ¬ë¶„', 'ë„ë©´ ë§í¬', 'ì£¼ì°¨ë„“ì´', ...parkingTypes, 'í•©ê³„', 'ì¦ê°', 'ë¹„ê³ ']; 
    const dashboardData = [dashboardHeaders];
    const metricsForExcel = calculateMetrics(currentData, originalData);
    currentData.forEach(item => {
        let row = [];
        if (item.type === 'header') { row.push(item.text, item.drawingUrl || ''); } 
        else if (item.type === 'data') { row.push(item.location, item.drawingUrl || '', item.width || ''); parkingTypes.forEach(type => row.push(item[type] || 0)); row.push(item.total, item.change, item.memo); }
        else if (item.type === 'subtotal' || item.type === 'grandtotal') { 
            const sourceMetrics = item.type === 'subtotal' ? metricsForExcel.buildingDetails[item.for] : metricsForExcel.grandTotal;
            row.push(item.text, '', ''); 
            if(sourceMetrics){
                parkingTypes.forEach(type => row.push(sourceMetrics[type] || 0));
                row.push(sourceMetrics.total, (item.type === 'subtotal' ? sourceMetrics.change : ''), '');
            } else {
                 parkingTypes.forEach(type => row.push(0)); row.push(0,0,'');
            }
        }
        dashboardData.push(row);
    });
    const ws_dashboard = XLSX.utils.aoa_to_sheet(dashboardData); ws_dashboard['!cols'] = [{wch:25}, {wch:30}, {wch:20}, ...parkingTypes.map(() => ({wch:10})), {wch:10}, {wch:10}, {wch:30}]; 
    XLSX.utils.book_append_sheet(wb, ws_dashboard, 'ëŒ€ì‹œë³´ë“œ í˜„í™©');

    const initialSheetHeaders = ['êµ¬ë¶„', 'ë„ë©´ ë§í¬', 'ì£¼ì°¨ë„“ì´', ...parkingTypes, 'í•©ê³„', 'ë¹„ê³ ']; 
    const initialSheetData = [initialSheetHeaders];
    const initialMetricsForExcel = calculateMetrics(JSON.parse(JSON.stringify(initialOriginalData)), null); 
    initialOriginalData.forEach(item => {
        let row = [];
        if (item.type === 'header') { row.push(item.text, item.drawingUrl || ''); } 
        else if (item.type === 'data') { row.push(item.location, item.drawingUrl || '', item.width || ''); parkingTypes.forEach(type => row.push(item[type] || 0)); row.push(item.total, item.memo); }
        else if (item.type === 'subtotal' || item.type === 'grandtotal') { 
            const sourceMetrics = item.type === 'subtotal' ? initialMetricsForExcel.buildingDetails[item.for] : initialMetricsForExcel.grandTotal;
            row.push(item.text, '', ''); 
            if(sourceMetrics){
                parkingTypes.forEach(type => row.push(sourceMetrics[type] || 0));
                row.push(sourceMetrics.total, '');
            } else {
                 parkingTypes.forEach(type => row.push(0)); row.push(0,'');
            }
        }
        initialSheetData.push(row);
    });
    const ws_initial = XLSX.utils.aoa_to_sheet(initialSheetData); 
    ws_initial['!cols'] = [{wch:25}, {wch:30}, {wch:20}, ...parkingTypes.map(() => ({wch:10})), {wch:10}, {wch:30}]; 
    XLSX.utils.book_append_sheet(wb, ws_initial, 'ì´ˆê¸° ì›ë³¸ ë°ì´í„° (Rev 0)');
    
    const historySheetData = [['ë¦¬ë¹„ì „ ë²ˆí˜¸', 'ì €ì¥ ì‹œê°„', 'ë³€ê²½ ìš”ì•½']];
    historySheetData.push(['Rev 0 (ì›ë³¸)', 'ìµœì´ˆ ë°ì´í„°', 'ê¸°ì¤€ ì›ë³¸ ë°ì´í„°']);
    revisionHistory.forEach((rev, index) => {
        historySheetData.push([`Rev ${index + 1}`, rev.timestamp, rev.summary]);
    });
    const ws_history = XLSX.utils.aoa_to_sheet(historySheetData);
    ws_history['!cols'] = [{ wch: 15 }, { wch: 20 }, { wch: 80 }]; 
    XLSX.utils.book_append_sheet(wb, ws_history, 'ë³€ê²½ ì´ë ¥ ì¶”ì  (History)');

    const rawHeaders = ['ID', 'êµ¬ë¶„', 'ì£¼ì°¨ë„“ì´', 'ë„ë©´ ë§í¬', ...parkingTypes, 'ë¹„ê³ '];
    const currentRawData = [rawHeaders, ...currentData.filter(item => item.type === 'data').map(item => { let row = [item.id, item.location, item.width || '', item.drawingUrl || '']; parkingTypes.forEach(type => row.push(item[type] || 0)); row.push(item.memo); return row; })];
    const ws_current_raw = XLSX.utils.aoa_to_sheet(currentRawData); ws_current_raw['!cols'] = [{wch:10}, {wch:25}, {wch:20}, {wch:30}, ...parkingTypes.map(() => ({wch:10})), {wch:30}]; 
    XLSX.utils.book_append_sheet(wb, ws_current_raw, 'ìˆ˜ì • ë°ì´í„° ìƒì„¸ (í˜„ì¬ Raw)');
    
    const infoData = [['ì°¸ì¡° ì‚¬í•­']]; document.querySelectorAll('.info-summary-container .info-item').forEach(item => { infoData.push([item.textContent]); });
    const ws_info = XLSX.utils.aoa_to_sheet(infoData); ws_info['!cols'] = [{wch: 60}]; 
    XLSX.utils.book_append_sheet(wb, ws_info, 'ì°¸ì¡° ì‚¬í•­');
    
    XLSX.writeFile(wb, filename);
}

function pushHistory() {
    historyStack.push(JSON.stringify({
        data: currentData, types: parkingTypes, original: originalData,
        conversions: userDefinedConversions
    }));
    redoStack = []; updateUndoRedoButtons();
}

function updateUndoRedoButtons() { document.getElementById('undoBtn').disabled = historyStack.length === 0; document.getElementById('redoBtn').disabled = redoStack.length === 0; }

function undo() {
    if (historyStack.length === 0) return;
    redoStack.push(JSON.stringify({ data: currentData, types: parkingTypes, original: originalData, conversions: userDefinedConversions }));
    const prevState = JSON.parse(historyStack.pop());
    parkingTypes = prevState.types;
    originalData = prevState.original; 
    currentData = prevState.data; 
    userDefinedConversions = prevState.conversions || {};
    originalDataMap = {}; 
    originalData.forEach(item => { if (item.id) originalDataMap[item.id] = item; });
    renderAll();
    updateUndoRedoButtons();
}

function redo() {
    if (redoStack.length === 0) return;
    historyStack.push(JSON.stringify({ data: currentData, types: parkingTypes, original: originalData, conversions: userDefinedConversions }));
    const nextState = JSON.parse(redoStack.pop());
    parkingTypes = nextState.types;
    originalData = nextState.original;
    currentData = nextState.data; 
    userDefinedConversions = nextState.conversions || {};
    originalDataMap = {}; 
    originalData.forEach(item => { if (item.id) originalDataMap[item.id] = item; });
    renderAll();
    updateUndoRedoButtons();
}

function applyHighlighting() {
    const REVISION_HIGHLIGHT_COLORS = 5;
    document.querySelectorAll('td.cell-modified').forEach(cell => { 
        const newCell = cell.cloneNode(true);
        cell.parentNode.replaceChild(newCell, cell);
    });

    document.getElementById('showHistoryBtn').classList.toggle('active', isHighlighting);

    if (!isHighlighting || activeRevisionIndices.length === 0) return;
    
    activeRevisionIndices.forEach(revIndex => {
        const highlightClass = `rev-highlight-${revIndex % REVISION_HIGHLIGHT_COLORS}`;
        const currentRevisionData = revisionHistory[revIndex].data;
        const previousRevisionData = (revIndex > 0) ? revisionHistory[revIndex - 1].data : initialOriginalData;
        
        const prevDataMap = {};
        previousRevisionData.filter(item => item.type === 'data').forEach(item => { prevDataMap[item.id] = item; });
        
        currentRevisionData.forEach(currentItem => {
            if (currentItem.type !== 'data') return;
            const previousItem = prevDataMap[currentItem.id] || {};
            const row = document.querySelector(`tr[data-row-id='${currentItem.id}']`);
            if (!row) return;

            for (const field in currentItem) {
                const previousValue = previousItem[field];
                const currentValue = currentItem[field];

                if (JSON.stringify(currentValue) !== JSON.stringify(previousValue)) {
                    const cell = row.querySelector(`td[data-field='${field}']`);
                    if (cell) {
                        const initialItem = initialOriginalData.find(i => i.id === currentItem.id) || {};
                        const initialValue = initialItem[field];
                        
                        const currentLabelForCell = `Rev ${revIndex + 1}`;
                        const previousLabelForCell = (revIndex > 0) ? `Rev ${revIndex}` : "Rev 0";

                        const historyEntries = buildHistory(initialValue, previousValue, currentValue, previousLabelForCell, currentLabelForCell);
                        
                        const newCell = cell.cloneNode(true);
                        newCell.classList.add('cell-modified', highlightClass);
                        newCell.addEventListener('mousemove', (event) => showHistoryTooltip(event, historyEntries));
                        newCell.addEventListener('mouseout', hideTooltip);
                        cell.parentNode.replaceChild(newCell, cell);
                    }
                }
            }
        });
    });
}

function openConversionModal() {
    const modalBody = document.getElementById('conversion-modal-body');
    modalBody.innerHTML = '';
    let contentHtml = '';
    let conversionCandidatesCount = 0;

    const baseDataMap = new Map();
    originalData.forEach(item => { if (item.id) baseDataMap.set(item.id, item); });

    currentData.forEach(currentItem => {
        if (currentItem.type !== 'data') return;

        const baseItem = baseDataMap.get(currentItem.id) || {};
        const decreasedTypes = new Map();
        const increasedTypes = new Map();

        parkingTypes.forEach(type => {
            const currentVal = currentItem[type] || 0;
            const baseVal = baseItem[type] || 0;
            const delta = currentVal - baseVal;
            if (delta < 0) { decreasedTypes.set(type, Math.abs(delta)); } 
            else if (delta > 0) { increasedTypes.set(type, delta); }
        });

        const userConversions = userDefinedConversions[currentItem.id] || [];
        const hasSuggestedConversions = decreasedTypes.size > 0 && increasedTypes.size > 0;
        
        if (hasSuggestedConversions || userConversions.length > 0) {
            conversionCandidatesCount++;
            
            contentHtml += `<div class="conversion-group">`;
            contentHtml += `<div class="conversion-group-header" onclick="toggleConversionGroup(this)">
                                <span class="toggle-icon">-</span>
                                <h4>ğŸ“ ${currentItem.location}</h4>
                            </div>`;
            
            contentHtml += `<div class="conversion-group-content">`;
            contentHtml += `<div class="conversion-item" data-row-id="${currentItem.id}">`;

            const suggestedPairs = new Set();
            if (hasSuggestedConversions) {
                contentHtml += `<h5>ì¶”ì²œ ë³€í™˜ í•­ëª© (ì‹¤ì œ ì¦ê° ê¸°ë°˜)</h5>`;
                contentHtml += `<div class="conversion-grid suggested-grid">`;
                
                decreasedTypes.forEach((decAmount, decType) => {
                    increasedTypes.forEach((incAmount, incType) => {
                        const pairKey = `${decType}->${incType}`;
                        suggestedPairs.add(pairKey);
                        const prefilledValue = userConversions.find(c => c.from === decType && c.to === incType)?.count || '';
                        contentHtml += `
                            <span>ê°ì†Œ: <b>${decType}</b> (-${decAmount})</span>
                            <span>&rarr;</span>
                            <span>ì¦ê°€: <b>${incType}</b> (+${incAmount})</span>
                            <span>:</span>
                            <input type="number" min="0" placeholder="ìˆ˜ëŸ‰" 
                                   data-from="${decType}" data-to="${incType}" value="${prefilledValue}">
                        `;
                    });
                });
                contentHtml += `</div>`;
            }

            contentHtml += `<div class="manual-conversion-section">
                                <h5>ìˆ˜ë™ ë³€í™˜ í•­ëª© (ì§ì ‘ ì§€ì •)</h5>
                                <div class="manual-conversion-list" id="manual-list-${currentItem.id}">`;

            userConversions.forEach(conv => {
                if (!suggestedPairs.has(`${conv.from}->${conv.to}`)) {
                    contentHtml += createManualConversionRowHtml(currentItem.id, conv.from, conv.to, conv.count);
                }
            });

            contentHtml += `</div>
                                <button class="btn btn-add-manual" onclick="addManualConversionRow('${currentItem.id}')">[+] í•­ëª© ì¶”ê°€</button>
                            </div>`;

            contentHtml += `</div></div></div>`;
        }
    });

    if (conversionCandidatesCount === 0) {
        modalBody.innerHTML = '<p>ìœ í˜• ë³€ê²½ì„ ì§€ì •í•  í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤. (ì£¼ì°¨ë©´ì˜ ê°ì†Œì™€ ì¦ê°€ê°€ ë™ì‹œì— ë°œìƒí•œ ìœ„ì¹˜ê°€ ì—†ìŠµë‹ˆë‹¤.)</p>';
    } else {
        modalBody.innerHTML = contentHtml;
    }

    document.getElementById('conversionModal').style.display = 'flex';
}

function closeConversionModal() {
    document.getElementById('conversionModal').style.display = 'none';
}

function applyConversions() {
    pushHistory(); 

    const newConversions = {};
    const items = document.querySelectorAll('#conversion-modal-body .conversion-item');
    
    items.forEach(item => {
        const rowId = item.dataset.rowId;
        const conversionsForRow = [];
        const addedPairs = new Set(); // To avoid duplicates

        // 1. Get from suggested inputs
        const suggestedInputs = item.querySelectorAll('.suggested-grid input[type="number"]');
        suggestedInputs.forEach(input => {
            const count = parseInt(input.value, 10);
            if (!isNaN(count) && count > 0) {
                const from = input.dataset.from;
                const to = input.dataset.to;
                conversionsForRow.push({ from, to, count });
                addedPairs.add(`${from}->${to}`);
            }
        });

        // 2. Get from manual rows
        const manualRows = item.querySelectorAll('.manual-conversion-row');
        manualRows.forEach(row => {
            const from = row.querySelector('.manual-from').value;
            const to = row.querySelector('.manual-to').value;
            const input = row.querySelector('input[type="number"]');
            const count = parseInt(input.value, 10);

            if (from && to && from !== to && !isNaN(count) && count > 0) {
                // Avoid adding if it was already added from the suggested list
                if (!addedPairs.has(`${from}->${to}`)) {
                    conversionsForRow.push({ from, to, count });
                    addedPairs.add(`${from}->${to}`);
                }
            }
        });

        if (conversionsForRow.length > 0) {
            newConversions[rowId] = conversionsForRow;
        }
    });

    userDefinedConversions = newConversions;
    renderAll();
    closeConversionModal();
}

function toggleConversionGroup(headerElement) {
    const content = headerElement.nextElementSibling;
    const icon = headerElement.querySelector('.toggle-icon');
    
    if (content) {
        content.classList.toggle('collapsed');
        icon.textContent = content.classList.contains('collapsed') ? '+' : '-';
    }
}

function showWidthTooltip(event, id) {
    const item = currentData.find(item => item.id === id);
    if (!item || !item.width || item.width.trim() === '') {
        hideTooltip();
        return;
    }

    const tooltip = document.getElementById('tooltip');
    const originalWidth = item.width;
    let displayWidth;

    // "ìˆ«ì*ìˆ«ì" í˜•íƒœì˜ ë¬¸ìì—´ì„ íŒŒì‹±
    const parts = originalWidth.split('*');
    
    // ì–‘ìª½ì— ë‹¤ë¥¸ ë¬¸ì ì—†ì´ ìˆ«ìë§Œ ìˆëŠ” ìˆœìˆ˜í•œ 'ìˆ«ì*ìˆ«ì' í˜•íƒœì¸ì§€ í™•ì¸
    if (parts.length === 2 && /^\d+$/.test(parts[0].trim()) && /^\d+$/.test(parts[1].trim())) {
        const width = parseInt(parts[0], 10);
        const height = parseInt(parts[1], 10);
        // ìš”ì²­ì‚¬í•­ì— ë§ê²Œ ìˆ«ì í¬ë§·íŒ… ë° 'mm' ì ‘ë¯¸ì‚¬ ì¶”ê°€
        displayWidth = `${width.toLocaleString('ko-KR')}mm x ${height.toLocaleString('ko-KR')}mm`;
    } else {
        // ê·¸ ì™¸ ë³µì¡í•œ ë¬¸ìì—´(ì˜ˆ: '2430*4915(ì™„) 2235*4925(ê¸‰)')ì€ ë¬¸ìì—´ ë‚´ ëª¨ë“  ìˆ«ìë¥¼ ì°¾ì•„ í¬ë§·íŒ…
        displayWidth = originalWidth.replace(/\d+/g, (match) => Number(match).toLocaleString('ko-KR'));
    }

    tooltip.innerHTML = `<strong>ì£¼ì°¨ ë„“ì´:</strong> ${displayWidth}`;
    tooltip.style.display = 'block';
    tooltip.style.left = (event.pageX + 15) + 'px';
    tooltip.style.top = (event.pageY + 15) + 'px';
}

function hideTooltip() { document.getElementById('tooltip').style.display = 'none'; }

function toggleGroup(headerIndex) { currentData[headerIndex].expanded = !currentData[headerIndex].expanded; renderAll(); }

function toggleDropdown() { document.getElementById("myDropdown").classList.toggle("show"); }

function handleFileUpload(event) {
    const file = event.target.files[0]; if (!file) return;
    const reader = new FileReader();
    reader.onload = (e) => {
        try {
            const data = new Uint8Array(e.target.result); const workbook = XLSX.read(data, {type: 'array'});
            const firstSheetName = workbook.SheetNames[0]; const worksheet = workbook.Sheets[firstSheetName];
            const jsonData = XLSX.utils.sheet_to_json(worksheet, { defval: "" }); 
            const { valid, newData, error } = processUploadedData(jsonData);
            if (!valid) { alert(`íŒŒì¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:\n${error}`); return; }
            initializeDataFromUpload(newData);
        } catch (error) { console.error(error); alert("íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. í…œí”Œë¦¿ ì–‘ì‹ì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.");
        } finally { event.target.value = ''; }
    };
    reader.readAsArrayBuffer(file);
}

function processUploadedData(jsonData) {
    if (jsonData.length === 0) return { valid: false, error: 'ì—…ë¡œë“œí•œ íŒŒì¼ì— ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.' };
    
    const uploadedHeaders = Object.keys(jsonData[0]);
    if (!uploadedHeaders.includes('ê·¸ë£¹') || !uploadedHeaders.includes('êµ¬ë¶„')) {
        return { valid: false, error: `í•„ìˆ˜ ì»¬ëŸ¼ì¸ 'ê·¸ë£¹' ë˜ëŠ” 'êµ¬ë¶„'ì´ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤.`};
    }

    const newParkingTypes = uploadedHeaders.filter(h => !['ê·¸ë£¹', 'êµ¬ë¶„', 'ì£¼ì°¨ë„“ì´', 'ë„ë©´ ë§í¬', 'ê·¸ë£¹ ë„ë©´ ë§í¬', 'ë¹„ê³ '].includes(h));
    
    let newBaseData = [];
    const addedGroups = new Set();
    const subtotalTemplates = {}; 
    
    const originalOrInitialData = originalData.length > 0 ? originalData : [];
    originalOrInitialData.forEach(item => { if(item.type === 'subtotal') subtotalTemplates[item.for] = item.text; });

    jsonData.forEach((row, index) => {
        const groupName = row['ê·¸ë£¹'] || (addedGroups.size > 0 ? [...addedGroups].pop() : 'ë¯¸ì§€ì • ê·¸ë£¹');
        if (!groupName) return; 

        if (!addedGroups.has(groupName)) {
            newBaseData.push({ type: 'header', text: groupName, expanded: false, drawingUrl: row['ê·¸ë£¹ ë„ë©´ ë§í¬'] || '' });
            addedGroups.add(groupName);
        }
        
        const dataRow = { type: 'data', id: `row_${index}_${Date.now()}` };
        dataRow.location = row['êµ¬ë¶„'] || `í•­ëª© ${index + 1}`;
        dataRow.width = row['ì£¼ì°¨ë„“ì´'] || '';
        dataRow.drawingUrl = row['ë„ë©´ ë§í¬'] || '';
        dataRow.memo = row['ë¹„ê³ '] || '';
        newParkingTypes.forEach(type => {
            dataRow[type] = parseInt(row[type], 10) || 0;
        });
        newBaseData.push(dataRow);
    });
    
    const finalData = [];
    addedGroups.forEach(groupName => {
        const header = newBaseData.find(item => item.type === 'header' && item.text === groupName);
        if(header) finalData.push(header);
        
        const groupDataRows = newBaseData.filter(item => {
            const rowData = jsonData.find(j => j['êµ¬ë¶„'] === item.location && j['ê·¸ë£¹'] === groupName);
            return item.type === 'data' && rowData;
        });
        finalData.push(...groupDataRows);
        
        if (groupDataRows.length > 0) {
            finalData.push({
                type: 'subtotal',
                for: groupName,
                text: subtotalTemplates[groupName] || `${groupName} ì†Œê³„`,
            });
        }
    });

    if (finalData.length > 0) {
        finalData.push({ type: 'grandtotal', text: 'ì „ì²´ í•©ê³„' });
    }
    
    return { valid: true, newData: finalData };
}

function initializeDataFromUpload(newData, confirmFirst = true) {
    if (confirmFirst && !confirm("ì •ë§ë¡œ ë°ì´í„°ë¥¼ êµì²´í•˜ì‹œê² ìŠµë‹ˆê¹Œ? í˜„ì¬ ìˆ˜ì • ì¤‘ì¸ ë‚´ìš©ê³¼ ì €ì¥ëœ ë³€ê²½ ì´ë ¥ì€ ëª¨ë‘ ì‚¬ë¼ì§‘ë‹ˆë‹¤.")) {
        return;
    }
    
    if(confirmFirst) {
        revisionHistory = [];
        activeRevisionIndices = [];
        initialOriginalData = JSON.parse(JSON.stringify(newData));
        userDefinedConversions = {};
    }

    const firstDataRow = newData.find(item => item.type === 'data');
    if (firstDataRow) {
        parkingTypes = Object.keys(firstDataRow).filter(key => 
            !['type', 'id', 'location', 'width', 'drawingUrl', 'memo', 'expanded', 'total', 'change'].includes(key)
        );
    } else { parkingTypes = []; }
    originalData = JSON.parse(JSON.stringify(newData));
    currentData = JSON.parse(JSON.stringify(newData));
    originalDataMap = {};
    originalData.forEach(item => {
        if (item.type === 'data' && !item.id) { item.id = `gen_${Math.random().toString(36).substr(2, 9)}`; }
        if (item.id) { originalDataMap[item.id] = item; }
    });
    historyStack = []; redoStack = [];
    isHighlighting = false;
    activeRevisionIndices = [];
    allGroupsExpanded = newData.every(item => item.type !== 'header' || item.expanded);
    updateUndoRedoButtons();
    renderAll();
}

function downloadTemplate() {
    const headers = ['ê·¸ë£¹', 'ê·¸ë£¹ ë„ë©´ ë§í¬', 'êµ¬ë¶„', 'ì£¼ì°¨ë„“ì´', 'ë„ë©´ ë§í¬', ...parkingTypes, 'ë¹„ê³ '];
    const templateData = [];
    let currentGroup = '';
    
    currentData.forEach(item => {
        if (item.type === 'header') {
            currentGroup = item.text;
        } else if (item.type === 'data') {
            const row = { 'ê·¸ë£¹': currentGroup };
            const groupHeader = currentData.find(h => h.type === 'header' && h.text === currentGroup);
            row['ê·¸ë£¹ ë„ë©´ ë§í¬'] = groupHeader ? groupHeader.drawingUrl : '';
            headers.slice(2).forEach(header => {
                const key = header === 'êµ¬ë¶„' ? 'location' : (header === 'ì£¼ì°¨ë„“ì´' ? 'width' : (header === 'ë„ë©´ ë§í¬' ? 'drawingUrl' : (header === 'ë¹„ê³ ' ? 'memo' : header)));
                row[header] = item[key] !== undefined ? item[key] : '';
            });
            templateData.push(row);
        }
    });

    const finalTemplateData = []; const processedGroups = new Set();
    templateData.forEach(row => {
        if (!processedGroups.has(row['ê·¸ë£¹'])) {
            finalTemplateData.push(row);
            processedGroups.add(row['ê·¸ë£¹']);
        } else {
            const newRow = {...row};
            newRow['ê·¸ë£¹ ë„ë©´ ë§í¬'] = '';
            finalTemplateData.push(newRow);
        }
    });
    const ws = XLSX.utils.json_to_sheet(finalTemplateData);
    const colWidths = [{wch:30}, {wch:30}, {wch:30}, {wch:20}, {wch:30}, ...parkingTypes.map(() => ({wch:10})), {wch:30}];
    ws['!cols'] = colWidths;
    const wb = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb, ws, "ë°ì´í„° ìˆ˜ì • í…œí”Œë¦¿");
    XLSX.writeFile(wb, "ì£¼ì°¨ë©´_ë°ì´í„°_í…œí”Œë¦¿.xlsx");
}

function openDrawingLink(url) {
    if (url && url.trim() !== '') {
        window.open(url, '_blank', 'noopener,noreferrer');
    }
}

function setupTableEventListeners() {
    const table = document.getElementById('parkingStatusTable');

    // 'êµ¬ë¶„' ì…€ì— ë§ˆìš°ìŠ¤ ì˜¤ë²„ ì‹œ ì£¼ì°¨ë©´ ê·œê²© íˆ´íŒ í‘œì‹œë¥¼ ìœ„í•œ ì´ë²¤íŠ¸ ìœ„ì„
    table.addEventListener('mousemove', (e) => {
        const locationCell = e.target.closest('td[data-field="location"]');
        if (locationCell) {
            const row = locationCell.closest('tr[data-row-id]');
            if (row) {
                showWidthTooltip(e, row.dataset.rowId);
            }
        }
    });

    table.addEventListener('mouseout', (e) => {
        const locationCell = e.target.closest('td[data-field="location"]');
        if (locationCell) {
            hideTooltip();
        }
    });

    table.addEventListener('focusin', (event) => {
        const cell = event.target;
        if (cell.isContentEditable) {
            if (cell.classList.contains('editable-base') && cell.textContent.trim() === '') {
                cell.textContent = '0';
            }
        }
    });

    table.addEventListener('focusout', (event) => {
        const cell = event.target;
        if (cell.isContentEditable) {
            if (cell.classList.contains('editable-base') && cell.textContent.trim() === '') {
                cell.textContent = '0';
            }
            
            const row = cell.closest('tr');
            if (!row || !row.dataset.rowId) return;

            const id = row.dataset.rowId;
            const field = cell.dataset.field;
            
            updateRow(id, field, cell.textContent);
        }
    });
}

function saveRevision() {
    const previousDataState = revisionHistory.length > 0 ? revisionHistory[revisionHistory.length - 1].data : initialOriginalData;
    const previousDataMap = {};
    previousDataState.filter(item => item.type === 'data').forEach(item => previousDataMap[item.id] = item);

    let changes = [];
    currentData.forEach(currentItem => {
        if (currentItem.type !== 'data') return;
        const previousItem = previousDataMap[currentItem.id] || {};
        
        Object.keys(currentItem).forEach(field => {
            if (['type', 'expanded', 'total', 'change', 'id'].includes(field)) return;
            
            const currentValue = currentItem[field];
            const previousValue = previousItem[field];
            
            if (JSON.stringify(currentValue) !== JSON.stringify(previousValue)) {
                changes.push(`${currentItem.location}: ${field}(${previousValue === undefined ? '' : previousValue }â†’${currentValue === undefined ? '' : currentValue})`);
            }
        });
    });

    if (changes.length === 0) {
        alert("ì €ì¥í•  ë³€ê²½ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.");
        return;
    }

    const summary = changes.join(', ');
    const newRevision = {
        timestamp: new Date().toLocaleString('ko-KR'),
        data: JSON.parse(JSON.stringify(currentData)),
        summary: summary
    };

    revisionHistory.push(newRevision);

    originalData = JSON.parse(JSON.stringify(currentData));
    originalDataMap = {};
    originalData.forEach(item => { if (item.id) originalDataMap[item.id] = item; });

    historyStack = [];
    redoStack = [];
    updateUndoRedoButtons();
    
    userDefinedConversions = {};
    isHighlighting = false;
    activeRevisionIndices = [];
    renderAll();
    
    alert(`Rev ${revisionHistory.length}ì´(ê°€) ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`);
}

function showRevisionHistory() {
    const modal = document.getElementById('revisionHistoryModal');
    if (modal.style.display === 'flex') {
        closeRevisionHistory();
        return;
    }

    const list = document.getElementById('revision-list');
    list.innerHTML = ''; 

    if (revisionHistory.length === 0) {
        list.innerHTML = '<li>ì €ì¥ëœ ë³€ê²½ ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.</li>';
    } else {
        revisionHistory.forEach((rev, index) => {
            const isCurrentlyActive = activeRevisionIndices.includes(index);
            const buttonText = isCurrentlyActive ? 'ë³´ê¸° ì·¨ì†Œ' : 'ë³€ê²½ì  ë³´ê¸°';
            const highlightClass = `btn-rev-highlight-${index % 5}`;
            const buttonClass = isCurrentlyActive ? `btn active ${highlightClass}` : 'btn';

            const listItem = document.createElement('li');
            listItem.innerHTML = `
                <div class="revision-info">
                    <span class="rev-title">Rev ${index + 1}</span>
                    <span class="rev-timestamp">${rev.timestamp}</span>
                    <span class="rev-summary"><b>ë³€ê²½ ìš”ì•½:</b> ${rev.summary}</span>
                </div>
                <div class="revision-actions">
                    <button class="${buttonClass}" data-rev-index="${index}" onclick="viewRevisionChanges(${index})">${buttonText}</button>
                </div>
            `;
            list.appendChild(listItem);
        });
    }
    modal.style.display = 'flex';
}

function closeRevisionHistory() {
    document.getElementById('revisionHistoryModal').style.display = 'none';
}

function viewRevisionChanges(revIndex) {
    const indexInArray = activeRevisionIndices.indexOf(revIndex);
    
    if (indexInArray > -1) { 
        activeRevisionIndices.splice(indexInArray, 1);
    } else { 
        activeRevisionIndices.push(revIndex);
        activeRevisionIndices.sort((a,b) => a-b);
    }
    
    isHighlighting = activeRevisionIndices.length > 0;
    
    if (isHighlighting) {
        const latestActiveIndex = Math.max(...activeRevisionIndices);
        currentData = JSON.parse(JSON.stringify(revisionHistory[latestActiveIndex].data));
        
        const previousDataForLatest = (latestActiveIndex > 0) ? revisionHistory[latestActiveIndex - 1].data : initialOriginalData;
        originalData = JSON.parse(JSON.stringify(previousDataForLatest));
    } else {
        const lastSavedState = revisionHistory.length > 0 ? revisionHistory[revisionHistory.length - 1].data : initialOriginalData;
        currentData = JSON.parse(JSON.stringify(lastSavedState));
        originalData = JSON.parse(JSON.stringify(lastSavedState));
    }
    
    originalDataMap = {};
    originalData.forEach(item => { if (item.id) originalDataMap[item.id] = item; });
    
    renderAll();
    updateRevisionModalButtons();
}

function updateRevisionModalButtons() {
    const REVISION_HIGHLIGHT_COLORS = 5;
    const modalButtons = document.querySelectorAll('#revision-list .btn');
    modalButtons.forEach(button => {
        const revIndex = parseInt(button.dataset.revIndex, 10);
        const isCurrentlyActive = activeRevisionIndices.includes(revIndex);
        const highlightClass = `btn-rev-highlight-${revIndex % REVISION_HIGHLIGHT_COLORS}`;
        
        button.textContent = isCurrentlyActive ? 'ë³´ê¸° ì·¨ì†Œ' : 'ë³€ê²½ì  ë³´ê¸°';
        
        for(let i=0; i < REVISION_HIGHLIGHT_COLORS; i++) {
            button.classList.remove(`btn-rev-highlight-${i}`);
        }

        if (isCurrentlyActive) {
            button.classList.add('active', highlightClass);
        } else {
            button.classList.remove('active');
        }
    });
}

function makeModalDraggable(modalContentId) {
    const modalContent = document.getElementById(modalContentId);
    if (!modalContent) return;

    const modalHeader = modalContent.querySelector(".modal-header");
    if (!modalHeader) return;

    let isDragging = false;
    let offsetX, offsetY;

    modalHeader.onmousedown = function(e) {
        // Ensure not to drag when clicking on interactive elements like buttons
        if (e.target.tagName === 'BUTTON' || e.target.classList.contains('modal-close-btn')) return;

        isDragging = true;
        offsetX = e.clientX - modalContent.offsetLeft;
        offsetY = e.clientY - modalContent.offsetTop;
        
        document.onmousemove = function(e) {
            if (isDragging) {
                e.preventDefault(); // Prevent text selection while dragging
                modalContent.style.left = (e.clientX - offsetX) + 'px';
                modalContent.style.top = (e.clientY - offsetY) + 'px';
                modalContent.style.transform = 'none';
            }
        };

        document.onmouseup = function() {
            isDragging = false;
            document.onmousemove = null;
            document.onmouseup = null;
        };
    };
}

function showHistoryTooltip(event, historyEntries) {
    const tooltip = document.getElementById('tooltip');
    const content = historyEntries
        .map(entry => `<strong>${entry.label}:</strong> ${entry.value || (typeof entry.value === 'number' ? '0' : '')}`)
        .join('<br>');
    tooltip.innerHTML = content;
    tooltip.style.display = 'block';
    tooltip.style.left = (event.pageX + 15) + 'px';
    tooltip.style.top = (event.pageY + 15) + 'px';
}

function applyChangeTracking(element, currentValue, previousValue, initialValue, currentLabel, previousLabel) {
    const newElement = element.cloneNode(true);
    if(element.parentNode){
        element.parentNode.replaceChild(newElement, element);
    }

    if (currentValue !== previousValue && previousValue !== undefined) {
        const hasUnsavedChanges = historyStack.length > 0;
        newElement.classList.add(hasUnsavedChanges ? 'value-unsaved-change' : 'has-history-tooltip');
        
        const historyEntries = buildHistory(initialValue, previousValue, currentValue, previousLabel, currentLabel);
        
        newElement.addEventListener('mousemove', (event) => showHistoryTooltip(event, historyEntries));
        newElement.addEventListener('mouseout', hideTooltip);
    }
}

function calculateMetrics(dataSet, baseDataSet) {
    const baseDataMap = {};
    if (baseDataSet) {
        baseDataSet.forEach(item => { if (item.id) baseDataMap[item.id] = item; });
    }

    const metrics = {
        grandTotal: { total: 0, change: 0 },
        buildingTotals: {},
        buildingDetails: {},
    };
    parkingTypes.forEach(type => {
        metrics.grandTotal[type] = 0;
    });

    dataSet.forEach((item) => {
        if (item.type === 'data') {
            let itemTotal = 0;
            parkingTypes.forEach(type => {
                itemTotal += (item[type] || 0);
            });
            item.total = itemTotal;

            const originalItem = baseDataMap[item.id] || {};
            let originalItemTotal = 0;
            if (baseDataSet) {
                parkingTypes.forEach(type => originalItemTotal += (originalItem[type] || 0));
                item.change = item.total - originalItemTotal;
            } else {
                item.change = 0;
            }
        }
    });
    
    dataSet.filter(item => item.type === 'header').forEach(header => {
        const groupName = header.text;
        const groupItems = dataSet.filter((d, i) => {
            if (d.type !== 'data') return false;
            let groupFound = false;
            for (let j = i - 1; j >= 0; j--) {
                if (dataSet[j].type === 'header') {
                    if (dataSet[j].text === groupName) groupFound = true;
                    break;
                }
            }
            return groupFound;
        });

        const subTotal = { total: 0, change: 0 };
        parkingTypes.forEach(type => subTotal[type] = 0);
        
        groupItems.forEach(d => {
            parkingTypes.forEach(type => subTotal[type] += (d[type] || 0));
            subTotal.total += d.total || 0;
            subTotal.change += d.change || 0;
        });
        
        metrics.buildingTotals[groupName] = subTotal.total;
        metrics.buildingDetails[groupName] = subTotal;
    });

    dataSet.filter(d => d.type === 'data').forEach(d => {
        parkingTypes.forEach(type => metrics.grandTotal[type] += (d[type] || 0));
        metrics.grandTotal.total += d.total || 0;
    });

    return metrics;
}

function calculateAllChanges(currentDataSet, baseDataSet) {
    const baseDataMap = new Map();
    baseDataSet.forEach(item => { if(item.id) baseDataMap.set(item.id, item); });

    const changes = {
        netNewByHierarchy: new Map(),
        netRemovedByHierarchy: new Map(),
        netNewSpots: 0,
        netRemovedSpots: 0,
        netTypeChanges: {},
        grossNewByHierarchy: new Map(),
        grossRemovedByHierarchy: new Map(),
        grossNew: 0,
        grossRemoved: 0,
        typeConversion: 0,
        conversionDetails: new Map(),
    };
    parkingTypes.forEach(type => { changes.netTypeChanges[type] = 0; });

    let currentGroup = { text: 'ë¯¸ì§€ì •' };
    currentDataSet.forEach(currentItem => {
        if (currentItem.type === 'header') {
            currentGroup = currentItem;
            return;
        }
        if (currentItem.type !== 'data') return;

        const baseItem = baseDataMap.get(currentItem.id) || {};
        let rowPositiveDelta = 0;
        let rowNegativeDelta = 0;
        const rowAdded = new Map();
        const rowRemoved = new Map();

        parkingTypes.forEach(type => {
            const currentVal = currentItem[type] || 0;
            const baseVal = baseItem[type] || 0;
            const delta = currentVal - baseVal;
            const hierarchyKey = `${currentGroup.text} > ${currentItem.location} > ${type}`;

            if (delta !== 0) {
                changes.netTypeChanges[type] = (changes.netTypeChanges[type] || 0) + delta;
            }

            if (delta > 0) {
                rowPositiveDelta += delta;
                rowAdded.set(type, delta);
            } else if (delta < 0) {
                const absDelta = Math.abs(delta);
                rowNegativeDelta += absDelta;
                rowRemoved.set(type, absDelta);
            }
        });
        
        const netRowChange = rowPositiveDelta - rowNegativeDelta;
        if (netRowChange > 0) changes.netNewSpots += netRowChange;
        if (netRowChange < 0) changes.netRemovedSpots += Math.abs(netRowChange);

        let rowConversionAmount = 0;
        const userConversions = userDefinedConversions[currentItem.id];

        if (userConversions && userConversions.length > 0) {
            // User-defined conversion path
            userConversions.forEach(conv => {
                const conversionAmount = conv.count;
                rowConversionAmount += conversionAmount;

                const hierarchyKey = `${currentGroup.text} > ${currentItem.location}`;
                const typeKey = `${conv.from} â†’ ${conv.to}`;
                const fullKey = `${hierarchyKey}: ${typeKey}`;
                changes.conversionDetails.set(fullKey, (changes.conversionDetails.get(fullKey) || 0) + conversionAmount);

                rowRemoved.set(conv.from, (rowRemoved.get(conv.from) || 0) - conversionAmount);
                rowAdded.set(conv.to, (rowAdded.get(conv.to) || 0) - conversionAmount);
            });
        } else {
            // Automatic conversion path
            rowConversionAmount = Math.min(rowPositiveDelta, rowNegativeDelta);
            if (rowConversionAmount > 0) {
                let tempRemoved = new Map(rowRemoved);
                let tempAdded = new Map(rowAdded);

                tempRemoved.forEach((removedAmount, removedType) => {
                    tempAdded.forEach((addedAmount, addedType) => {
                        const conversionAmount = Math.min(removedAmount, addedAmount);
                        if (conversionAmount > 0) {
                            const hierarchyKey = `${currentGroup.text} > ${currentItem.location}`;
                            const typeKey = `${removedType} â†’ ${addedType}`;
                            const fullKey = `${hierarchyKey}: ${typeKey}`;
                            changes.conversionDetails.set(fullKey, (changes.conversionDetails.get(fullKey) || 0) + conversionAmount);
                            
                            rowRemoved.set(removedType, rowRemoved.get(removedType) - conversionAmount);
                            rowAdded.set(addedType, rowAdded.get(addedType) - conversionAmount);

                            removedAmount -= conversionAmount;
                            addedAmount -= conversionAmount;
                            tempRemoved.set(removedType, removedAmount);
                            tempAdded.set(addedType, addedAmount);
                        }
                    });
                });
            }
        }
        
        changes.typeConversion += rowConversionAmount;

        rowAdded.forEach((amount, type) => {
            if (amount > 0) {
                changes.grossNew += amount;
                const hierarchyKey = `${currentGroup.text} > ${currentItem.location} > ${type}`;
                changes.grossNewByHierarchy.set(hierarchyKey, (changes.grossNewByHierarchy.get(hierarchyKey) || 0) + amount);
            }
        });
        rowRemoved.forEach((amount, type) => {
            if (amount > 0) {
                changes.grossRemoved += amount;
                const hierarchyKey = `${currentGroup.text} > ${currentItem.location} > ${type}`;
                changes.grossRemovedByHierarchy.set(hierarchyKey, (changes.grossRemovedByHierarchy.get(hierarchyKey) || 0) - amount);
            }
        });
    });

    const allHierarchyKeys = new Set([...changes.grossNewByHierarchy.keys(), ...changes.grossRemovedByHierarchy.keys()]);
    allHierarchyKeys.forEach(key => {
        const grossNew = changes.grossNewByHierarchy.get(key) || 0;
        const grossRemoved = Math.abs(changes.grossRemovedByHierarchy.get(key) || 0);
        const netChange = grossNew - grossRemoved;
        if (netChange > 0) {
            changes.netNewByHierarchy.set(key, netChange);
        } else if (netChange < 0) {
            changes.netRemovedByHierarchy.set(key, netChange);
        }
    });

    return changes;
}

function renderKpiDetailsWithTracking(containerEl, currentDetailsMap, comparisonDetailsMap, initialDetailsMap, currentLabel, previousLabel, changeClass, formatter) {
    containerEl.innerHTML = ''; 

    if (currentDetailsMap.size === 0) {
        containerEl.innerHTML = '<span style="text-align:center; width:100%;">-</span>';
        containerEl.classList.add('no-change');
        return;
    }

    containerEl.classList.remove('no-change');
    
    const detailsArray = [];
    currentDetailsMap.forEach((currentValue, key) => {
        const formattedValue = formatter(currentValue);
        const detailSpan = document.createElement('span');
        detailSpan.innerHTML = `${key}: <b data-track-key="${key}" class="${changeClass || ''}">${formattedValue}</b>`;
        detailsArray.push(detailSpan);
    });

    detailsArray.forEach((span) => {
        containerEl.appendChild(span);
    });

    currentDetailsMap.forEach((currentValue, key) => {
        const elementToTrack = containerEl.querySelector(`b[data-track-key="${key}"]`);
        if (elementToTrack) {
            const previousValue = comparisonDetailsMap.get(key) || 0;
            const initialValue = initialDetailsMap.get(key) || 0;
            applyChangeTracking(elementToTrack, currentValue, previousValue, initialValue, currentLabel, previousLabel);
        }
    });
}

function toggleAllGroups(button) {
    allGroupsExpanded = !allGroupsExpanded; 
    currentData.forEach(item => {
        if (item.type === 'header') {
            item.expanded = allGroupsExpanded;
        }
    });
    button.textContent = allGroupsExpanded ? 'ì „ì²´ ì ‘ê¸°' : 'ì „ì²´ í´ê¸°';
    button.classList.toggle('active', !allGroupsExpanded);
    renderAll();
}

function buildHistory(initialValue, previousValue, currentValue, previousLabel, currentLabel) {
    const historyEntries = [];
    const formatValue = (val) => val === undefined ? '' : val;

    historyEntries.push({ label: "Rev 0", value: formatValue(initialValue) });

    if (JSON.stringify(previousValue) !== JSON.stringify(initialValue)) {
        historyEntries.push({ label: previousLabel, value: formatValue(previousValue) });
    }

    const lastEntry = historyEntries[historyEntries.length - 1];
    if (JSON.stringify(currentValue) !== JSON.stringify(lastEntry.value)) {
        historyEntries.push({ label: currentLabel, value: formatValue(currentValue) });
    }

    return historyEntries;
}
    
    window.onload = () => {
        if (typeof initialOriginalData !== 'undefined' && initialOriginalData.length > 0) {
            originalData.forEach(item => { if (item.id) originalDataMap[item.id] = item; });
            renderAll();
            updateUndoRedoButtons();
            makeModalDraggable("revisionModalContent");
            makeModalDraggable("conversionModalContent");
            setupTableEventListeners();
        } else {
            initializeData();
        }
    };</script></body></html>