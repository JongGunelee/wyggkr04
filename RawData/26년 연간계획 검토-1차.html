<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>26년 계획 (확정 필요)</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>

    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- SheetJS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <style>
        body {
            font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif;
        }
    </style>
</head>

<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- 아이콘 컴포넌트 (Lucide Icons SVG) ---
        const IconBase = ({ size = 18, className = "", children }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {children}
            </svg>
        );

        const Calculator = (props) => <IconBase {...props} size={32}><rect width="16" height="20" x="4" y="2" rx="2" /><line x1="8" x2="16" y1="6" y2="6" /><line x1="16" x2="16" y1="14" y2="18" /><path d="M16 10h.01" /><path d="M12 10h.01" /><path d="M8 10h.01" /><path d="M12 14h.01" /><path d="M8 14h.01" /><path d="M12 18h.01" /><path d="M8 18h.01" /></IconBase>;
        const Upload = (props) => <IconBase {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="17 8 12 3 7 8" /><line x1="12" x2="12" y1="3" y2="15" /></IconBase>;
        const Edit3 = (props) => <IconBase {...props}><path d="M12 20h9" /><path d="M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z" /></IconBase>;
        const Save = (props) => <IconBase {...props}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" /><polyline points="17 21 17 13 7 13 7 21" /><polyline points="7 3 7 8 15 8" /></IconBase>;
        const FileSpreadsheet = (props) => <IconBase {...props}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" /><polyline points="14 2 14 8 20 8" /><path d="M8 13h2" /><path d="M8 17h2" /><path d="M14 13h2" /><path d="M14 17h2" /></IconBase>;
        const CheckCircle2 = (props) => <IconBase {...props} size={24}><circle cx="12" cy="12" r="10" /><path d="m9 12 2 2 4-4" /></IconBase>;
        const DollarSign = (props) => <IconBase {...props} size={20}><line x1="12" x2="12" y1="2" y2="22" /><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" /></IconBase>;
        const Calendar = (props) => <IconBase {...props} size={16}><rect width="18" height="18" x="3" y="4" rx="2" ry="2" /><line x1="16" x2="16" y1="2" y2="6" /><line x1="8" x2="8" y1="2" y2="6" /><line x1="3" x2="21" y1="10" y2="10" /></IconBase>;
        const AlertCircle = (props) => <IconBase {...props} size={16}><circle cx="12" cy="12" r="10" /><line x1="12" x2="12" y1="8" y2="12" /><line x1="12" x2="12.01" y1="16" y2="16" /></IconBase>;
        const AlertTriangle = (props) => <IconBase {...props} size={16}><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z" /><line x1="12" x2="12" y1="9" y2="13" /><line x1="12" x2="12.01" y1="17" y2="17" /></IconBase>;
        const Plus = (props) => <IconBase {...props} size={20}><path d="M5 12h14" /><path d="M12 5v14" /></IconBase>;
        const Trash2 = (props) => <IconBase {...props} size={20}><path d="M3 6h18" /><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" /><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" /><line x1="10" x2="10" y1="11" y2="17" /><line x1="14" x2="14" y1="11" y2="17" /></IconBase>;
        const ChevronUp = (props) => <IconBase {...props}><polyline points="18 15 12 9 6 15" /></IconBase>;
        const ChevronDown = (props) => <IconBase {...props}><polyline points="6 9 12 15 18 9" /></IconBase>;

        // --- 초기 데이터 및 유틸리티 함수 ---
        const INITIAL_DATA = [
            { id: 1, category: "투자", name: "기숙사 AB동 지하기계실 노후 진공온수 보일러 교체", cost: 75000, month: "8월", issue: "■ 도급 전환 확인 : - 장비 납품 (보일러+펌프) - 배관 및 연도 개조 , 장비 설치 - 전기 및 제어", safety: "발주 방식 확정후 협의 필요", remarks: "", confirmed: false },
            { id: 2, category: "투자", name: "기숙사/사택 기계실 노후 펌프 및 배관 액서리 교체", cost: 50000, month: "9월", issue: "■ 도급 전환 확인 : - 장비 납품 (펌프) - 배관 및 연도 개조", safety: "발주 방식 확정후 협의 필요", remarks: "", confirmed: false },
            { id: 3, category: "수선", name: "외부임차 사택 수장공사", cost: 26000, month: "연중", issue: "", safety: "", remarks: "", confirmed: false },
            { id: 4, category: "수선", name: "기숙사/사택 긴급공사 비상복구 수선비용", cost: 20000, month: "연중", issue: "", safety: "", remarks: "", confirmed: false },
            { id: 5, category: "수선", name: "기숙사동 및 어린이집 EHP 케어", cost: 0, month: "4월", issue: "■ 주말 할증 (하이엠솔루텍)", safety: "", remarks: "", confirmed: false },
        ];

        const formatCurrency = (value) => new Intl.NumberFormat('ko-KR').format(value);

        const formatFullCurrency = (value) => {
            const fullValue = value * 1000;
            if (fullValue >= 100000000) return `${(fullValue / 100000000).toFixed(1)}억 원`;
            return `${(fullValue / 10000).toFixed(0)}만 원`;
        };

        // --- 메인 애플리케이션 컴포넌트 ---
        const App = () => {
            const [items, setItems] = useState(() => {
                // 이전 버전의 캐시와 충돌을 피하기 위해 버전 키를 v6로 변경
                const saved = localStorage.getItem('planData_2026_v6');
                return saved ? JSON.parse(saved) : INITIAL_DATA;
            });

            const [editMode, setEditMode] = useState(false);
            const [isHeaderExpanded, setIsHeaderExpanded] = useState(true);
            const fileInputRef = useRef(null);

            useEffect(() => {
                localStorage.setItem('planData_2026_v6', JSON.stringify(items));
            }, [items]);

            const stats = useMemo(() => {
                const totalCost = items.reduce((acc, item) => acc + (Number(item.cost) || 0), 0);
                const confirmedCost = items.filter(i => i.confirmed).reduce((acc, item) => acc + (Number(item.cost) || 0), 0);

                // 투자비 섹션
                const investmentItems = items.filter(item => item.category && item.category.replace(/\s/g, '').includes('투자'));
                const investmentCost = investmentItems.reduce((acc, item) => acc + (Number(item.cost) || 0), 0);
                const confirmedInvestmentCost = investmentItems.filter(i => i.confirmed).reduce((acc, item) => acc + (Number(item.cost) || 0), 0);

                // 수선비 섹션 (투자 외 나머지 전체)
                const maintenanceItems = items.filter(item => !item.category || !item.category.replace(/\s/g, '').includes('투자'));
                const maintenanceCost = maintenanceItems.reduce((acc, item) => acc + (Number(item.cost) || 0), 0);
                const confirmedMaintenanceCost = maintenanceItems.filter(i => i.confirmed).reduce((acc, item) => acc + (Number(item.cost) || 0), 0);

                const totalCount = items.length;
                const confirmedCount = items.filter(i => i.confirmed).length;
                return {
                    totalCost, confirmedCost,
                    investmentCost, confirmedInvestmentCost,
                    maintenanceCost, confirmedMaintenanceCost,
                    totalCount, confirmedCount
                };
            }, [items]);

            const handleChange = (id, field, value) => {
                setItems(prev => prev.map(item => item.id === id ? { ...item, [field]: value } : item));
            };

            const toggleConfirm = (id) => {
                setItems(prev => prev.map(item => item.id === id ? { ...item, confirmed: !item.confirmed } : item));
            };

            // 전체 확정/해제 토글
            const toggleAllConfirm = () => {
                const allConfirmed = items.every(item => item.confirmed);
                setItems(prev => prev.map(item => ({ ...item, confirmed: !allConfirmed })));
            };

            const addItem = () => {
                const newId = items.length > 0 ? Math.max(...items.map(i => i.id)) + 1 : 1;
                const newItem = {
                    id: newId, category: "수선", name: "", cost: 0, month: "", issue: "", safety: "", remarks: "", confirmed: false
                };
                setItems([...items, newItem]);
                setEditMode(true);
            };

            const deleteItem = (id) => {
                if (window.confirm("정말 이 항목을 삭제하시겠습니까?")) {
                    setItems(prev => prev.filter(item => item.id !== id));
                }
            };

            // 엑셀 업로드 핸들러
            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (evt) => {
                    const bstr = evt.target.result;
                    const wb = window.XLSX.read(bstr, { type: 'binary' });
                    const wsname = wb.SheetNames[0];
                    const ws = wb.Sheets[wsname];
                    const data = window.XLSX.utils.sheet_to_json(ws, { header: 1 });

                    let headerRowIndex = -1;
                    data.forEach((row, index) => {
                        if (row.some(cell => typeof cell === 'string' && (cell.includes('구분') || cell.includes('공사명')))) {
                            headerRowIndex = index;
                        }
                    });

                    if (headerRowIndex === -1) {
                        alert("엑셀 양식을 인식할 수 없습니다. '구분', '공사명' 등의 헤더가 포함되어 있는지 확인해주세요.");
                        return;
                    }

                    const headers = data[headerRowIndex];
                    const colMap = {
                        category: headers.findIndex(h => h && h.includes('구분')),
                        name: headers.findIndex(h => h && h.includes('공사명')),
                        cost: headers.findIndex(h => h && h.includes('금액')),
                        month: headers.findIndex(h => h && (h.includes('월') || h.includes('계획'))),
                        issue: headers.findIndex(h => h && h.includes('이슈')),
                        safety: headers.findIndex(h => h && h.includes('안전')),
                        remarks: headers.findIndex(h => h && h.includes('비고')),
                    };

                    const newItems = [];
                    let currentId = 1;

                    for (let i = headerRowIndex + 1; i < data.length; i++) {
                        const row = data[i];
                        if (!row || row.length === 0) continue;
                        if (!row[colMap.name]) continue;

                        newItems.push({
                            id: currentId++,
                            category: row[colMap.category] || "기타",
                            name: row[colMap.name] || "",
                            cost: Number(row[colMap.cost]) || 0,
                            month: row[colMap.month] || "미정",
                            issue: row[colMap.issue] || "",
                            safety: row[colMap.safety] || "",
                            remarks: row[colMap.remarks] || "",
                            confirmed: false
                        });
                    }

                    if (newItems.length > 0) {
                        if (window.confirm(`${newItems.length}건의 데이터를 불러왔습니다. 기존 데이터를 덮어쓰시겠습니까?`)) {
                            setItems(newItems);
                        }
                    } else {
                        alert("유효한 데이터가 없습니다.");
                    }
                };
                reader.readAsBinaryString(file);
                e.target.value = '';
            };

            // 엑셀 저장 (xls sa)
            const downloadExcel = () => {
                const tableContent = `
                    <html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40">
                    <head>
                        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
                        <!--[if gte mso 9]>
                        <xml>
                            <x:ExcelWorkbook>
                                <x:ExcelWorksheets>
                                    <x:ExcelWorksheet>
                                        <x:Name>26년 연간계획</x:Name>
                                        <x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions>
                                    </x:ExcelWorksheet>
                                </x:ExcelWorksheets>
                            </x:ExcelWorkbook>
                        </xml>
                        <![endif]-->
                    </head>
                    <body>
                        <table border="1">
                            <thead>
                                <tr style="background-color: #f3f4f6; font-weight: bold; text-align: center;">
                                    <th>확정여부</th><th>구분</th><th>작업명</th><th>예상금액(천원)</th><th>계획월</th><th>핵심 이슈</th><th>안전 협의</th><th>비고</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${items.map(item => `
                                    <tr>
                                        <td style="text-align: center;">${item.confirmed ? '확정' : '검토중'}</td>
                                        <td>${item.category}</td>
                                        <td>${item.name}</td>
                                        <td style="text-align: right;" x:num>${item.cost}</td>
                                        <td style="text-align: center;">${item.month}</td>
                                        <td>${(item.issue || '').replace(/\n/g, '<br>')}</td>
                                        <td>${(item.safety || '').replace(/\n/g, '<br>')}</td>
                                        <td>${(item.remarks || '').replace(/\n/g, '<br>')}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </body>
                    </html>
                `;
                const blob = new Blob([tableContent], { type: 'application/vnd.ms-excel' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement("a");
                link.href = url;
                link.download = "26년_계획_확정본.xls";
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
            };

            // HTML 저장 (HT sa)
            const downloadHTML = () => {
                // 초기 설정값은 전체 선택이 되지 않은 상태로 저장하기 위해 confirmed 해제
                const resetItems = items.map(item => ({ ...item, confirmed: false }));
                const htmlContent = document.documentElement.outerHTML;
                const currentDataString = JSON.stringify(resetItems);
                const newHtml = htmlContent.replace(
                    /const INITIAL_DATA = \[.*?\];/s,
                    `const INITIAL_DATA = ${currentDataString};`
                ).replace(
                    /const saved = localStorage.getItem\('planData_2026_v6'\);/s,
                    `const saved = null;`
                );
                const blob = new Blob([newHtml], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `26년_계획_대시보드_${new Date().toLocaleDateString()}.html`;
                a.click();
                URL.revokeObjectURL(url);
            };

            return (
                <div className="min-h-screen bg-slate-50 text-slate-900 font-sans selection:bg-blue-200">
                    <header className={`bg-white border-b border-slate-200 sticky top-0 z-10 shadow-sm transition-all duration-300 ease-in-out`}>
                        <div className={`overflow-hidden transition-all duration-300 ease-in-out ${isHeaderExpanded ? 'max-h-[500px] opacity-100' : 'max-h-0 opacity-0'}`}>
                            <div className="max-w-7xl mx-auto px-6 py-6 flex flex-col md:flex-row justify-between items-center gap-4">
                                <div>
                                    <h1 className="text-2xl font-bold text-slate-800 flex items-center gap-2">
                                        <Calculator className="text-blue-600" />
                                        26년 계획 (확정 필요)
                                    </h1>
                                    <p className="text-slate-500 text-sm mt-1">
                                        작성일: {new Date().toLocaleDateString()} | 단위 확인: <span className="font-bold text-red-500">천원 (1,000 KRW)</span>
                                    </p>
                                </div>
                                <div className="flex flex-wrap gap-2 justify-center">
                                    <input type="file" ref={fileInputRef} onChange={handleFileUpload} className="hidden" accept=".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel" />

                                    <button onClick={() => fileInputRef.current.click()} className="flex items-center gap-2 px-4 py-2 rounded-lg font-semibold bg-white border border-slate-300 text-slate-700 hover:bg-slate-50 shadow-sm">
                                        <Upload /> xls up
                                    </button>

                                    <button onClick={() => setEditMode(!editMode)} className={`flex items-center gap-2 px-4 py-2 rounded-lg font-semibold transition-colors ${editMode ? 'bg-amber-100 text-amber-800 border border-amber-300' : 'bg-white border border-slate-300 text-slate-700 hover:bg-slate-50'}`}>
                                        <Edit3 /> {editMode ? '편집' : '편집 종료'}
                                    </button>

                                    <button onClick={downloadHTML} className="flex items-center gap-2 px-4 py-2 rounded-lg font-semibold bg-indigo-600 text-white hover:bg-indigo-700 shadow-md transition-all active:scale-95">
                                        <Save /> HT sa
                                    </button>

                                    <button onClick={downloadExcel} className="flex items-center gap-2 px-4 py-2 rounded-lg font-semibold bg-green-600 text-white hover:bg-green-700 shadow-md transition-all active:scale-95">
                                        <FileSpreadsheet /> xls sa
                                    </button>
                                </div>
                            </div>
                        </div>

                        {/* Toggle Button Container - minimized area */}
                        <div className="max-w-7xl mx-auto px-6 flex justify-center h-0 relative">
                            <button
                                onClick={() => setIsHeaderExpanded(!isHeaderExpanded)}
                                className="absolute -bottom-3 bg-white border border-slate-200 rounded-full p-1.5 shadow-md hover:bg-slate-50 hover:scale-110 transition-all z-20 text-slate-400 hover:text-blue-500 focus:outline-none"
                                title={isHeaderExpanded ? "제목 접기" : "제목 펴기"}
                            >
                                {isHeaderExpanded ? <ChevronUp size={14} /> : <ChevronDown size={14} />}
                            </button>
                        </div>
                    </header>

                    <main className="max-w-7xl mx-auto px-6 py-8">
                        <div className="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4 mb-8">
                            {/* 투자 확정 */}
                            <div className="bg-white p-4 rounded-xl shadow-sm border border-slate-200 border-t-4 border-t-green-500">
                                <div className="text-[11px] font-bold text-slate-400 mb-1 flex items-center gap-1">
                                    <CheckCircle2 size={12} className="text-green-500" /> 투자 확정
                                </div>
                                <div className="text-2xl font-black text-green-600 truncate">
                                    {formatCurrency(stats.confirmedInvestmentCost)}
                                </div>
                                <div className="text-[10px] text-slate-400 mt-1">
                                    (천원)
                                </div>
                            </div>

                            {/* 수선 확정 */}
                            <div className="bg-white p-4 rounded-xl shadow-sm border border-slate-200 border-t-4 border-t-green-600">
                                <div className="text-[11px] font-bold text-slate-400 mb-1 flex items-center gap-1">
                                    <CheckCircle2 size={12} className="text-green-600" /> 수선 확정
                                </div>
                                <div className="text-2xl font-black text-green-700 truncate">
                                    {formatCurrency(stats.confirmedMaintenanceCost)}
                                </div>
                                <div className="text-[10px] text-slate-400 mt-1">
                                    (천원)
                                </div>
                            </div>

                            {/* 투자 계획 */}
                            <div className="bg-white p-4 rounded-xl shadow-sm border border-slate-200 border-t-4 border-t-blue-500">
                                <div className="text-[11px] font-bold text-slate-400 mb-1 flex items-center gap-1">
                                    <DollarSign size={12} className="text-blue-500" /> 투자 계획
                                </div>
                                <div className="text-2xl font-black text-blue-600 truncate">
                                    {formatCurrency(stats.investmentCost)}
                                </div>
                                <div className="text-[10px] text-slate-400 mt-1">
                                    달성률: {Math.round((stats.confirmedInvestmentCost / (stats.investmentCost || 1)) * 100)}%
                                </div>
                            </div>

                            {/* 수선 계획 */}
                            <div className="bg-white p-4 rounded-xl shadow-sm border border-slate-200 border-t-4 border-t-orange-500">
                                <div className="text-[11px] font-bold text-slate-400 mb-1 flex items-center gap-1">
                                    <Calculator size={12} className="text-orange-500" /> 수선 계획
                                </div>
                                <div className="text-2xl font-black text-orange-600 truncate">
                                    {formatCurrency(stats.maintenanceCost)}
                                </div>
                                <div className="text-[10px] text-slate-400 mt-1">
                                    달성률: {Math.round((stats.confirmedMaintenanceCost / (stats.maintenanceCost || 1)) * 100)}%
                                </div>
                            </div>

                            {/* 전체 합계 */}
                            <div className="bg-slate-800 p-4 rounded-xl shadow-md text-white border-t-4 border-t-slate-600">
                                <div className="text-[11px] font-bold text-slate-400 mb-1 flex items-center gap-1">
                                    <Calendar size={12} /> 전체 합계
                                </div>
                                <div className="text-2xl font-black text-white truncate">
                                    {formatCurrency(stats.totalCost)}
                                </div>
                                <div className="flex justify-between text-[9px] text-slate-400 mt-1">
                                    <span>총 {stats.totalCount}건</span>
                                    <span>확정 {formatCurrency(stats.confirmedCost)}</span>
                                </div>
                            </div>
                        </div>

                        <div className="bg-white rounded-xl shadow-lg border border-slate-200 overflow-hidden">
                            <div className="overflow-x-auto">
                                <table className="w-full text-left border-collapse">
                                    <thead>
                                        <tr className="bg-slate-100 text-slate-600 border-b border-slate-200">
                                            <th className="p-4 w-16 text-center font-bold text-lg">
                                                <button
                                                    onClick={toggleAllConfirm}
                                                    className={`px-3 py-1 rounded-lg transition-all text-sm font-bold whitespace-nowrap ${items.every(i => i.confirmed)
                                                        ? 'bg-green-500 text-white hover:bg-green-600'
                                                        : items.some(i => i.confirmed)
                                                            ? 'bg-yellow-100 text-yellow-700 hover:bg-yellow-200 border border-yellow-300'
                                                            : 'bg-slate-200 text-slate-600 hover:bg-slate-300'
                                                        }`}
                                                    title={items.every(i => i.confirmed) ? '전체 해제' : '전체 확정'}
                                                >
                                                    {items.every(i => i.confirmed) ? '✓ 전체' : items.some(i => i.confirmed) ? '일부' : '확정'}
                                                </button>
                                            </th>
                                            <th className="p-4 w-24 font-bold text-lg text-center">구분</th>
                                            <th className="p-4 font-bold text-lg text-center">작업명</th>
                                            <th className="p-4 w-40 font-bold text-lg text-center">예상금액(천원)</th>
                                            <th className="p-4 w-28 font-bold text-lg text-center">계획월</th>
                                            <th className="p-4 w-1/4 font-bold text-lg text-center">핵심 이슈 / 안전 협의</th>
                                            {editMode && <th className="p-4 w-16 font-bold text-lg text-center">관리</th>}
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-slate-100">
                                        {items.map((item) => (
                                            <tr key={item.id} className={`group transition-colors ${item.confirmed ? 'bg-green-50/50' : 'hover:bg-slate-50'}`}>
                                                <td className="p-4 text-center align-middle">
                                                    <button onClick={() => toggleConfirm(item.id)} className={`w-10 h-10 rounded-full flex items-center justify-center transition-all ${item.confirmed ? 'bg-green-500 text-white shadow-md scale-110' : 'bg-slate-200 text-slate-400 hover:bg-slate-300'}`} title="확정/취소">
                                                        <CheckCircle2 />
                                                    </button>
                                                </td>
                                                <td className="p-4 align-middle">
                                                    {editMode ? <input type="text" value={item.category} onChange={(e) => handleChange(item.id, 'category', e.target.value)} className="w-full p-2 border border-slate-300 rounded text-sm" placeholder="구분" />
                                                        : <span className={`px-3 py-1 rounded-full text-sm font-bold whitespace-nowrap ${item.category && item.category.replace(/\s/g, '').includes('투자') ? 'bg-blue-100 text-blue-700'
                                                            : item.category && item.category.replace(/\s/g, '').includes('수선') ? 'bg-orange-100 text-orange-700'
                                                                : 'bg-purple-100 text-purple-700'
                                                            }`}>
                                                            {item.category ? item.category.replace(/\s/g, '').replace('(자산)', '') : ''}
                                                        </span>}
                                                </td>
                                                <td className="p-4 align-middle">
                                                    {editMode ? <textarea value={item.name} onChange={(e) => handleChange(item.id, 'name', e.target.value)} className="w-full p-2 border border-blue-300 rounded focus:ring-2 focus:ring-blue-500 bg-white text-lg font-medium" rows={2} />
                                                        : <div className={`text-lg font-medium whitespace-nowrap ${item.confirmed ? 'text-slate-800' : 'text-slate-700'}`}>{item.name}</div>}
                                                </td>
                                                <td className="p-4 align-middle text-right">
                                                    {editMode ? <input type="number" value={item.cost} onChange={(e) => handleChange(item.id, 'cost', Number(e.target.value))} className="w-full p-2 border border-blue-300 rounded text-right text-lg font-bold" />
                                                        : <div><div className={`text-xl font-bold ${item.confirmed ? 'text-green-700' : 'text-slate-800'}`}>{formatCurrency(item.cost)}</div><div className="text-xs text-slate-400 mt-1">{formatFullCurrency(item.cost)}</div></div>}
                                                </td>
                                                <td className="p-4 align-middle text-center">
                                                    {editMode ? <input type="text" value={item.month} onChange={(e) => handleChange(item.id, 'month', e.target.value)} className="w-full p-2 border border-blue-300 rounded text-center" />
                                                        : <div className="flex items-center justify-center gap-1 text-slate-600 font-medium bg-slate-100 px-3 py-1 rounded-lg whitespace-nowrap">
                                                            <Calendar />
                                                            {item.month ? (isNaN(item.month) || item.month === "" ? item.month : `${item.month}월`) : "미정"}
                                                        </div>}
                                                </td>
                                                <td className="p-4 align-middle">
                                                    <div className="space-y-3">
                                                        {editMode ? (
                                                            <>
                                                                <div className="relative"><label className="text-xs font-bold text-amber-600 mb-1 block">이슈사항</label><textarea value={item.issue} onChange={(e) => handleChange(item.id, 'issue', e.target.value)} className="w-full p-2 border border-amber-200 bg-amber-50 rounded text-sm" rows={2} /></div>
                                                                <div className="relative"><label className="text-xs font-bold text-red-600 mb-1 block">안전협의</label><textarea value={item.safety} onChange={(e) => handleChange(item.id, 'safety', e.target.value)} className="w-full p-2 border border-red-200 bg-red-50 rounded text-sm" rows={1} /></div>
                                                                <div className="relative"><label className="text-xs font-bold text-slate-500 mb-1 block">비고</label><input type="text" value={item.remarks} onChange={(e) => handleChange(item.id, 'remarks', e.target.value)} className="w-full p-2 border border-slate-200 bg-slate-50 rounded text-sm" /></div>
                                                            </>
                                                        ) : (
                                                            <>
                                                                {item.issue && <div className="flex gap-2 items-start text-sm text-slate-600 bg-amber-50 p-2 rounded border border-amber-100"><AlertCircle className="text-amber-500 shrink-0 mt-0.5" /><span className="whitespace-pre-line">{item.issue}</span></div>}
                                                                {item.safety && <div className="flex gap-2 items-start text-sm text-slate-600 bg-red-50 p-2 rounded border border-red-100"><AlertTriangle className="text-red-500 shrink-0 mt-0.5" /><span className="font-medium text-red-700 mr-1">[안전]</span><span className="whitespace-pre-line">{item.safety}</span></div>}
                                                                {item.remarks && <div className="text-xs text-slate-400 mt-1 pl-1 border-l-2 border-slate-200">비고: {item.remarks}</div>}
                                                                {!item.issue && !item.safety && !item.remarks && <span className="text-slate-300 text-sm">- 특이사항 없음 -</span>}
                                                            </>
                                                        )}
                                                    </div>
                                                </td>
                                                {editMode && <td className="p-4 align-middle text-center"><button onClick={() => deleteItem(item.id)} className="p-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200" title="삭제"><Trash2 /></button></td>}
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                            <div className="bg-slate-50 p-4 border-t border-slate-200 flex justify-center">
                                <button onClick={addItem} className="flex items-center gap-2 px-6 py-3 bg-white border-2 border-dashed border-slate-300 rounded-xl text-slate-500 hover:border-blue-500 hover:text-blue-600 hover:bg-blue-50 transition-all font-semibold">
                                    <Plus /> + 빈 항목 추가하기
                                </button>
                            </div>
                        </div>
                        <div className="mt-8 text-center text-slate-400 text-sm">
                            <p>※ 상단의 [xls up] 버튼을 사용하여 데이터를 불러오거나, [편집] 버튼을 눌러 직접 내용을 수정하세요.</p>
                        </div>
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>